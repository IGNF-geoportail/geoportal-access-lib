/*!
 * @brief Geoportal resources access library
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN 
 * @version 1.0.0-beta1
 * @date 2016-02-08
 *
 */
/*!
   * @overview es6-promise - a tiny implementation of Promises/A+.
   * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and cont  ributors (Conversion to ES6 API by Jake Archibald)
   * @license   Licensed under MIT license
   *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/  master/LICENSE
   * @version   3.0.2
   */

;(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define([], factory);
  } else if (typeof exports === 'object') {
    module.exports = factory();
  } else {
    root.Gp = factory();
  }
}(this, function() {
var log4js,loggerCfg,UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,UtilsHelper,promise,ProtocolsXHR,ProtocolsJSONP,ProtocolsProtocol,ServicesDefaultUrlService,ServicesCommonService,ServicesAltiRequestModelAltiRequest,ServicesAltiRequestModelAltiElevationRequest,ServicesAltiRequestModelAltiProfilRequest,ServicesAltiRequestAltiRequestREST,FormatsWPS,ServicesAltiRequestAltiRequestWPS,ServicesAltiRequestAltiRequestFactory,FormatsXML,ServicesAltiResponseModelAltiResponse,ServicesAltiResponseModelElevation,ServicesAltiFormatsAltiResponseReader,ServicesAltiResponseAltiResponseFactory,ServicesAltiAlti,ServicesAutoConfResponseModelAutoConfResponse,ServicesAutoConfResponseModelConstraint,ServicesAutoConfResponseModelFormat,ServicesAutoConfResponseModelLayer,ServicesAutoConfResponseModelLegend,ServicesAutoConfResponseModelMetadata,ServicesAutoConfResponseModelOriginator,ServicesAutoConfResponseModelService,ServicesAutoConfResponseModelStyle,ServicesAutoConfResponseModelTerritory,ServicesAutoConfResponseModelThematic,ServicesAutoConfResponseModelTileMatrixSet,ServicesAutoConfResponseModelTileMatrix,ServicesAutoConfResponseModelTileMatrixLimit,ServicesAutoConfFormatsAutoConfResponseReader,ServicesAutoConfResponseAutoConfResponseFactory,ServicesAutoConfAutoConf,FormatsXLSRequestHeader,FormatsXLSRequest,FormatsXLSAbstractService,FormatsXLS,FormatsXLSLocationUtilityServiceModelAddress,FormatsXLSLocationUtilityServiceGeocodeFilterExtension,FormatsXLSLocationUtilityServiceGeocodeRequest,FormatsXLSLocationUtilityServiceModelPosition,FormatsXLSLocationUtilityServiceModelPreference,FormatsXLSLocationUtilityServiceReverseGeocodeRequest,FormatsXLSLocationUtilityService,ServicesGeocodeRequestGeocodeLocation,ServicesGeocodeRequestModelStreetAddress,ServicesGeocodeRequestModelPositionOfInterest,ServicesGeocodeRequestModelCadastralParcel,ServicesGeocodeRequestModelAdministratif,ServicesGeocodeRequestDirectGeocodeRequestFactory,ServicesGeocodeResponseModelGeocodeResponse,ServicesGeocodeResponseModelGeocodedLocation,ServicesGeocodeResponseModelDirectGeocodedLocation,ServicesGeocodeFormatsDirectGeocodeResponseReader,ServicesGeocodeResponseDirectGeocodeResponseFactory,ServicesGeocodeGeocode,ServicesGeocodeRequestReverseGeocodeRequestFactory,ServicesGeocodeResponseModelReverseGeocodedLocation,ServicesGeocodeFormatsReverseGeocodeResponseReader,ServicesGeocodeResponseReverseGeocodeResponseFactory,ServicesGeocodeReverseGeocode,ServicesAutoCompleteResponseModelAutoCompleteResponse,ServicesAutoCompleteResponseModelSuggestedLocation,ServicesAutoCompleteResponseAutoCompleteResponseFactory,ServicesAutoCompleteAutoComplete,FormatsXLSRouteServiceModelRoutePlan,FormatsXLSRouteServiceDetermineRouteRequest,FormatsXLSRouteServiceRouteRequestExtension,FormatsXLSRouteService,ServicesRouteRequestRouteRequestOLS,ServicesRouteRequestModelRouteParamREST,ServicesRouteRequestRouteRequestREST,ServicesRouteRequestRouteRequestFactory,FormatsWKT,ServicesRouteResponseModelRouteResponse,ServicesRouteResponseModelRouteInstruction,ServicesRouteFormatsRouteResponseRESTReader,ServicesRouteFormatsRouteResponseOLSReader,ServicesRouteResponseRouteResponseFactory,ServicesRouteRoute,ServicesProcessIsoCurveRequestModelProcessIsoCurveParam,ServicesProcessIsoCurveRequestProcessIsoCurveRequest,ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse,ServicesProcessIsoCurveFormatsProcessIsoCurveResponseReader,ServicesProcessIsoCurveResponseProcessIsoCurveResponseFactory,ServicesProcessIsoCurveProcessIsoCurve,ServicesServices,Gp;!function(rootRequire){log4js=function(){var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function o(e,t){var o,r,n,s,i,a,c,l,u,p,h=t&&t.split("/"),f=g.map,d=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),l=0;l<e.length;l+=1)if(p=e[l],"."===p)e.splice(l,1),l-=1;else if(".."===p){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||d)&&f){for(o=e.split("/"),l=o.length;l>0;l-=1){if(r=o.slice(0,l).join("/"),h)for(u=h.length;u>0;u-=1)if(n=f[h.slice(0,u).join("/")],n&&(n=n[r])){s=n,i=l;break}if(s)break;!a&&d&&d[r]&&(a=d[r],c=l)}!s&&a&&(s=a,i=c),s&&(o.splice(0,i,s),e=o.join("/"))}return e}function r(t,o){return function(){return u.apply(e,y.call(arguments,0).concat([t,o]))}}function n(e){return function(t){return o(t,e)}}function s(e){return function(t){f[e]=t}}function i(o){if(t(d,o)){var r=d[o];delete d[o],m[o]=!0,l.apply(e,r)}if(!t(f,o)&&!t(m,o))throw new Error("No "+o);return f[o]}function a(e){var t,o=e?e.indexOf("!"):-1;return o>-1&&(t=e.substring(0,o),e=e.substring(o+1,e.length)),[t,e]}function c(e){return function(){return g&&g.config&&g.config[e]||{}}}var l,u,p,h,f={},d={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice;p=function(e,t){var r,s=a(e),c=s[0];return e=s[1],c&&(c=o(c,t),r=i(c)),c?e=r&&r.normalize?r.normalize(e,n(t)):o(e,t):(e=o(e,t),s=a(e),c=s[0],e=s[1],c&&(r=i(c))),{f:c?c+"!"+e:e,n:e,pr:c,p:r}},h={require:function(e){return r(e)},exports:function(e){var t=f[e];return"undefined"!=typeof t?t:f[e]={}},module:function(e){return{id:e,uri:"",exports:f[e],config:c(e)}}},l=function(o,n,a,c){var l,u,g,v,y,S,R=[];if(c=c||o,"function"==typeof a){for(n=!n.length&&a.length?["require","exports","module"]:n,y=0;y<n.length;y+=1)if(v=p(n[y],c),u=v.f,"require"===u)R[y]=h.require(o);else if("exports"===u)R[y]=h.exports(o),S=!0;else if("module"===u)l=R[y]=h.module(o);else if(t(f,u)||t(d,u)||t(m,u))R[y]=i(u);else{if(!v.p)throw new Error(o+" missing "+u);v.p.load(v.n,r(c,!0),s(u),{}),R[y]=f[u]}g=a.apply(f[o],R),o&&(l&&l.exports!==e&&l.exports!==f[o]?f[o]=l.exports:g===e&&S||(f[o]=g))}else o&&(f[o]=a)},requirejs=require=u=function(t,o,r,n,s){return"string"==typeof t?h[t]?h[t](o):i(p(t,o).f):(t.splice||(g=t,o.splice?(t=o,o=r,r=null):t=e),o=o||function(){},"function"==typeof r&&(r=n,n=s),n?l(e,t,o,r):setTimeout(function(){l(e,t,o,r)},15),u)},u.config=function(e){return g=e,u},define=function(e,o,r){o.splice||(r=o,o=[]),!t(f,e)&&!t(d,e)&&(d[e]=[e,o,r])},define.amd={jQuery:!0}}(),define("../deps/almond",function(){}),define("lifecycle",[],function(){var e=function(){this.started=!1};return e.prototype.start=function(e){return e=e||function(){},this.started=!0,e()},e.prototype.stop=function(e){return e=e||function(){},this.started=!1,e()},e.prototype.isStarted=function(){return this.started},e}),define("logevent",[],function(){var e=function(e,t,o){this.time=new Date,this.loggerName=e,this.level=t,this.message=o};return e.prototype.getLoggerName=function(){return this.loggerName},e.prototype.getLevel=function(){return this.level},e.prototype.getMessage=function(){return this.message},e.prototype.getMillis=function(){return this.time.getTime()},e}),define("error",[],function(){var e=function(e){this.message=e,Error.call(this),Error.captureStackTrace&&Error.captureStackTrace(this,arguments.callee)};return e.prototype=new Error,e}),define("loglevel",["require","./error"],function(e){var t=e("./error"),o=function(){this.levels=[]};return o.prototype.level2index=function(e){var t=0,o=this.levels.length;for(t=0;o>t;t++)if(this.levels[t]===e)return t;return-1},o.prototype.registerLevel=function(e,o){var r=0;if(-1!==this.level2index(e))throw new t('Log level "'+e+'" cannot be registered as it already exists');if(o&&(r=this.level2index(o),-1===r))throw new t('The log level "'+o+'" cannot be used as reference level as it does not exist');this.levels.splice(r,0,e)},o.prototype.registerStandardLevels=function(){this.registerLevel("trace"),this.registerLevel("log"),this.registerLevel("info"),this.registerLevel("warn"),this.registerLevel("error")},o.prototype.isBelow=function(e,t){return"off"===e?!0:"all"===e?"all"===t:"off"===t?!1:"all"===t?!0:this.level2index(e)<=this.level2index(t)},o.prototype.getLevels=function(){return this.levels},o}),define("utils",[],function(){var e=Object.prototype.toString,t=Array.isArray||function(t){return"[object Array]"===e.call(t)},o=function(t){return"[object String]"===e.call(t)},r=function(e){return e===Object(e)},n=function(t){return"[object Function]"===e.call(t)},s=function(t){return"[object Date]"===e.call(t)},i={},a=function(e,t,o){if(e)if(Array.prototype.forEach&&e.forEach===Array.prototype.forEach)e.forEach(t,o);else if(e.length===+e.length){for(var r=0,n=e.length;n>r;r++)if(r in e&&t.call(o,e[r],r,e)===i)return}else for(var s in e)if(e.hasOwnProperty(s)&&t.call(o,e[s],s,e)===i)return},c=function(e,t,o){var r=[];return e?Array.prototype.map&&e.map===Array.prototype.map?e.map(t,o):(a(e,function(e,n,s){r[r.length]=t.call(o,e,n,s)}),e.length===+e.length&&(r.length=e.length),r):r};return{isArray:t,isString:o,isObject:r,isFunction:n,isDate:s,each:a,map:c}}),define("layouts/simpleobjectserializer",["require","../utils"],function(e){function t(e){var t=String(e);return 1===t.length&&(t="0"+t),t}var o=e("../utils"),r=function(e,n){var s=null;return n="undefined"!=typeof n?n:1,"undefined"==typeof e?void 0:o.isString(e)?e:o.isDate(e)?e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+String((e.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z":0>=n?"…":(o.isArray(e)?(s=[],o.each(e,function(e){s.push(r(e,n-1))})):o.isObject(e)?(s={},o.each(e,function(e,t){s[t]=r(e,n-1)})):s=o.isFunction(e)?"[func]":e,s)};return function(e,t,o){var n=r(e,t),s="";return s=o?JSON.stringify(n):JSON.stringify(n,null,2),"undefined"==typeof s?"undefined":s}}),define("message",["require","./utils","./layouts/simpleobjectserializer"],function(e){var t=e("./utils"),o=e("./layouts/simpleobjectserializer"),r=function(e){this.formatString="",this.params=[],e&&(e=t.isArray(e)?e:[e],e.length>0&&t.isString(e[0])&&-1!==e[0].indexOf("{}")?(this.formatString=e[0],this.params=e.slice(1)):this.params=e)};return r.prototype.getFormattedMessage=function(e){e=e||{},e.separator=t.isString(e.separator)?e.separator:" ";var o=this.getFormattedParams(e);return o.join(e.separator)},r.prototype.getFormattedParams=function(e){e=e||{},e.separator=t.isString(e.separator)?e.separator:" ",e.compactObjects=e.compactObjects||!1,e.objectDepth=e.objectDepth||2;for(var o=0,r=0,n=this.params.length,s="",i=[],a={compactObjects:e.compactObjects,objectDepth:e.objectDepth},c=0,l=this.formatString.indexOf("{}");-1!==l;)s+=this.formatString.substring(c,l),n>o&&(r=this.params[o],s+=this.getFormattedParam(r,a)),o+=1,c=l+2,l=this.formatString.indexOf("{}",c);for(s+=this.formatString.substring(c),s&&i.push(s),!0;n>o;o++)r=this.params[o],i.push(this.getFormattedParam(r,e));return i},r.prototype.getFormattedParam=function(e,r){return r=r||{},r.objectDepth=r.objectDepth||2,t.isString(e)?e:r.preserveObjects&&t.isObject(e)?e:e&&e.toString&&e.toString!==Object.prototype.toString?e.toString():o(e,r.objectDepth,r.compactObjects)},r.prototype.getParameters=function(){return this.params},r.prototype.getFormat=function(){return this.formatString},r}),define("logger",["require","./logevent","./message","./utils"],function(e){var t=e("./logevent"),o=e("./message"),r=e("./utils"),n=function(e,t){this.name=e,this.loggerContext=t,this.parent=null,this.children=[],this.appenders=[],this.filter=null,this.level="inherit",this.additive=!0,this.loggerContext?(this.isBelow=function(e,t){return this.loggerContext.logLevel.isBelow(e,t)},r.each(this.loggerContext.logLevel.getLevels(),function(e){var t=this;this[e]||(this[e]=function(){t.traceAtLevel(e,arguments)})},this)):this.isBelow=function(){return!0}};return n.prototype.traceAtLevel=function(e,r){var n=0,s=[],i=null,a=r.length;for(n=0;n<r.length;n++)s[n]=r[n];i=1===a&&s[0]instanceof o?s[0]:new o(s);var c=new t(this.name,e,i);return this.loggerContext?this.loggerContext.traceLogEvent(c,this):this.traceLogEvent(c)},n.prototype.traceLogEvent=function(e,t){return t=t||"neutral","neutral"===t&&(t=this.isBelow(e.getLevel(),this.level)?"accept":"deny"),"accept"!==t||this.filter&&(t=this.filter.filter(e),"deny"===t)?void 0:this.append(e)},n.prototype.append=function(e){var t=0,o=0;for(t=0,o=this.appenders.length;o>t;t+=1)this.appenders[t].append(e);this.additive&&this.parent&&this.parent.append(e)},n.prototype.reset=function(){this.appenders=[],this.level="inherit",this.filter=null,this.additive=!0},n.prototype.initialize=function(e){e=e||{},this.level="undefined"!=typeof e.level?e.level:"inherit",this.additive="undefined"!=typeof e.additivity?e.additivity:!0,this.appenders=e.appenders||[],this.filter=e.filter||null},n}),define("filter",[],function(){var e=function(){};return e.prototype.filter=function(e){return e?"accept":"deny"},e}),define("filters/compositefilter",["require","../filter"],function(e){var t=e("../filter"),o=function(e){t.call(this),this.filters=e||[]};return o.prototype=new t,o.prototype.filter=function(e){var t=0,o=this.filters.length,r="neutral";for(t=0;o>t&&(r=this.filters[t].filter(e),"neutral"===r);t++);return r},o}),define("loggercontext",["require","./lifecycle","./logevent","./loglevel","./message","./logger","./utils","./filters/compositefilter","./error"],function(e){var t=e("./lifecycle"),o=e("./logevent"),r=e("./loglevel"),n=e("./message"),s=e("./logger"),i=e("./utils"),a=e("./filters/compositefilter"),c=e("./error"),l=function(){t.call(this),this.startTime=new Date,this.logLevel=new r,this.rootLogger=new s("[root]",this),this.loggers={},this.appenders={},this.filters={},this.layouts={},this.createdAppenders=[],this.filter=null,this.started=!1,this.pendingEvents=[],this.maxPendingEvents=1e3,this.discardedPendingEvents=0};return l.prototype=new t,l.prototype.registerAppender=function(e,t){this.appenders[e]=t},l.prototype.registerFilter=function(e,t){this.filters[e]=t},l.prototype.registerLayout=function(e,t){this.layouts[e]=t},l.prototype.registerLevel=function(e,t){this.logLevel.registerLevel(e,t),this.propagateTraceFunctions()},l.prototype.registerStandardLevels=function(){this.logLevel.registerStandardLevels()},l.prototype.getFilter=function(){return this.filter},l.prototype.traceLogEvent=function(e,t){if(!this.started)return this.saveLogEvent(e,t);var o="neutral",r=this.getFilter();return r&&(o=r.filter(e)),t.traceLogEvent(e,o)},l.prototype.saveLogEvent=function(e,t){var o=0;this.pendingEvents.length>=this.maxPendingEvents&&(o=Math.floor(this.maxPendingEvents/10),this.discardedPendingEvents+=o,this.pendingEvents.splice(0,o)),this.pendingEvents.push({evt:e,logger:t})},l.prototype.tracePendingEvents=function(){var e=0,t=null,r=null;for(this.discardedPendingEvents>0&&this.rootLogger.traceLogEvent(new o(this.rootLogger.name,"warn",new n("Too many messages received before loading was over. "+this.discardedPendingEvents+" messages were discarded. To avoid losing messages, consider waiting for Woodman to load before you start logging messages.")),"accept"),e=0;e<this.pendingEvents.length;e++)t=this.pendingEvents[e].evt,r=this.pendingEvents[e].logger,this.traceLogEvent(t,r);this.pendingEvents=[]},l.prototype.createFilter=function(e){var t=[],o=[],r=null;return e?(i.isArray(e)?t=e:i.each(e,function(e,o){i.isArray(e)?(i.each(e,function(e){e.type||(e.type=o)}),t=t.concat(e)):(e.type||(e.type=o),t.push(e))}),i.each(t,function(e){if(i.isFunction(e.filter))return void o.push(e);var t=this.filters[e.type];if(!t)throw new c('Unknown filter type "'+e.type+'"');o.push(new t(e))},this),o.length>1?r=new a(o):1===o.length&&(r=o[0]),r):null},l.prototype.initialize=function(e,t){t=t||function(e){if(e)throw e};var o=!1,r=null;e&&i.isString(e)&&e.match(/^console(\s|$)/i)?(o=!!("undefined"!=typeof global&&global.process&&global.process.versions&&global.process.versions.node),e={loggers:[{level:"all",appenders:[{type:"Console",name:"console",layout:{type:"pattern",pattern:e.substring("console ".length)||(o?"%d{yyyy-MM-dd HH:mm:ss} [%logger] %level - %m%n":"%d{yyyy-MM-dd HH:mm:ss} [%logger] %m%n")},appendStrings:o}]}]}):e=JSON.parse(JSON.stringify(e||{}));var n=[],s=[],a={};return this.reset(),i.isArray(e)?n=e:(e.configuration&&(e=e.configuration),e.properties&&(e.properties.property?i.isArray(e.properties.property)?i.each(e.properties.property,function(e){"maxPendingEvents"===e.name&&(this.maxPendingEvents=e.value)}):"maxPendingEvents"===e.properties.property.name&&(this.maxPendingEvents=e.properties.property.value):e.properties.maxPendingEvents&&(this.maxPendingEvents=e.properties.maxPendingEvents)),i.isArray(e.loggers)?n=e.loggers:(n=[],n=i.each(e.loggers,function(e,t){"root"===t&&(e.root=!0),i.isArray(e)?i.each(e,function(e){n.push(e)}):n.push(e)})),i.isArray(e.appenders)?s=e.appenders:i.each(e.appenders,function(e,t){i.isArray(e)?(i.each(e,function(e){e.type||(e.type=t)}),s=s.concat(e)):(e.type||(e.type=t),s.push(e))})),i.each(n,function(e){var t=[];e["appender-ref"]&&(i.isArray(e["appender-ref"])?t=i.map(e["appender-ref"],function(e){return e.ref}):t.push(e["appender-ref"].ref),delete e["appender-ref"]),i.isArray(e.appenders)&&i.each(e.appenders,function(e){i.isObject(e)?(s.push(e),t.push(e.name)):t.push(e)}),e.appenders=t}),this.filter=this.createFilter(e.filters),i.each(s,function(e){var t=this.appenders[e.type],o=null,n=null,s=null;if(!r){if(!t)return void(r=new c('Unknown appender type for "'+e.name+'": '+e.type));if(a[e.name])return void(r=new c('Appender "'+e.name+'" referenced twice in the configuration'));if(e.layout?(o=e.layout,n=this.layouts[o.type]):i.each(this.layouts,function(t,r){e[r]&&(o=e[r],n=t)}),!n)return void(r=new c('No proper layout defined for appender "'+e.name+'"'));e.layout=new n(o,this),e.filters?e.filter=this.createFilter(e.filters):e.filter&&(e.filter=this.createFilter([e.filter]));var l=this;e.isLogLevelBelow=function(e,t){return l.logLevel.isBelow(e,t)},s=new t(e),this.createdAppenders.push(s),a[e.name]=s}},this),r?t(r):(i.each(n,function(e){var t=null;r||(e.appenders=i.map(e.appenders,function(t){var o=a[t];return o?a[t]:void(r=new c('Logger "'+e.name+'" references undefined appender "'+t+'"'))}),e.filters?e.filter=this.createFilter(e.filters):e.filter&&(e.filter=this.createFilter(e.filter)),t=e.root||!e.name?this.getLogger():this.getLogger(e.name),t.initialize(e))},this),r?t(r):(this.propagateLevels(),this.propagateTraceFunctions(),t()))},l.prototype.getLogger=function(e){var t=null,o="",r=0;return e?(t=this.loggers[e],t?t:(t=new s(e,this),r=e.lastIndexOf("."),o=-1!==r?this.getLogger(e.substring(0,r)):this.rootLogger,t.parent=o,t.level=o.level,t.filter=o.filter,o.children=o.children||[],o.children.push(t),this.loggers[e]=t,t)):this.rootLogger},l.prototype.getStartTime=function(){return this.startTime.getTime()},l.prototype.reset=function(){var e="";for(e in this.loggers)this.loggers[e].reset();this.rootLogger.reset(),this.rootLogger.level="all",this.createdAppenders=[],this.started=!1},l.prototype.propagateLevels=function(){"inherit"===this.rootLogger.level&&(this.rootLogger.level="all"),i.each(this.loggers,function(e){for(var t=e;"inherit"===t.level;)t=t.parent;e.level=t.level,e.filter||(e.filter=t.filter)})},l.prototype.propagateTraceFunctions=function(){i.each(this.logLevel.getLevels(),function(e){var t=this.rootLogger;t[e]||(t[e]=function(){t.traceAtLevel(e,arguments)})},this),i.each(this.loggers,function(e){i.each(this.logLevel.getLevels(),function(t){e[t]||(e[t]=function(){e.traceAtLevel(t,arguments)})})},this)},l.prototype.start=function(e){e=e||function(e){if(e)throw e};var t=this,o=this.createdAppenders.length,r=!1,n=function(n){return r?void 0:n?(r=!0,e(n)):(o-=1,0===o?(t.started=!0,t.tracePendingEvents(),e()):void 0)};return o>0?void i.each(this.createdAppenders,function(e){e.start(function(e){return n(e)})}):(this.started=!0,this.pendingEvents=[],e())},l.prototype.stop=function(e){e=e||function(e){if(e)throw e};var t=this,o=this.createdAppenders.length,r=!1,n=function(n){return r?void 0:n?(r=!0,e(n)):(o-=1,0===o?(t.started=!1,e()):void 0)};return o>0?void i.each(this.createdAppenders,function(e){e.stop(function(e){return n(e)})}):(this.started=!1,e())},l.prototype.load=function(e,t){var o=this;t=t||function(e){if(e)throw e},this.initialize(e,function(e){return e?t(e):void o.start(t)})},l}),define("logmanager",["require","./loggercontext","./error"],function(e){var t=e("./loggercontext"),o=e("./error"),r=new t;return{registerAppender:function(e,t){return r.registerAppender(e,t)},registerFilter:function(e,t){return r.registerFilter(e,t)},registerLayout:function(e,t){return r.registerLayout(e,t)},registerLevel:function(e,t){return r.registerLevel(e,t)},registerStandardLevels:function(e,t){return r.registerStandardLevels(e,t)},load:function(e,t){return r.load(e,t)},unload:function(e){return r.stop(e)},initialize:function(e){return r.initialize(e)},start:function(e){return r.start(e)},stop:function(e){return r.stop(e)},getLogger:function(e){return r.getLogger(e)},Error:o}}),define("appender",["require","./lifecycle","./error"],function(e){var t=e("./lifecycle"),o=e("./error"),r=function(e){e=e||{},t.call(this),this.name=e.name,this.layout=e.layout,this.filter=e.filter,this.level=e.level||"all",this.isBelow=e.isLogLevelBelow||function(){return!0}};return r.prototype=new t,r.prototype.getName=function(){return this.name},r.prototype.append=function(e){if(!this.isStarted())throw new o('Appender "'+this.name+'" must be started before it may be used');var t="neutral";this.filter&&(t=this.filter.filter(e)),"neutral"===t&&(t=this.isBelow(e.getLevel(),this.level)?"accept":"deny"),"accept"===t&&this.doAppend(e)},r.prototype.doAppend=function(){},r.prototype.getLayout=function(){return this.layout},r}),define("appenders/consoleappender",["require","../appender"],function(e){var t=e("../appender"),o=function(e){e=e||{},t.call(this,e),this.appendStrings="undefined"!=typeof e.appendStrings?e.appendStrings:!0};return o.prototype=new t,o.prototype.doAppend=function(e){var t=this.getLayout(),o=e.getLevel(),r=null,n=null;this.appendStrings?(r=t.toMessageString(e),r&&r.lastIndexOf("\n")===r.length-1&&(r=r.substring(0,r.length-1)),this.doAppendMessages(o,[r])):(r=t.toMessageBits(e,{preserveObjects:!0}),r&&(n=r[r.length-1],n&&n.lastIndexOf("\n")===n.length-1&&(r[r.length-1]=n.substring(0,n.length-1))),this.doAppendMessages(o,r))},o.prototype.doAppendMessages=function(e,t){"undefined"!=typeof console&&("info"===e?console.info.apply(console,t):"warn"===e?console.warn.apply(console,t):"error"===e?console.error.apply(console,t):console.log.apply(console,t))},o});var io="undefined"==typeof module?{}:module.exports;!function(){if(function(e,t){var o=e;o.version="0.9.11",o.protocol=1,o.transports=[],o.j=[],o.sockets={},o.connect=function(e,r){var n,s,i=o.util.parseUri(e);t&&t.location&&(i.protocol=i.protocol||t.location.protocol.slice(0,-1),i.host=i.host||(t.document?t.document.domain:t.location.hostname),i.port=i.port||t.location.port),n=o.util.uniqueUri(i);var a={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};return o.util.merge(a,r),(a["force new connection"]||!o.sockets[n])&&(s=new o.Socket(a)),!a["force new connection"]&&s&&(o.sockets[n]=s),s=s||o.sockets[n],s.of(i.path.length>1?i.path:"")}}("object"==typeof module?module.exports:io={},this),function(e,t){var o=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];o.parseUri=function(e){for(var t=r.exec(e||""),o={},s=14;s--;)o[n[s]]=t[s]||"";return o},o.uniqueUri=function(e){var o=e.protocol,r=e.host,n=e.port;return"document"in t?(r=r||document.domain,n=n||("https"==o&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",!n&&"https"==o&&(n=443)),(o||"http")+"://"+r+":"+(n||80)},o.query=function(e,t){var r=o.chunkQuery(e||""),n=[];o.merge(r,o.chunkQuery(t||""));for(var s in r)r.hasOwnProperty(s)&&n.push(s+"="+r[s]);return n.length?"?"+n.join("&"):""},o.chunkQuery=function(e){for(var t,o={},r=e.split("&"),n=0,s=r.length;s>n;++n)t=r[n].split("="),t[0]&&(o[t[0]]=t[1]);return o};var s=!1;o.load=function(e){return"document"in t&&"complete"===document.readyState||s?e():void o.on(t,"load",e,!1)},o.on=function(e,t,o,r){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,r)},o.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!o.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||o.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&o.load(function(){s=!0}),o.defer=function(e){return o.ua.webkit&&"undefined"==typeof importScripts?void o.load(function(){setTimeout(e,100)}):e()},o.merge=function(e,t,r,n){var s,i=n||[],a="undefined"==typeof r?2:r;for(s in t)t.hasOwnProperty(s)&&o.indexOf(i,s)<0&&("object"==typeof e[s]&&a?o.merge(e[s],t[s],a-1,i):(e[s]=t[s],i.push(t[s])));return e},o.mixin=function(e,t){o.merge(e.prototype,t.prototype)},o.inherit=function(e,t){function o(){}o.prototype=t.prototype,e.prototype=new o},o.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.intersect=function(e,t){for(var r=[],n=e.length>t.length?e:t,s=e.length>t.length?t:e,i=0,a=s.length;a>i;i++)~o.indexOf(n,s[i])&&r.push(s[i]);return r},o.indexOf=function(e,t,o){for(var r=e.length,o=0>o?0>o+r?0:o+r:o||0;r>o&&e[o]!==t;o++);return o>=r?-1:o},o.toArray=function(e){for(var t=[],o=0,r=e.length;r>o;o++)t.push(e[o]);return t},o.ua={},o.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),o.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),o.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function o(){}e.EventEmitter=o,o.prototype.on=function(e,o){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(o):this.$events[e]=[this.$events[e],o]:this.$events[e]=o,this},o.prototype.addListener=o.prototype.on,o.prototype.once=function(e,t){function o(){r.removeListener(e,o),t.apply(this,arguments)}var r=this;return o.listener=t,this.on(e,o),this},o.prototype.removeListener=function(e,o){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var n=-1,s=0,i=r.length;i>s;s++)if(r[s]===o||r[s].listener&&r[s].listener===o){n=s;break}if(0>n)return this;r.splice(n,1),r.length||delete this.$events[e]}else(r===o||r.listener&&r.listener===o)&&delete this.$events[e]}return this},o.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},o.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},o.prototype.emit=function(e){if(!this.$events)return!1;var o=this.$events[e];if(!o)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof o)o.apply(this,r);else{if(!t.util.isArray(o))return!1;for(var n=o.slice(),s=0,i=n.length;i>s;s++)n[s].apply(this,r)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){function f(e){return 10>e?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var o,r,n,s,i,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(c)){for(s=c.length,o=0;s>o;o+=1)i[o]=str(o,c)||"null";return n=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+a+"]":"["+i.join(",")+"]",gap=a,n}if(rep&&"object"==typeof rep)for(s=rep.length,o=0;s>o;o+=1)"string"==typeof rep[o]&&(r=rep[o],n=str(r,c),n&&i.push(quote(r)+(gap?": ":":")+n));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(n=str(r,c),n&&i.push(quote(r)+(gap?": ":":")+n));return n=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+a+"}":"{"+i.join(",")+"}",gap=a,n}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;return JSON.stringify=function(e,t,o){var r;if(gap="",indent="","number"==typeof o)for(r=0;o>r;r+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")},JSON.parse=function(text,reviver){function walk(e,t){var o,r,n=e[t];if(n&&"object"==typeof n)for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r=walk(n,o),void 0!==r?n[o]=r:delete n[o]);return reviver.call(e,t,n)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")},exports}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var o=e.parser={},r=o.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],n=o.reasons=["transport not supported","client not handshaken","unauthorized"],s=o.advice=["reconnect"],i=t.JSON,a=t.util.indexOf;o.encodePacket=function(e){var t=a(r,e.type),o=e.id||"",c=e.endpoint||"",l=e.ack,u=null;switch(e.type){case"error":var p=e.reason?a(n,e.reason):"",h=e.advice?a(s,e.advice):"";(""!==p||""!==h)&&(u=p+(""!==h?"+"+h:""));break;case"message":""!==e.data&&(u=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),u=i.stringify(f);break;case"json":u=i.stringify(e.data);break;case"connect":e.qs&&(u=e.qs);break;case"ack":u=e.ackId+(e.args&&e.args.length?"+"+i.stringify(e.args):"")}var d=[t,o+("data"==l?"+":""),c];return null!==u&&void 0!==u&&d.push(u),d.join(":")},o.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var o=0,r=e.length;r>o;o++){var n=e[o];t+="�"+n.length+"�"+e[o]}return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;o.decodePacket=function(e){var t=e.match(c);if(!t)return{};var o=t[2]||"",e=t[5]||"",a={type:r[t[1]],endpoint:t[4]||""};switch(o&&(a.id=o,t[3]?a.ack="data":a.ack=!0),a.type){case"error":var t=e.split("+");a.reason=n[t[0]]||"",a.advice=s[t[1]]||"";break;case"message":a.data=e||"";break;case"event":try{var l=i.parse(e);a.name=l.name,a.args=l.args}catch(u){}a.args=a.args||[];break;case"json":try{a.data=i.parse(e)}catch(u){}break;case"connect":a.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(a.ackId=t[1],a.args=[],t[3]))try{a.args=t[3]?i.parse(t[3]):[]}catch(u){}
break;case"disconnect":case"heartbeat":}return a},o.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],r=1,n="";r<e.length;r++)"�"==e.charAt(r)?(t.push(o.decodePacket(e.substr(r+1).substr(0,n))),r+=Number(n)+1,n=""):n+=e.charAt(r);return t}return[o.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function o(e,t){this.socket=e,this.sessid=t}e.Transport=o,t.util.mixin(o,t.EventEmitter),o.prototype.heartbeats=function(){return!0},o.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var o=t.parser.decodePayload(e);if(o&&o.length)for(var r=0,n=o.length;n>r;r++)this.onPacket(o[r])}return this},o.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},o.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},o.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},o.prototype.onConnect=function(){return this.socket.onConnect(),this},o.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},o.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},o.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},o.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},o.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},o.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},o.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},o.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,o){function r(e){if(this.options={port:80,secure:!1,document:"document"in o?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(o,"beforeunload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function n(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},r.prototype.handshake=function(e){function o(t){t instanceof Error?(r.connecting=!1,r.onError(t.message)):e.apply(null,t.split(":"))}var r=this,s=this.options,i=["http"+(s.secure?"s":"")+":/",s.host+":"+s.port,s.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=i+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){o(e),c.parentNode.removeChild(c)})}else{var l=t.util.request();l.open("GET",i,!0),this.isXDomain()&&(l.withCredentials=!0),l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=n,200==l.status?o(l.responseText):403==l.status?r.onError(l.responseText):(r.connecting=!1,!r.reconnecting&&r.onError(l.responseText)))},l.send(null)}},r.prototype.getTransport=function(e){for(var o,r=e||this.transports,n=0;o=r[n];n++)if(t.Transport[o]&&t.Transport[o].check(this)&&(!this.isXDomain()||t.Transport[o].xdomainCheck(this)))return new t.Transport[o](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var o=this;return o.connecting=!0,this.handshake(function(r,n,s,i){function a(e){return o.transport&&o.transport.clearTimeouts(),o.transport=o.getTransport(e),o.transport?void o.transport.ready(o,function(){o.connecting=!0,o.publish("connecting",o.transport.name),o.transport.open(),o.options["connect timeout"]&&(o.connectTimeoutTimer=setTimeout(function(){if(!o.connected&&(o.connecting=!1,o.options["try multiple transports"])){for(var e=o.transports;e.length>0&&e.splice(0,1)[0]!=o.transport.name;);e.length?a(e):o.publish("connect_failed")}},o.options["connect timeout"]))}):o.publish("connect_failed")}o.sessionid=r,o.closeTimeout=1e3*s,o.heartbeatTimeout=1e3*n,o.transports||(o.transports=o.origTransports=i?t.util.intersect(i.split(","),o.options.transports):o.options.transports),o.setHeartbeatTimeout(),a(o.transports),o.once("connect",function(){clearTimeout(o.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)}},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},r.prototype.disconnectSync=function(){var e=t.util.request(),o=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",o,!1),e.send(null),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=o.location.port||("https:"==o.location.protocol?443:80);return this.options.host!==o.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,o=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||o)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function e(){if(o.connected){for(var e in o.namespaces)o.namespaces.hasOwnProperty(e)&&""!==e&&o.namespaces[e].packet({type:"connect"});o.publish("reconnect",o.transport.name,o.reconnectionAttempts)}clearTimeout(o.reconnectionTimer),o.removeListener("connect_failed",t),o.removeListener("connect",t),o.reconnecting=!1,delete o.reconnectionAttempts,delete o.reconnectionDelay,delete o.reconnectionTimer,delete o.redoTransports,o.options["try multiple transports"]=n}function t(){return o.reconnecting?o.connected?e():o.connecting&&o.reconnecting?o.reconnectionTimer=setTimeout(t,1e3):void(o.reconnectionAttempts++>=r?o.redoTransports?(o.publish("reconnect_failed"),e()):(o.on("connect_failed",t),o.options["try multiple transports"]=!0,o.transports=o.origTransports,o.transport=o.getTransport(),o.redoTransports=!0,o.connect()):(o.reconnectionDelay<s&&(o.reconnectionDelay*=2),o.connect(),o.publish("reconnecting",o.reconnectionDelay,o.reconnectionAttempts),o.reconnectionTimer=setTimeout(t,o.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var o=this,r=this.options["max reconnection attempts"],n=this.options["try multiple transports"],s=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function o(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=o,t.util.mixin(o,t.EventEmitter),o.prototype.$emit=t.EventEmitter.prototype.emit,o.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},o.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},o.prototype.send=function(e,t){var o={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(o.id=++this.ackPackets,o.ack=!0,this.acks[o.id]=t),this.packet(o)},o.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),o=t[t.length-1],r={type:"event",name:e};return"function"==typeof o&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=o,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},o.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},o.prototype.onPacket=function(e){function o(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var n=["message",e.data];"data"==e.ack?n.push(o):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,n);break;case"event":var n=[e.name].concat(e.args);"data"==e.ack&&n.push(o),this.$emit.apply(this,n);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,o){function r(e){t.Transport.apply(this,arguments)}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(){var e,r=t.util.query(this.socket.options.query),n=this;return e||(e=o.MozWebSocket||o.WebSocket),this.websocket=new e(this.prepareUrl()+r),this.websocket.onopen=function(){n.onOpen(),n.socket.setBuffer(!1)},this.websocket.onmessage=function(e){n.onData(e.data)},this.websocket.onclose=function(){n.onClose(),n.socket.setBuffer(!0)},this.websocket.onerror=function(e){n.onError(e)},this},t.util.ua.iDevice?r.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,o=e.length;o>t;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in o&&!("__addTask"in WebSocket)||"MozWebSocket"in o},r.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function o(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=o,t.util.inherit(o,t.Transport.websocket),o.prototype.name="flashsocket",o.prototype.open=function(){var e=this,o=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,o)}),this},o.prototype.send=function(){var e=this,o=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,o)}),this},o.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},o.prototype.ready=function(e,r){function n(){var t=e.options,n=t["flash policy port"],i=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];o.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=i.join("/")),843!==n&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+n),WebSocket.__initialize(),o.loaded=!0),r.call(s)}var s=this;return document.body?n():void t.util.load(n)},o.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},o.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function e(){if(!V){try{var e=F.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(t){return}V=!0;for(var o=U.length,r=0;o>r;r++)U[r]()}}function t(e){V?e():U[U.length]=e}function o(e){if(typeof k.addEventListener!=P)k.addEventListener("load",e,!1);else if(typeof F.addEventListener!=P)F.addEventListener("load",e,!1);else if(typeof k.attachEvent!=P)v(k,"onload",e);else if("function"==typeof k.onload){var t=k.onload;k.onload=function(){t(),e()}}else k.onload=e}function r(){q?n():s()}function n(){var e=F.getElementsByTagName("body")[0],t=m(x);t.setAttribute("type",M);var o=e.appendChild(t);if(o){var r=0;!function(){if(typeof o.GetVariable!=P){var n=o.GetVariable("$version");n&&(n=n.split(" ")[1].split(","),W.pv=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)])}else if(10>r)return r++,void setTimeout(arguments.callee,10);e.removeChild(t),o=null,s()}()}else s()}function s(){var e=G.length;if(e>0)for(var t=0;e>t;t++){var o=G[t].id,r=G[t].callbackFn,n={success:!1,id:o};if(W.pv[0]>0){var s=g(o);if(s)if(!y(G[t].swfVersion)||W.wk&&W.wk<312)if(G[t].expressInstall&&a()){var u={};u.data=G[t].expressInstall,u.width=s.getAttribute("width")||"0",u.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(u.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(u.align=s.getAttribute("align"));for(var p={},h=s.getElementsByTagName("param"),f=h.length,d=0;f>d;d++)"movie"!=h[d].getAttribute("name").toLowerCase()&&(p[h[d].getAttribute("name")]=h[d].getAttribute("value"));c(u,p,o,r)}else l(s),r&&r(n);else R(o,!0),r&&(n.success=!0,n.ref=i(o),r(n))}else if(R(o,!0),r){var m=i(o);m&&typeof m.SetVariable!=P&&(n.success=!0,n.ref=m),r(n)}}}function i(e){var t=null,o=g(e);if(o&&"OBJECT"==o.nodeName)if(typeof o.SetVariable!=P)t=o;else{var r=o.getElementsByTagName(x)[0];r&&(t=r)}return t}function a(){return!B&&y("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function c(e,t,o,r){B=!0,A=r||null,b={success:!1,id:o};var n=g(o);if(n){"OBJECT"==n.nodeName?(_=u(n),w=null):(_=n,w=o),e.id=N,(typeof e.width==P||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==P||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),F.title=F.title.slice(0,47)+" - Flash Player Installation";var s=W.ie&&W.win?["Active"].concat("").join("X"):"PlugIn",i="MMredirectURL="+k.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+F.title;if(typeof t.flashvars!=P?t.flashvars+="&"+i:t.flashvars=i,W.ie&&W.win&&4!=n.readyState){var a=m("div");o+="SWFObjectNew",a.setAttribute("id",o),n.parentNode.insertBefore(a,n),n.style.display="none",function(){4==n.readyState?n.parentNode.removeChild(n):setTimeout(arguments.callee,10)}()}p(e,t,o)}}function l(e){if(W.ie&&W.win&&4!=e.readyState){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=m("div");if(W.win&&W.ie)t.innerHTML=e.innerHTML;else{var o=e.getElementsByTagName(x)[0];if(o){var r=o.childNodes;if(r)for(var n=r.length,s=0;n>s;s++)(1!=r[s].nodeType||"PARAM"!=r[s].nodeName)&&8!=r[s].nodeType&&t.appendChild(r[s].cloneNode(!0))}}return t}function p(e,t,o){var r,n=g(o);if(W.wk&&W.wk<312)return r;if(n)if(typeof e.id==P&&(e.id=o),W.ie&&W.win){var s="";for(var i in e)e[i]!=Object.prototype[i]&&("data"==i.toLowerCase()?t.movie=e[i]:"styleclass"==i.toLowerCase()?s+=' class="'+e[i]+'"':"classid"!=i.toLowerCase()&&(s+=" "+i+'="'+e[i]+'"'));var a="";for(var c in t)t[c]!=Object.prototype[c]&&(a+='<param name="'+c+'" value="'+t[c]+'" />');n.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+a+"</object>",j[j.length]=e.id,r=g(e.id)}else{var l=m(x);l.setAttribute("type",M);for(var u in e)e[u]!=Object.prototype[u]&&("styleclass"==u.toLowerCase()?l.setAttribute("class",e[u]):"classid"!=u.toLowerCase()&&l.setAttribute(u,e[u]));for(var p in t)t[p]!=Object.prototype[p]&&"movie"!=p.toLowerCase()&&h(l,p,t[p]);n.parentNode.replaceChild(l,n),r=l}return r}function h(e,t,o){var r=m("param");r.setAttribute("name",t),r.setAttribute("value",o),e.appendChild(r)}function f(e){var t=g(e);t&&"OBJECT"==t.nodeName&&(W.ie&&W.win?(t.style.display="none",function(){4==t.readyState?d(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function d(e){var t=g(e);if(t){for(var o in t)"function"==typeof t[o]&&(t[o]=null);t.parentNode.removeChild(t)}}function g(e){var t=null;try{t=F.getElementById(e)}catch(o){}return t}function m(e){return F.createElement(e)}function v(e,t,o){e.attachEvent(t,o),X[X.length]=[e,t,o]}function y(e){var t=W.pv,o=e.split(".");return o[0]=parseInt(o[0],10),o[1]=parseInt(o[1],10)||0,o[2]=parseInt(o[2],10)||0,t[0]>o[0]||t[0]==o[0]&&t[1]>o[1]||t[0]==o[0]&&t[1]==o[1]&&t[2]>=o[2]?!0:!1}function S(e,t,o,r){if(!W.ie||!W.mac){var n=F.getElementsByTagName("head")[0];if(n){var s=o&&"string"==typeof o?o:"screen";if(r&&(T=null,C=null),!T||C!=s){var i=m("style");i.setAttribute("type","text/css"),i.setAttribute("media",s),T=n.appendChild(i),W.ie&&W.win&&typeof F.styleSheets!=P&&F.styleSheets.length>0&&(T=F.styleSheets[F.styleSheets.length-1]),C=s}W.ie&&W.win?T&&typeof T.addRule==x&&T.addRule(e,t):T&&typeof F.createTextNode!=P&&T.appendChild(F.createTextNode(e+" {"+t+"}"))}}}function R(e,t){if(H){var o=t?"visible":"hidden";V&&g(e)?g(e).style.visibility=o:S("#"+e,"visibility:"+o)}}function E(e){var t=/[\\\"<>\.;]/,o=null!=t.exec(e);return o&&typeof encodeURIComponent!=P?encodeURIComponent(e):e}var _,w,A,b,T,C,P="undefined",x="object",O="Shockwave Flash",L="ShockwaveFlash.ShockwaveFlash",M="application/x-shockwave-flash",N="SWFObjectExprInst",I="onreadystatechange",k=window,F=document,D=navigator,q=!1,U=[r],G=[],j=[],X=[],V=!1,B=!1,H=!0,W=function(){var e=typeof F.getElementById!=P&&typeof F.getElementsByTagName!=P&&typeof F.createElement!=P,t=D.userAgent.toLowerCase(),o=D.platform.toLowerCase(),r=o?/win/.test(o):/win/.test(t),n=o?/mac/.test(o):/mac/.test(t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,i=!1,a=[0,0,0],c=null;if(typeof D.plugins!=P&&typeof D.plugins[O]==x)c=D.plugins[O].description,c&&(typeof D.mimeTypes==P||!D.mimeTypes[M]||!!D.mimeTypes[M].enabledPlugin)&&(q=!0,i=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),a[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),a[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),a[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof k[["Active"].concat("Object").join("X")]!=P)try{var l=new(window[["Active"].concat("Object").join("X")])(L);l&&(c=l.GetVariable("$version"),c&&(i=!0,c=c.split(" ")[1].split(","),a=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(u){}return{w3:e,pv:a,wk:s,ie:i,win:r,mac:n}}();(function(){W.w3&&((typeof F.readyState!=P&&"complete"==F.readyState||typeof F.readyState==P&&(F.getElementsByTagName("body")[0]||F.body))&&e(),V||(typeof F.addEventListener!=P&&F.addEventListener("DOMContentLoaded",e,!1),W.ie&&W.win&&(F.attachEvent(I,function(){"complete"==F.readyState&&(F.detachEvent(I,arguments.callee),e())}),k==top&&function(){if(!V){try{F.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),W.wk&&function(){return V?void 0:/loaded|complete/.test(F.readyState)?void e():void setTimeout(arguments.callee,0)}(),o(e)))})(),function(){W.ie&&W.win&&window.attachEvent("onunload",function(){for(var e=X.length,t=0;e>t;t++)X[t][0].detachEvent(X[t][1],X[t][2]);for(var o=j.length,r=0;o>r;r++)f(j[r]);for(var n in W)W[n]=null;W=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,o,r){if(W.w3&&e&&t){var n={};n.id=e,n.swfVersion=t,n.expressInstall=o,n.callbackFn=r,G[G.length]=n,R(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){return W.w3?i(e):void 0},embedSWF:function(e,o,r,n,s,i,l,u,h,f){var d={success:!1,id:o};W.w3&&!(W.wk&&W.wk<312)&&e&&o&&r&&n&&s?(R(o,!1),t(function(){r+="",n+="";var t={};if(h&&typeof h===x)for(var g in h)t[g]=h[g];t.data=e,t.width=r,t.height=n;var m={};if(u&&typeof u===x)for(var v in u)m[v]=u[v];if(l&&typeof l===x)for(var S in l)typeof m.flashvars!=P?m.flashvars+="&"+S+"="+l[S]:m.flashvars=S+"="+l[S];if(y(s)){var E=p(t,m,o);t.id==o&&R(o,!0),d.success=!0,d.ref=E}else{if(i&&a())return t.data=i,void c(t,m,o,f);R(o,!0)}f&&f(d)})):f&&f(d)},switchOffAutoHideShow:function(){H=!1},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,o){return W.w3?p(e,t,o):void 0},showExpressInstall:function(e,t,o,r){W.w3&&a()&&c(e,t,o,r)},removeSWF:function(e){W.w3&&f(e)},createCSS:function(e,t,o,r){W.w3&&S(e,t,o,r)},addDomLoadEvent:t,addLoadEvent:o,getQueryParamValue:function(e){var t=F.location.search||F.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return E(t);for(var o=t.split("&"),r=0;r<o.length;r++)if(o[r].substring(0,o[r].indexOf("="))==e)return E(o[r].substring(o[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(B){var e=g(N);e&&_&&(e.parentNode.replaceChild(_,e),w&&(R(w,!0),W.ie&&W.win&&(_.style.display="block")),A&&A(b)),B=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var e=window.console;return e&&e.log&&e.error||(e={log:function(){},error:function(){}}),swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,o,r,n){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING,s.bufferedAmount=0,s.__events={},t?"string"==typeof t&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(s.__id,e,t,o||null,r||0,n||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return 0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(e,t,o){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,o){if(e in this.__events)for(var r=this.__events[e],n=r.length-1;n>=0;--n)if(r[n]===t){r.splice(n,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],o=0;o<t.length;++o)t[o](e);var r=this["on"+e.type];r&&r(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if("open"==e.type||"error"==e.type)t=this.__createSimpleEvent(e.type);else if("close"==e.type)t=this.__createSimpleEvent("close");else{if("message"!=e.type)throw"unknown event type: "+e.type;var o=decodeURIComponent(e.message);t=this.__createMessageEvent("message",o)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var o=document.createEvent("MessageEvent");return o.initMessageEvent("message",!1,!1,t,null,null,window,null),o}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var o=document.createElement("div");o.id="webSocketFlash",t.appendChild(o),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var t=WebSocket.__flash.receiveEvents(),o=0;o<t.length;++o)WebSocket.__instances[t[o].webSocketId].__handleEvent(t[o])}catch(r){e.error(r)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename&&e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()})),void 0):void e.error("Flash Player >= 10.0.0 is required.")}}(),function(e,t,o){function r(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function n(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var o=[],r=0,n=e.length;n>r;r++)o.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(o))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=n,s.posting=!1,200==this.status?s.socket.setBuffer(!1):s.onClose())}function r(){this.onload=n,s.socket.setBuffer(!1)}var s=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),o.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=r:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var o=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);if(o.open(e||"GET",this.prepareUrl()+r,!0),"POST"==e)try{o.setRequestHeader?o.setRequestHeader("Content-type","text/plain;charset=UTF-8"):o.contentType="text/plain"}catch(n){}return o},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var n=t.util.request(r),s=o.XDomainRequest&&n instanceof XDomainRequest,i=e&&e.options&&e.options.secure?"https:":"http:",a=o.location&&i!=o.location.protocol;if(n&&(!s||!a))return!0}catch(c){}return!1},r.xdomainCheck=function(e){return r.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function o(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=o,t.util.inherit(o,t.Transport.XHR),o.prototype.name="htmlfile",o.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var o=this,r=t.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+r,t.util.on(window,"unload",function(){o.destroy()})},o.prototype._=function(e,t){this.onData(e);try{var o=t.getElementsByTagName("script")[0];o.parentNode.removeChild(o)}catch(r){}},o.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},o.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},o.check=function(e){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var o=new(window[["Active"].concat("Object").join("X")])("htmlfile");return o&&t.Transport.XHR.check(e)}catch(r){}return!1},o.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,o){function r(){t.Transport.XHR.apply(this,arguments)}function n(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},r.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=n,200==this.status?(s.onData(this.responseText),s.get()):s.onClose())}function t(){this.onload=n,this.onerror=n,s.retryCounter=1,s.onData(this.responseText),s.get()}function r(){s.retryCounter++,!s.retryCounter||s.retryCounter>3?s.onClose():s.get()}if(this.isOpen){var s=this;this.xhr=this.request(),o.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,
this.xhr.onerror=r):this.xhr.onreadystatechange=e,this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=n;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,o){var r=this;t.util.defer(function(){o.call(r)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,o){function r(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var o=this;t.j.push(function(e){o._(e)})}var n=o.document&&"MozAppearance"in o.document.documentElement.style;e["jsonp-polling"]=r,t.util.inherit(r,t.Transport["xhr-polling"]),r.prototype.name="jsonp-polling",r.prototype.post=function(e){function o(){r(),n.socket.setBuffer(!1)}function r(){n.iframe&&n.form.removeChild(n.iframe);try{i=document.createElement('<iframe name="'+n.iframeId+'">')}catch(e){i=document.createElement("iframe"),i.name=n.iframeId}i.id=n.iframeId,n.form.appendChild(i),n.iframe=i}var n=this,s=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var i,a=document.createElement("form"),c=document.createElement("textarea"),l=this.iframeId="socketio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="0px",a.style.left="0px",a.style.display="none",a.target=l,a.method="POST",a.setAttribute("accept-charset","utf-8"),c.name="d",a.appendChild(c),document.body.appendChild(a),this.form=a,this.area=c}this.form.action=this.prepareUrl()+s,r(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(u){}this.iframe.attachEvent?i.onreadystatechange=function(){"complete"==n.iframe.readyState&&o()}:this.iframe.onload=o,this.socket.setBuffer(!0)},r.prototype.get=function(){var e=this,o=document.createElement("script"),r=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),o.async=!0,o.src=this.prepareUrl()+r,o.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(o,s),this.script=o,n&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},r.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},r.prototype.ready=function(e,o){var r=this;return n?void t.util.load(function(){o.call(r)}):o.call(this)},r.check=function(){return"document"in o},r.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define("appenders/../../deps/socket.io.client.js",[],function(){return io})}(),define("appenders/socketappender",["require","../appender","../../deps/socket.io.client.js"],function(e){var t=e("../appender"),o=e("../../deps/socket.io.client.js"),r=function(e){e=e||{},t.call(this,e),this.appendStrings="undefined"!=typeof e.appendStrings?e.appendStrings:!0,this.url=e.url||"http://localhost",this.socket=null};return r.prototype=new t,r.prototype.start=function(e){e=e||function(){};var t=this;return this.isStarted()?e():(this.socket=o.connect(this.url,{"connect timeout":5e3,"max reconnection attempts":5,"try multiple transports":!0,reconnect:!0}),this.socket.on("connect",function(){return t.started=!0,e()}),this.socket.once("connect_failed",function(){return e('No way to establish a socket connection to "'+t.url+'". Ensure the socket server is up and running.')}),void 0)},r.prototype.stop=function(e){e=e||function(){};var t=this;return this.isStarted()?this.socket&&this.socket.connected?(this.socket.once("disconnect",function(){return t.started=!1,t.socket=null,e()}),void this.socket.disconnect()):(this.started=!1,e()):e()},r.prototype.doAppend=function(e){var t=this.getLayout(),o=e.getLevel(),r=null;this.appendStrings?(r=t.toMessageString(e),this.doAppendMessage(o,r)):(e=t.toLogEvent(e),this.doAppendMessage(o,e))},r.prototype.doAppendMessage=function(e,t){"undefined"!=typeof console&&this.socket.emit("log",{level:e,message:t})},r}),define("appenders/nodejs/fileappender",["require","../../appender"],function(e){var t=e("../../appender"),o=e,r=null;try{r="undefined"!=typeof global&&global.process&&global.process.versions&&global.process.versions.node&&"function"==typeof rootRequire?rootRequire("fs"):o("fs")}catch(n){}var s=function(e){e=e||{},t.call(this,e),this.fileName=e.fileName,this.appendToFile="undefined"!=typeof e.append?!!e.append:!0,this.appendStrings="undefined"!=typeof e.appendStrings?e.appendStrings:!0,this.stream=null};return s.prototype=new t,s.prototype.doAppend=function(e){var t=this.getLayout(),o=null;this.appendStrings?o=t.toMessageString(e):(e=t.toLogEvent(e),o=t.compactObjects||t.compact?JSON.stringify(e):JSON.stringify(e,null,2)),"win32"===process.platform&&(o=o.replace(/\n/g,"\r\n")),this.stream.write(o)},s.prototype.start=function(e){return e=e||function(){},this.isStarted()?e():r?(this.stream=r.createWriteStream(this.fileName,{flags:this.appendToFile?"a":"w",encoding:"utf8"}),this.started=!0,e()):e("The File Appender only runs in a Node.js runtime environment")},s.prototype.stop=function(e){e=e||function(){};var t=this;return this.isStarted()?this.stream?void this.stream.end(function(){return t.started=!1,t.stream=null,e()}):(this.started=!1,e()):e()},s}),define("appenders/nodejs/rollingfileappender",["require","../../appender"],function(e){var t=e("../../appender"),o=e,r=null;try{r="undefined"!=typeof global&&global.process&&global.process.versions&&global.process.versions.node&&"function"==typeof rootRequire?rootRequire("fs"):o("fs")}catch(n){}var s=function(e){e=e||{},t.call(this,e),this.fileName=e.fileName,this.triggeringPolicy=e.triggeringPolicy,this.appendStrings="undefined"!=typeof e.appendStrings?e.appendStrings:!0,this.stream=null};return s.prototype=new t,s.prototype.needsRolling=function(){if(this.triggeringPolicy){if(this.triggeringPolicy.size&&this.currentLogSize>this.triggeringPolicy.size)return!0;if(this.triggeringPolicy.time&&this.currentLogDate&&Date.now()-this.currentLogDate>1e3*this.triggeringPolicy.time)return!0}return!1},s.prototype.genFileName=function(){var e=function(e,t,o){return o=o||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(o)+e},t=function(t){return e(t,2)},o=new Date,r=""+o.getFullYear()+"-"+t(o.getMonth()+1)+"-"+t(o.getDate())+"-"+t(o.getHours())+"h"+t(o.getMinutes());this.currentTimestamp&&r===this.currentTimestamp?this.currentTimeStampIdx++:(this.currentTimeStampIdx=0,this.currentTimestamp=r);var n=this.currentTimestamp+"_"+t(this.currentTimeStampIdx)+"_"+this.fileName;return n},s.prototype.createNewlog=function(){this.stream&&this.stream.end(),this.stream=r.createWriteStream(this.genFileName(),{flags:"w",encoding:"utf8"}),this.currentLogSize=0,this.currentLogDate=new Date},s.prototype.doAppend=function(e){var t=this.getLayout(),o=null;this.needsRolling()&&this.createNewlog(),this.appendStrings?o=t.toMessageString(e):(e=t.toLogEvent(e),o=t.compactObjects||t.compact?JSON.stringify(e):JSON.stringify(e,null,2)),"win32"===process.platform&&(o=o.replace(/\n/g,"\r\n")),this.currentLogSize+=Buffer.byteLength(o,"utf8"),this.stream.write(o)},s.prototype.start=function(e){return e=e||function(){},this.isStarted()?e():r?(this.createNewlog(),this.started=!0,e()):e("The File Appender only runs in a Node.js runtime environment")},s.prototype.stop=function(e){e=e||function(){};var t=this;return this.isStarted()?this.stream?void this.stream.end(function(){return t.started=!1,t.stream=null,e()}):(this.started=!1,e()):e()},s}),define("filters/regexfilter",["require","../filter","../utils"],function(e){var t=e("../filter"),o=e("../utils"),r=function(e){t.call(this),e=e||{},this.regex=e.regex||"",o.isString(this.regex)&&(this.regex=new RegExp(this.regex)),this.useRawMsg=!!e.useRawMsg,this.onMatch=e.match||e.onMatch||"neutral",this.onMismatch=e.mismatch||e.onMismatch||"deny"};return r.prototype=new t,r.prototype.filter=function(e){var t="";return t=this.useRawMsg?e.getMessage().getFormat():e.getMessage().getFormattedMessage(),this.regex.test(t)?this.onMatch:this.onMismatch},r}),define("filters/regexloggernamefilter",["require","../filter","../utils"],function(e){var t=e("../filter"),o=e("../utils"),r=function(e){t.call(this),e=e||{},this.regex=e.regex||"",o.isString(this.regex)&&(this.regex=new RegExp(this.regex)),this.onMatch=e.match||e.onMatch||"neutral",this.onMismatch=e.mismatch||e.onMismatch||"deny"};return r.prototype=new t,r.prototype.filter=function(e){var t=e.getLoggerName();return this.regex.test(t)?this.onMatch:this.onMismatch},r}),define("layout",[],function(){var e=function(e,t){this.config=e||{},this.loggerContext=t};return e.prototype.toLogEvent=function(e){return e},e.prototype.toMessageString=function(e){return this.toMessageBits(e).join(" ")},e.prototype.toMessageBits=function(e,t){var o=e.getMessage();return[e.getMillis(),e.getLevel(),e.getLoggerName()].concat(o.getFormattedParams(t))},e}),define("layouts/jsonlayout",["require","../layout","./simpleobjectserializer"],function(e){var t=e("../layout"),o=e("./simpleobjectserializer"),r=function(e,o){e=e||{},t.call(this,e,o),this.compact=e.compact||!1,this.depth=e.depth||2,this.messageAsObject=e.messageAsObject||!1};return r.prototype=new t,r.prototype.toMessageBits=function(e){var t=e.getMessage(),r=this.messageAsObject?this.depth+1:2;t=t?this.messageAsObject?JSON.parse(o(t,this.depth,!0)):t.getFormattedMessage():"";var n={time:e.getMillis(),loggerName:e.getLoggerName(),level:e.getLevel(),message:t};return[o(n,r,this.compact)]},r}),define("layouts/simpledateformat",[],function(){var e=/('[^']*')|(G+|y+|M+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/g,t=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=0,n=1,s=2,i=3,a=4,c=5,l={G:r,y:i,M:a,w:s,W:s,D:s,d:s,F:s,E:n,a:r,H:s,k:s,K:s,h:s,m:s,s:s,S:s,Z:c},u=function(e,t){for(;e.length<t;)e="0"+e;return e},p=function(e,t,o){return t>=4?e:e.substr(0,Math.max(o,t))},h=function(e,t){var o=""+e;return u(o,t)},f=function(e){this.formatString=e};return f.prototype.format=function(f){for(var d,g="",m=this.formatString;d=e.exec(m);){var v=d[1],y=d[2],S=d[3],R=d[4];if(v)g+="''"===v?"'":v.substring(1,v.length-1);else if(!S)if(R)g+=R;else if(y){var E=y.charAt(0),_=y.length,w="";switch(E){case"G":w="AD";break;case"y":w=f.getFullYear();break;case"M":w=f.getMonth();break;case"d":w=f.getDate();break;case"F":w=1+Math.floor((f.getDate()-1)/7);break;case"E":w=o[f.getDay()];break;case"a":w=f.getHours()>=12?"PM":"AM";break;case"H":w=f.getHours();break;case"k":w=f.getHours()||24;break;case"K":w=f.getHours()%12;break;case"h":w=f.getHours()%12||12;break;case"m":w=f.getMinutes();break;case"s":w=f.getSeconds();break;case"S":w=f.getMilliseconds();break;case"Z":w=f.getTimezoneOffset()}switch(l[E]){case r:g+=p(w,_,2);break;case n:g+=p(w,_,3);break;case s:g+=h(w,_);break;case i:if(3>=_){var A=""+w;g+=A.substr(2,2)}else g+=h(w,_);break;case a:g+=_>=3?p(t[w],_,_):h(w+1,_);break;case c:var b=w>0,T=b?"-":"+",C=Math.abs(w),P=""+Math.floor(C/60);P=u(P,2);var x=""+C%60;x=u(x,2),g+=T+P+x}}}return g},f}),define("layouts/patternlayout",["require","../utils","../layout","./simpledateformat"],function(e){var t=e("../utils"),o=e("../layout"),r=e("./simpledateformat"),n={absolute:"HH:mm:ss,SSS",compact:"yyyyMMddHHmmssSSS",date:"dd MMM yyyy HH:mm:ss,SSS",iso8601:"yyyy-MM-dd HH:mm:ss,SSS",iso8601_basic:"yyyy-MM-DD HHmmss,SSS"},s={trace:37,log:30,info:36,warn:33,error:31},i=function(e,t){o.call(this,e,t),this.pattern=this.config.pattern||i.DEFAULT_CONVERSION_PATTERN,this.compactObjects=this.config.compactObjects||!1};return i.prototype=new o,i.DEFAULT_CONVERSION_PATTERN="%m%n",i.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",i.SIMPLE_CONVERSION_PATTERN="%d %p %c - %m%n",i.prototype.toMessageBits=function(e,t){return this.formatLogEvent(e,this.pattern,t)},i.prototype.formatLogEvent=function(e,o,i){var a=[],c="",l=[],u={matched:"",padding:"",truncation:"",pattern:"",params:"",text:""},p="",h=0,f=[],d="",g=0,m=0,v="",y=null;i=i||{};for(var S=/%(-?[0-9]+)?(\.?[0-9]+)?(logger|date|domain|highlight|message|level|relative|[cdhmnpr%])(?:\{([^\}]+)\})?|([^%]+)/g;l=S.exec(o);)if(u.matched=l[0],u.padding=l[1],u.truncation=l[2],u.pattern=l[3],u.params=l[4],u.text=l[5],d="",u.text)c+=u.text;else{switch(u.pattern){case"logger":case"c":p=e.getLoggerName(),u.params?(h=parseInt(u.params,10),f=p.split("."),d=h>=f.length?p:f.slice(f.length-h).join(".")):d=p;break;case"date":case"d":v=u.params||"ISO8601","ISO8601"===v?v=n.iso8601:"ABSOLUTE"===v?v=n.absolute:"COMPACT"===v?v=n.compact:"DATE"===v?v=n.date:"ISO8601_BASIC"===v&&(v=n.iso8601_basic),y=new Date(e.getMillis()),d=new r(v).format(y);break;case"domain":if(p=u.params||"id","undefined"!=typeof process)if(process.domain){for(p=p.split("."),d=process.domain;d&&p.length>0;)d=d[p.shift()];d=d||"anonymous"}else d="global";else d="unknown";t.isFunction(d)&&(d=d());break;case"highlight":case"h":p=u.params||"",d="["+(s[e.getLevel()]||0)+"m"+this.formatLogEvent(e,p)+"[0m";break;case"message":case"m":d=i.preserveObjects?e.getMessage().getFormattedParams({separator:u.params,compactObjects:this.compactObjects,preserveObjects:!0}):e.getMessage().getFormattedMessage({separator:u.params,compactObjects:this.compactObjects});break;case"n":d="\n";break;case"level":case"p":d=e.getLevel();break;case"relative":case"r":h=e.getMillis()-this.loggerContext.getStartTime(),d=""+h;break;case"%":d="%";break;default:d=u.matched}if(t.isArray(d))c&&(t.isString(d[0])&&(c+=d[0],d=d.slice(1)),a.push(c),c=""),d.length>0&&(a=a.concat(d));else{if(u.truncation&&(h=parseInt(u.truncation.substr(1),10),m=d.length,m>h&&(d=d.substring(m-h,m))),u.padding)if("-"===u.padding.charAt(0))for(m=parseInt(u.padding.substr(1),10),g=d.length;m>g;g++)d+=" ";else{for(m=parseInt(u.padding,10),p="",g=d.length;m>g;g++)p+=" ";d=p+d}c+=d}}return c&&a.push(c),a},i}),define("woodman",["require","./logmanager","./appenders/consoleappender","./appenders/socketappender","./appenders/nodejs/fileappender","./appenders/nodejs/rollingfileappender","./filters/regexfilter","./filters/regexloggernamefilter","./layout","./layouts/jsonlayout","./layouts/patternlayout"],function(e){var t=e("./logmanager"),o=e("./appenders/consoleappender"),r=e("./appenders/socketappender"),n=e("./appenders/nodejs/fileappender"),s=e("./appenders/nodejs/rollingfileappender"),i=e("./filters/regexfilter"),a=e("./filters/regexloggernamefilter"),c=e("./layout"),l=e("./layouts/jsonlayout"),u=e("./layouts/patternlayout");return t.registerAppender("console",o),t.registerAppender("Console",o),t.registerAppender("ConsoleAppender",o),t.registerAppender("file",n),t.registerAppender("File",n),t.registerAppender("FileAppender",n),t.registerAppender("rollingfile",s),t.registerAppender("RollingFile",s),t.registerAppender("RollingFileAppender",s),t.registerAppender("socket",r),t.registerAppender("Socket",r),t.registerAppender("SocketAppender",r),t.registerFilter("regex",i),t.registerFilter("RegexFilter",i),t.registerFilter("regexloggername",a),t.registerFilter("RegexLoggerNameFilter",a),t.registerLayout("default",c),t.registerLayout("json",l),t.registerLayout("JSONLayout",l),t.registerLayout("pattern",u),t.registerLayout("PatternLayout",u),t.registerStandardLevels(),t});var woodman=null;return require(["./woodman"],function(e){woodman=e},null,!0),woodman}()}("function"==typeof require?require:null),loggerCfg={loggers:[{root:!0,level:"all",appenders:[{type:"Console",layout:{type:"PatternLayout",pattern:"%d{yyyy-MM-dd HH:mm:ss} [%p] %c - %m%n"}}]}]},UtilsLoggerByDefault=function(e,t){var o={getLogger:function(o){e.load(t,function(e){if(e)throw e});var r=o||"default";return e.getLogger(r)}};return o}(log4js,loggerCfg),UtilsMessagesResources=function(){var e={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(e,t){if(!arguments)return"Message indefined !";var o=Array.prototype.slice.call(arguments),r=o.shift(),n=o,s=this[r];try{s=Array.isArray(n)&&n.length>0?s.replace("%var%",n.join(" - ")):s.replace("%var%","%var% (not specified)")}catch(i){}return s}};return e}(),ExceptionsErrorService=function(){function e(t){if(!(this instanceof e))throw new TypeError("ErrorService constructor cannot be called as a function.");var o=t;"string"==typeof t||t instanceof String?(this.message=t,this.status=-1,this.type=e.TYPE_UNKERR):(this.message=o.message||"undefined!?",this.type=o.type,this.status=o.status||-1),this.name="ErrorService",this.stack=(new Error).stack}return e.TYPE_SRVERR="SERVICE_ERROR",e.TYPE_USEERR="USAGE_ERROR",e.TYPE_UNKERR="UNKNOWN_ERROR",e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e}(),UtilsHelper=function(){var e={normalyzeParameters:function(e){var t=null;if(e){var o=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];n||(n=""),o.push(r+"="+n)}t=o.join("&")}return t},normalyzeUrl:function(e,t,o){var r=e;if(e){var n=e.indexOf("?");-1===n&&(r+="?"),-1!==n&&n!==e.length-1&&(r+="&")}return t&&(r+="string"==typeof t?t:this.normalyzeParameters(t)),o&&(r=encodeURIComponent(r)),r},indent:function(e,t){var o=e||0;return new Array(o+1).join("	")+t}};return e}(),function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function r(e){j=e}function n(e){H=e}function s(){return function(){process.nextTick(u)}}function i(){return function(){G(u)}}function a(){var e=0,t=new z(u),o=document.createTextNode("");return t.observe(o,{characterData:!0}),function(){o.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=u,function(){e.port2.postMessage(0)}}function l(){return function(){setTimeout(u,1)}}function u(){for(var e=0;B>e;e+=2){var t=$[e],o=$[e+1];t(o),$[e]=void 0,$[e+1]=void 0}B=0}function p(){try{var e=require,t=e("vertx");return G=t.runOnLoop||t.runOnContext,i()}catch(o){return l()}}function h(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function d(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(t){return te.error=t,te}}function m(e,t,o,r){try{e.call(t,o,r)}catch(n){return n}}function v(e,t,o){H(function(e){var r=!1,n=m(o,t,function(o){r||(r=!0,t!==o?R(e,o):_(e,o))},function(t){r||(r=!0,w(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&n&&(r=!0,w(e,n))},e)}function y(e,t){t._state===Z?_(e,t._result):t._state===ee?w(e,t._result):A(t,void 0,function(t){R(e,t)},function(t){w(e,t)})}function S(e,o){if(o.constructor===e.constructor)y(e,o);else{var r=g(o);r===te?w(e,te.error):void 0===r?_(e,o):t(r)?v(e,o,r):_(e,o)}}function R(t,o){t===o?w(t,f()):e(o)?S(t,o):_(t,o)}function E(e){e._onerror&&e._onerror(e._result),b(e)}function _(e,t){e._state===Q&&(e._result=t,e._state=Z,0!==e._subscribers.length&&H(b,e))}function w(e,t){e._state===Q&&(e._state=ee,e._result=t,H(E,e))}function A(e,t,o,r){var n=e._subscribers,s=n.length;e._onerror=null,n[s]=t,n[s+Z]=o,n[s+ee]=r,0===s&&e._state&&H(b,e)}function b(e){var t=e._subscribers,o=e._state;if(0!==t.length){for(var r,n,s=e._result,i=0;i<t.length;i+=3)r=t[i],n=t[i+o],r?P(o,r,n,s):n(s);e._subscribers.length=0}}function T(){this.error=null}function C(e,t){try{return e(t)}catch(o){return oe.error=o,oe}}function P(e,o,r,n){var s,i,a,c,l=t(r);if(l){if(s=C(r,n),s===oe?(c=!0,i=s.error,s=null):a=!0,o===s)return void w(o,d())}else s=n,a=!0;o._state!==Q||(l&&a?R(o,s):c?w(o,i):e===Z?_(o,s):e===ee&&w(o,s))}function x(e,t){try{t(function(t){R(e,t)},function(t){w(e,t)})}catch(o){w(e,o)}}function O(e,t){var o=this;o._instanceConstructor=e,o.promise=new e(h),o._validateInput(t)?(o._input=t,o.length=t.length,o._remaining=t.length,o._init(),0===o.length?_(o.promise,o._result):(o.length=o.length||0,o._enumerate(),0===o._remaining&&_(o.promise,o._result))):w(o.promise,o._validationError())}function L(e){return new re(this,e).promise}function M(e){function t(e){R(n,e)}function o(e){w(n,e)}var r=this,n=new r(h);if(!V(e))return w(n,new TypeError("You must pass an array to race.")),n;for(var s=e.length,i=0;n._state===Q&&s>i;i++)A(r.resolve(e[i]),void 0,t,o);return n}function N(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var o=new t(h);return R(o,e),o}function I(e){var t=this,o=new t(h);return w(o,e),o}function k(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function D(e){this._id=ce++,this._state=void 0,this._result=void 0,this._subscribers=[],h!==e&&(t(e)||k(),this instanceof D||F(),x(this,e))}function q(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var o=e.Promise;(!o||"[object Promise]"!==Object.prototype.toString.call(o.resolve())||o.cast)&&(e.Promise=le)}var U;U=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var G,j,X,V=U,B=0,H=({}.toString,function(e,t){$[B]=e,$[B+1]=t,B+=2,2===B&&(j?j(u):X())}),W="undefined"!=typeof window?window:void 0,Y=W||{},z=Y.MutationObserver||Y.WebKitMutationObserver,K="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),J="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3);X=K?s():z?a():J?c():void 0===W&&"function"==typeof require?p():l();var Q=void 0,Z=1,ee=2,te=new T,oe=new T;O.prototype._validateInput=function(e){return V(e)},O.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},O.prototype._init=function(){this._result=new Array(this.length)};var re=O;O.prototype._enumerate=function(){for(var e=this,t=e.length,o=e.promise,r=e._input,n=0;o._state===Q&&t>n;n++)e._eachEntry(r[n],n)},O.prototype._eachEntry=function(e,t){var r=this,n=r._instanceConstructor;o(e)?e.constructor===n&&e._state!==Q?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(n.resolve(e),t):(r._remaining--,r._result[t]=e)},O.prototype._settledAt=function(e,t,o){var r=this,n=r.promise;n._state===Q&&(r._remaining--,e===ee?w(n,o):r._result[t]=o),0===r._remaining&&_(n,r._result)},O.prototype._willSettleAt=function(e,t){var o=this;A(e,void 0,function(e){o._settledAt(Z,t,e)},function(e){o._settledAt(ee,t,e)})};var ne=L,se=M,ie=N,ae=I,ce=0,le=D;D.all=ne,D.race=se,D.resolve=ie,D.reject=ae,D._setScheduler=r,D._setAsap=n,D._asap=H,D.prototype={constructor:D,then:function(e,t){var o=this,r=o._state;if(r===Z&&!e||r===ee&&!t)return this;var n=new this.constructor(h),s=o._result;if(r){var i=arguments[r-1];H(function(){P(r,n,i,s)})}else A(o,n,e,t);return n},"catch":function(e){return this.then(null,e)}};var ue=q,pe={Promise:le,polyfill:ue};promise=function(){return pe}(),ue()}.call(this),ProtocolsXHR=function(e,t,o){var r={call:function(t){var r=e.getLogger("XHR");if(r.trace("[XHR::call()]"),o.polyfill(),!t.url)throw new Error("missing parameter : url is not defined !");if(!t.method)throw new Error("missing parameter : method is not defined !");t.format||(t.format="text");var n={};switch(n.url=t.url,n.data=t.data?t.data:null,n.method=t.method,n.timeOut=t.timeOut||0,t.method){case"GET":break;case"POST":n.content=t.content?t.content:"application/x-www-form-urlencoded",n.headers=t.headers?t.headers:{referer:"http://localhost"};break;case"DELETE":case"PUT":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(t.format){case"text":this.__call(n).then(function(e){r.trace(e),t.onResponse.call(this,e)})["catch"](function(e){t.onFailure.call(this,e)});break;case"json":this.__callJSON(n).then(function(e){r.trace(e),t.onResponse.call(this,e)})["catch"](function(e){t.onFailure.call(this,e)});break;case"xml":this.__callXML(n).then(function(e){r.trace(e),t.onResponse.call(this,e)})["catch"](function(e){t.onFailure.call(this,e)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(o){var r=e.getLogger("XHR");r.trace("[XHR::__call()]");var n=new Promise(function(e,n){o.data&&"GET"==o.method&&(o.url=t.normalyzeUrl(o.url,o.data)),r.trace("URL = ",o.url);var s=null;if(window.XDomainRequest){r.trace("XDomainRequest"),s=new XDomainRequest,s.open(o.method,o.url),s.overrideMimeType=o.content,o.timeOut>0&&(s.timeout=o.timeout,r.trace("XHR - TimeOut actif !")),"GET"!==o.method&&s.setRequestHeader("Content-type",o.content),s.onerror=function(){n(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},s.ontimeout=function(){n(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},s.onload=function(){if(200==s.status)e(s.response);else{var t="Errors Occured on Http Request (status : '"+s.status+"' | response : '"+s.response+"')",o=s.status;n({message:t,status:o})}};var i=o.data&&"POST"==o.method?o.data:null;s.send(i)}else{if(!window.XMLHttpRequest)throw new Error("CORS not supported");r.trace("XMLHttpRequest"),s=new XMLHttpRequest,s.open(o.method,o.url,!0),s.overrideMimeType=o.content;var a=null;o.timeOut>0&&(r.trace("XHR - TimeOut actif !"),a=window.setTimeout(function(){var e="TimeOut Occured on Http Request with XMLHttpRequest !";n({message:e,status:-1})},o.timeOut)),"GET"!==o.method&&(r.trace("data = ",o.data),s.setRequestHeader("Content-type",o.content)),s.onerror=function(e){console.log(e),n(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},s.ontimeout=function(){n(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},s.onreadystatechange=function(){if(4==s.readyState)if(200==s.status)window.clearTimeout(a),e(s.response);else{var t="Errors Occured on Http Request (status : '"+s.status+"' | response : '"+s.response+"')",o=s.status;n({message:t,status:o})}};var c=o.data&&"POST"==o.method?o.data:null;s.send(c)}});return n},__callJSON:function(e){return this.__call(e).then(JSON.parse)["catch"](function(t){throw console.log("_callJSON failed on : ",e.url,t),t})},__callXML:function(e){return this.__call(e).then(function(e){var t;if(window.DOMParser){var o=new DOMParser;t=o.parseFromString(e,"text/xml")}else t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e);return t})["catch"](function(t){throw console.log("__callXML failed on : ",e.url,t),t})}};return r}(UtilsLoggerByDefault,UtilsHelper,promise),ProtocolsJSONP=function(e){var t={call:function(t){var o=e.getLogger("JSONP");if(o.trace("[JSONP::call()]"),!t)throw o.error("missing parameter : options !"),new Error("missing parameter : options !");if(!t.url)throw o.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(t.timeOut||(o.info("setting 'options.timeOut' default value"),t.timeOut=0),!t.onResponse)throw o.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var r=!1,n=!1,s=t.url.indexOf("callback=");if(-1!=s){r=!0;var i=t.url.indexOf("&",s);-1===i&&(i=t.url.length);var a=t.url.substring(s+9,i);a&&(n=!0,t.callbackName=a,o.info("setting 'options.callbackName' value ("+t.callbackName+") from 'options.url' parameter"))}if(!r){var c=t.url.indexOf("?");-1===c?t.url=t.url+"?callback=":c===t.url.length?t.url=t.url+"callback=":t.url=t.url+"&callback=",o.info("setting callback default key in 'options.url' : "+t.url)}var l=t.callbackName?!0:n;if(n||(t.callbackName||(o.info("setting 'options.callbackName' default value"),t.callbackName="callback"),t.url=t.url.replace("callback=","callback="+t.callbackName),o.info("setting callback function name in 'options.url' : "+t.url)),t.onTimeOut||(o.info("setting 'options.onTimeOut' default value"),t.onTimeOut=function(){console.log("TimeOut while invoking url : "+t.url)}),!l){var u=null;t.timeOut>0&&(u=window.setTimeout(function(){window[t.callbackName]=function(){},t.onTimeOut()},t.timeOut)),window[t.callbackName]=function(e){window.clearTimeout(u),t.onResponse(e)}}var p,h=document.getElementById("results");p=document.createElement("script"),p.setAttribute("type","text/javascript"),p.setAttribute("src",t.url),p.setAttribute("charset","UTF-8"),p.setAttribute("id","results"),p.setAttribute("async","true");var f=document.documentElement||document.getElementsByTagName("head")[0];null===h?f.appendChild(p):f.replaceChild(p,h)}};return t}(UtilsLoggerByDefault),ProtocolsProtocol=function(e,t,o){var r={send:function(r){var n=r||{method:"GET",protocol:"JSONP",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null};if("XHR"===r.protocol||"json"===r.format?n.wrap=!1:"JSONP"===r.protocol&&"xml"===r.format&&(n.wrap=!0),n.callback=("JSONP"==r.protocol,null),n.output=n.wrap?"json":null,n.wrap){var s={};s.output=n.output,s.callback=n.callback,delete s.callback,n.url=e.normalyzeUrl(r.url,s)}switch(n.protocol){case"XHR":"GET"===r.method&&r.nocache&&(n.url=e.normalyzeUrl(n.url,{t:(new Date).getTime()})),t.call(n);break;case"JSONP":n.data&&(n.url=e.normalyzeUrl(n.url,n.data)),o.call(n);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}};return r}(UtilsHelper,ProtocolsXHR,ProtocolsJSONP),ServicesDefaultUrlService=function(){var e="http://",t="wxs.ign.fr",o="%KEY%",r=e+t.concat("/",o),n=function(e){return this._key.replace(e?o:null,e)},s={Alti:{_key:{"elevation-json":r+"/alti/rest/elevation.json","elevation-xml":r+"/alti/rest/elevation.xml","profil-json":r+"/alti/rest/elevationLine.json","profil-xml":r+"/alti/rest/elevationLine.xml",wps:r+"/alti/wps"},url:function(e){return{"elevation-json":this._key["elevation-json"].replace(e?o:null,e),"elevation-xml":this._key["elevation-xml"].replace(e?o:null,e),"profil-json":this._key["profil-json"].replace(e?o:null,e),"profil-xml":this._key["profil-xml"].replace(e?o:null,e),wps:this._key.wps.replace(e?o:null,e)}}},ProcessIsoCurve:{_key:{"iso-json":r+"/isochrone/isochrone.json","iso-xml":r+"/isochrone/isochrone.xml"},url:function(e){return{"iso-json":this._key["iso-json"].replace(e?o:null,e),"iso-xml":this._key["iso-xml"].replace(e?o:null,e)}}},AutoComplete:{_key:r+"/ols/apis/completion",url:n},ReverseGeocode:{_key:r+"/geoportail/ols",url:n},AutoConf:{_key:{apiKey:r+"/autoconf",apiKeys:r+"/autoconf?keys=%KEYS%"},url:function(r){var n="";if(Array.isArray(r)&&r.length>0){n=r[0];for(var s=1;s<r.length;s++)n+=","+r[s];
}return{apiKey:this._key.apiKey.replace(r?o:null,r),apiKeys:this._key.apiKeys.replace(o,r[0]).replace("%KEYS%",n),aggregate:e+t.concat("/")+r+"/autoconf/id/"}}},Geocode:{_key:r+"/geoportail/ols",url:n},Route:{_key:{ols:r+"/itineraire/ols","route-json":r+"/itineraire/rest/route.json","route-xml":r+"/itineraire/rest/route.xml"},url:function(e){return{ols:this._key.ols.replace(e?o:null,e),"route-json":this._key["route-json"].replace(e?o:null,e),"route-xml":this._key["route-xml"].replace(e?o:null,e)}}}};return s}(),ServicesCommonService=function(e,t,o,r,n,s){function i(t){if(!(this instanceof i))throw new TypeError(o.getMessage("CLASS_CONSTRUCTOR"));this.logger=e.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"JSONP",proxyURL:"",httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(e){console.log("onSuccess - la reponse est la suivante : ",e)},onFailure:function(e){200!==e.status&&e.status?console.log("onFailure - Erreur (",e.status,") : ",e.message):console.log("onFailure : ",e.message)}};for(var r in t)t.hasOwnProperty(r)&&(this.options[r]=t[r]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(o.getMessage("PARAM_MISSING","apiKey","serverUrl"));this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(e){console.log("onSuccess - la réponse brute du service est la suivante : ",e)});var n=null!==this.options.onSuccess&&"function"==typeof this.options.onSuccess?!0:!1;if(!n)throw new Error(o.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){var a=s[this.CLASSNAME].url(this.options.apiKey);"string"==typeof a?this.options.serverUrl=a:this.logger.trace("URL par defaut à determiner au niveau du composant...")}if(this.options.serverUrl){var c=this.options.serverUrl,l=c.split("?");this.options.serverUrl=l[0]}switch(this.options.httpMethod="string"==typeof t.httpMethod?t.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(o.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(o.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol="string"==typeof t.protocol?t.protocol.toUpperCase():"JSONP",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(o.getMessage("PARAM_UNKNOWN","protocol"))}"JSONP"===this.options.protocol&&(this.options.httpMethod="GET"),this.options.nocache=t.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}return i.prototype={constructor:i,call:function(){function e(){this.logger.trace("CommonService::run()"),this.buildRequest.call(this,s,t)}function t(e){this.logger.trace("CommonService::onBuildRequest : ",e),this.callService.call(this,s,o)}function o(e){this.logger.trace("CommonService::onCallService : ",e),this.analyzeResponse.call(this,s,r)}function r(e){return this.logger.trace("CommonService::onAnalyzeResponse : ",e),e?void this.options.onSuccess.call(this,e):s.call(this,new n("Analyse de la reponse en échec !?"))}function s(e){this.logger.trace("CommonService::onError()");var t=e;t instanceof n||(t=new n(e.message)),this.options.onFailure.call(this,t)}this.logger.trace("CommonService::call()"),e.call(this)},buildRequest:function(e,t){this.logger.error("overwritten method !")},callService:function(e,o){var s=null,i=this.request,a=this.options.proxyURL&&"XHR"===this.options.protocol?!0:!1;a&&("GET"===this.options.httpMethod&&(s=this.options.proxyURL+t.normalyzeUrl(this.options.serverUrl,this.request,!0),i=null),"POST"===this.options.httpMethod&&(s=this.options.proxyURL+t.normalyzeUrl(this.options.serverUrl,null,!0),i=this.request));var c=this,l={url:s||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:"XHR"===this.options.protocol?!1:!0,data:i,headers:null,content:null,scope:this.options.scope||this,onResponse:function(t){c.logger.trace("callService::onResponse()");var r=null;if("XHR"==c.options.protocol&&(r=t),"JSONP"==c.options.protocol){if(c.logger.trace("Response JSON",t),!t)return void e.call(c,new n("Le contenu de la reponse est vide !?"));if(t.http){if(200!==t.http.status)return void e.call(c,new n({status:t.http.status,message:t.http.error,type:n.TYPE_SRVERR}));r=t.xml}else r=t}c.response=r,o.call(c,r)},onFailure:function(t){c.logger.trace("callService::onFailure()"),t.type=n.TYPE_SRVERR,e.call(c,new n(t))},onTimeOut:function(){c.logger.trace("callService::onTimeOut()"),e.call(c,new n("TimeOut!"))}};r.send(l)},analyzeResponse:function(e,t){this.logger.error("overwritten method !")}},i}(UtilsLoggerByDefault,UtilsHelper,UtilsMessagesResources,ProtocolsProtocol,ExceptionsErrorService,ServicesDefaultUrlService),ServicesAltiRequestModelAltiRequest=function(e){function t(o){if(!(this instanceof t))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=e.getLogger(),this.logger.trace("[Constructeur AltiRequest()]"),this.options=o||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}return t.CLASSNAME="AltiRequest",t.prototype={constructor:t,setPositions:function(e){for(var t=[],o=0;o<e.length;o++){var r=e[o];r.lon&&r.lat&&t.push(r)}this.positions=t},getPositions:function(e){if(!e)return this.positions;var t=this.positions.length-1;return e>t||t>e?(this.logger.warn("index out of range !"),this.positions):this.positions[e]},addPositions:function(e){for(var t=0;t<e.length;t++){var o=e[t];o.lon&&o.lat&&this.positions.push(e[t])}},getLon:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t].lon);return this.logger.trace(e),e.join(this.delimiter)},getLat:function(){for(var e=[],t=0;t<this.positions.length;t++)e.push(this.positions[t].lat);return this.logger.trace(e),e.join(this.delimiter)}},t.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"delimiter",v:this.delimiter}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"format",v:this.format}),e},t}(UtilsLoggerByDefault),ServicesAltiRequestModelAltiElevationRequest=function(e,t){function o(e){if(!(this instanceof o))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",t.apply(this,arguments),this.logger.trace("[Constructeur AltiElevationRequest()]"),this.zonly=this.options.zonly||!1}return o.prototype=Object.create(t.prototype,{zonly:{get:function(){return this._zonly},set:function(e){this._zonly=e}}}),o.prototype.constructor=o,o.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"zonly",v:this.zonly}),e.push({k:"format",v:this.format}),e},o}(UtilsLoggerByDefault,ServicesAltiRequestModelAltiRequest),ServicesAltiRequestModelAltiProfilRequest=function(e,t){function o(e){if(!(this instanceof o))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",t.apply(this,arguments),this.logger.trace("[Constructeur AltiProfilRequest()]"),this.sampling=this.options.sampling||3}return o.prototype=Object.create(t.prototype,{sampling:{get:function(){return this._sampling},set:function(e){this._sampling=e}}}),o.prototype.constructor=o,o.prototype.getData=function(){var e=[];return e.push({k:"lon",v:this.getLon()}),e.push({k:"lat",v:this.getLat()}),e.push({k:"indent",v:this.indent}),e.push({k:"crs",v:this.crs}),e.push({k:"sampling",v:this.sampling}),e.push({k:"format",v:this.format}),e},o}(UtilsLoggerByDefault,ServicesAltiRequestModelAltiRequest),ServicesAltiRequestAltiRequestREST=function(e,t,o,r){function n(s){if(this.logger=e.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST()]"),!(this instanceof n))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=s||{},!this.options)throw new Error(t.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(t.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new o(this.options.param);break;case"Profil":this.DataObject=new r(this.options.param);break;default:throw new Error(t.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}return n.prototype={requestString:null,constructor:n,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:"lon=__LON__\nlat=__LAT__\nindent=__INDENT__\ncrs='__CRS__'\n",input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString()");var e="";return"POST"==this.method?e=this.template.post.value:"GET"==this.method&&(e=this.template.get.value),e=e.replace(/__LON__/g,this.DataObject.getLon()),e=e.replace(/__LAT__/g,this.DataObject.getLat()),e=e.replace(/__INDENT__/g,this.DataObject.indent),e=e.replace(/__CRS__/g,this.DataObject.crs),e+=this.__addDataInputs(),this.logger.trace("traduction tmpl",e),this.requestString=e,this.requestString},__addDataInputs:function(){this.logger.trace("AltiRequestREST::addDataInput()");var e;if("POST"==this.method)e=this.template.post;else{if("GET"!=this.method)throw new Error("No other HTTP method supported by the service !");e=this.template.get}var t=null;if("AltiElevationRequest"==this.DataObject.CLASSNAME)return t=e.input.point,t.replace(/__ZONLY__/g,this.DataObject.zonly);if("AltiProfilRequest"==this.DataObject.CLASSNAME)return t=e.input.profil,t.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}},n}(UtilsLoggerByDefault,UtilsMessagesResources,ServicesAltiRequestModelAltiElevationRequest,ServicesAltiRequestModelAltiProfilRequest),FormatsWPS=function(e){function t(o){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof t))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=o||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}return t.prototype={requestString:null,constructor:t,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?>\n<wps:__REQUEST__ version="__VERSION__" service="__SERVICE__"\n	__NAMESPACE__ __SCHEMALOCATION__>\n	<ows:Identifier>__IDENTIFIER__</ows:Identifier>\n	<wps:DataInputs>\n<!-- __DATAINPUTS__ -->\n	</wps:DataInputs>\n	<wps:ResponseForm>\n		<wps:RawDataOutput>\n		<ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier>\n		</wps:RawDataOutput>\n	</wps:ResponseForm>\n</wps:__REQUEST__>\n',input:"		<wps:Input>\n			<ows:Identifier>__KEY__</ows:Identifier>\n			<wps:Data>\n				<wps:LiteralData>__DATA__</wps:LiteralData>\n			</wps:Data>\n		</wps:Input>"}},namespaceByDefault:function(){var e=['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'];return e.join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString()");var e="";if("POST"==this.method)e=this.template.post.value;else{if("GET"!=this.method)return this.logger.error("No other method supported by the service !"),!1;e=this.template.get.value}return e=e.replace(/__SERVICE__/g,this.paramservice),e=e.replace(/__VERSION__/g,this.paramversion),e=e.replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput),e=e.replace(/__IDENTIFIER__/g,this.paramidentifier),e=e.replace(/__REQUEST__/g,this.paramrequest),"POST"==this.method&&(e=e.replace(/__NAMESPACE__/g,this.namespaceByDefault),e=e.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(e=e.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=e,this.logger.trace("traduction tmpl",e),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs()");for(var e="GET"==this.method?this.template.get.input:this.template.post.input,t="GET"==this.method?";":"",o="",r=this,n=this.DataObject.getData(),s=0;s<n.length;s++)!function(s){t&&(t=s==n.length-1?"":";"),o=o.concat(r.__addDataInput(e,n[s].k,n[s].v),t)}(s);return o},__addDataInput:function(e,t,o){var r=e;return r=r.replace(/__KEY__/g,t),r=r.replace(/__DATA__/g,o)},setMethod:function(e){"GET"==e||"POST"==e?this.method=e:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}},t}(UtilsLoggerByDefault),ServicesAltiRequestAltiRequestWPS=function(e,t,o,r,n){var s={build:function(s){var i=e.getLogger("AltiRequestWPS");if(i.trace(["AltiRequestWPS::build()"]),!s)throw new Error(t.getMessage("PARAM_EMPTY","options"));if(!s.type)throw new Error(t.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var a=null;switch(s.type){case"Elevation":s.wps.identifier="gs:WPSElevation",a=new r(s.param);break;case"Profil":s.wps.identifier="gs:WPSLineElevation",a=new n(s.param);break;default:throw new Error(t.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var c={data:a,method:s.method,param:s.wps},l=new o(c);if(!l.processRequestString())throw new Error("Enable to process request !");return l.requestString}};return s}(UtilsLoggerByDefault,UtilsMessagesResources,FormatsWPS,ServicesAltiRequestModelAltiElevationRequest,ServicesAltiRequestModelAltiProfilRequest),ServicesAltiRequestAltiRequestFactory=function(e,t,o,r){var n={build:function(n){var s=e.getLogger("AltiRequestFactory");s.trace(["AltiRequestFactory::build()"]);var i=null,a={type:n.sampling?"Profil":"Elevation",method:n.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};a.param.positions=n.positions,a.param.format=n.outputFormat,a.param.sampling=n.sampling,a.param.zonly=n.zonly;var c=null!==n.onError&&"function"==typeof n.onError?!0:!1,l=null!==n.onSuccess&&"function"==typeof n.onSuccess?!0:!1,u=null;switch(n.api){case"REST":var p=new o(a);if(!p.processRequestString()){if(u="Error in process request (rest) !",c)return void n.onError.call(n.scope,new t(u));throw new Error(u)}i=p.requestString;break;case"WPS":if(a.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},i=r.build(a),!i){if(u="Error in process request (wps) !",c)return void n.onError.call(n.scope,new t(u));throw new Error(u)}break;default:if(u="Type of API is not supported by service (REST or WPS) !",c)return void n.onError.call(n.scope,new t(u));throw new Error(u)}return l&&n.onSuccess.call(n.scope,i),i}};return n}(UtilsLoggerByDefault,ExceptionsErrorService,ServicesAltiRequestAltiRequestREST,ServicesAltiRequestAltiRequestWPS),FormatsXML=function(e){function t(r){if(!(this instanceof t))throw new TypeError("XML constructor cannot be called as a function.");this.logger=e.getLogger(),this.logger.trace("[Constructeur XML()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,r&&(r.xmlString&&"string"==typeof r.xmlString&&(this.xmlString=r.xmlString,this.xmlDoc=o(r.xmlString)),r.reader&&this.setReader(r.reader))}function o(e){if("object"==typeof exports){var t=xmldom.DOMParser;return(new t).parseFromString(e,"text/xml")}var o,r,n="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){r=new window.ActiveXObject("Microsoft.XMLDOM"),r.async=!1,r.loadXML(e);var s=r.parseError;if(s.errorCode)throw s.line&&s.linepos&&(n+="( ligne "+s.line+", colonne "+s.linepos),s.reason&&(n+=":  "+s.reason+")"),new Error(n);return r}if(window.DOMParser){o=new window.DOMParser;try{r=o.parseFromString(e,"text/xml")}catch(i){throw"SyntaxError"===i.message?new Error(n):new Error("Erreur lors du parsing de la réponse du service : "+i.message)}if(r.getElementsByTagName("parsererror").length>0)for(var a=r.getElementsByTagName("parsererror"),c=0;c<a.length;c++){var l=a[c].innerHTML;if(-1==l.indexOf("Huge input lookup"))throw n+="("+l+")",new Error(n)}else if(!r.documentElement)throw new Error(n);return r}throw new Error("Incompatible DOM Parser pour ce navigateur !")}function r(e){var t;return 9===e.nodeType?t=e.documentElement:1===e.nodeType&&(t=e),t}function n(e){var t={};if(e.attributes.length>0){var o=s(e);t.attributes=o}if(e.hasChildNodes())for(var r,i={},a=e.childNodes,c=0;c<a.length;c++)if(r=a[c],3===r.nodeType)t.textContent=r.nodeValue;else if(1===r.nodeType)if(i=n(r),t[r.nodeName]){if(!Array.isArray(t[r.nodeName])){var l=t[r.nodeName];t[r.nodeName]=[],t[r.nodeName].push(l)}t[r.nodeName].push(i)}else t[r.nodeName]=i;return t}function s(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}return t.prototype={constructor:t,getXMLString:function(){return this.xmlString},setXMLString:function(e){e&&"string"==typeof e&&(this.xmlString=e,this.xmlDoc=o(e))},getReader:function(){return this.reader},setReader:function(e){e&&e.read&&"function"==typeof e.read&&(this.reader=e)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(e){this.xmlDoc=e},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=o(this.xmlString)),this.xmlDoc){var e=r(this.xmlDoc);if(e){var t;return this.reader&&this.reader.read?t=this.reader.read(e):(t={},t[e.nodeName]=n(e)),t}return{}}}},t}(UtilsLoggerByDefault),ServicesAltiResponseModelAltiResponse=function(){function e(){if(!(this instanceof e))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}return e.prototype={constructor:e},e}(),ServicesAltiResponseModelElevation=function(){function e(){if(!(this instanceof e))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}return e.prototype={constructor:e},e}(),ServicesAltiFormatsAltiResponseReader=function(e,t,o){var r={};return r.READERS={elevations:function(e){var o=new t;if(e.hasChildNodes())for(var n,s,i=e.childNodes,a=0;a<i.length;a++)n=i[a],r.READERS[n.nodeName]&&(s=r.READERS[n.nodeName](n),o.elevations.push(s));return o},elevation:function(e){var t=new o;if(e.hasChildNodes())for(var n,s=e.childNodes,i=0;i<s.length;i++)n=s[i],r.READERS[n.nodeName]&&r.READERS[n.nodeName](n,t);return t},lat:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service: latitude attendue mais absente");t.lat=parseFloat(o.nodeValue)},lon:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service: longitude attendue mais absente");t.lon=parseFloat(o.nodeValue)},z:function(e,t){var r=e.firstChild;if(!r||3!==r.nodeType)throw new Error("Erreur dans la lecture de la réponse du service: altitude attendue mais absente");return t?void(t.z=parseFloat(r.nodeValue)):(t=new o,t.z=parseFloat(r.nodeValue),t)},acc:function(e,t){var o=e.firstChild;if(!o||3!==o.nodeType)throw new Error("Erreur dans la lecture de la réponse du service: précision (acc) attendue mais absente");t.acc=parseFloat(o.nodeValue)},exceptionreport:function(e){var t={};if(e.hasChildNodes())for(var o,n=e.childNodes,s=0;s<n.length;s++)o=n[s],"Exception"===o.nodeName&&(t.exceptionReport=r.READERS.exception(o));return t},exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t},error:function(e){var t={error:{}};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++){o=r[n];var s;1===o.nodeType&&"code"===o.nodeName&&(s=o.firstChild,s&&3===s.nodeType&&(t.error.code=s.nodeValue)),1===o.nodeType&&"description"===o.nodeName&&(s=o.firstChild,s&&3===s.nodeType&&(t.error.description=s.nodeValue))}return t}},r.read=function(e){if("elevations"===e.nodeName){var t=r.READERS.elevations(e);return t}if("ExceptionReport"===e.nodeName){var o=r.READERS.exceptionreport(e);return o}if("error"===e.nodeName){var n=r.READERS.error(e);return n}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},r}(UtilsLoggerByDefault,ServicesAltiResponseModelAltiResponse,ServicesAltiResponseModelElevation),ServicesAltiResponseAltiResponseFactory=function(e,t,o,r,n,s,i){var a={build:function(a){var c=e.getLogger("AltiResponseFactory");c.trace(["AltiResponseFactory::build()"]);var l=null;if(!a.response)return void a.onError.call(a.scope,new t(o.getMessage("SERVICE_RESPONSE_EMPTY")));if(a.rawResponse)c.trace("analyze response : raw"),l=a.response;else{switch(a.outputFormat){case"xml":c.trace("analyze response : xml");try{var u=new r({reader:n});if("string"==typeof a.response?u.setXMLString(a.response):u.setXMLDoc(a.response),l=u.parse(),!l)throw new Error(o.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(p){var h=p.message;return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",h),status:200,type:t.TYPE_SRVERR}))}break;case"json":c.trace("analyze response : json");var f;if(f="string"==typeof a.response?window.JSON.parse(a.response):a.response,f.error)return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",f.error.description),status:200,type:t.TYPE_SRVERR}));if(f){var d,g=f.elevations,m=new s;if(Array.isArray(g)&&g.length)for(var v=0;v<g.length;v++)d=new i,"object"==typeof g[v]?(g[v].lon&&(d.lon=g[v].lon),g[v].lat&&(d.lat=g[v].lat),g[v].z&&(d.z=g[v].z),g[v].acc&&(d.acc=g[v].acc)):"number"==typeof g[v]&&(d.z=g[v]),Array.isArray(m.elevations)&&m.elevations.push(d);l=m}if(!l)return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:t.TYPE_UNKERR,status:-1}));break;default:return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:t.TYPE_UNKERR,status:-1}))}if(l.exceptionReport)return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",l.exceptionReport),type:t.TYPE_SRVERR,status:200}));if(l.error){var y=l.error.description;return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",y),type:t.TYPE_SRVERR,status:200}))}}a.onSuccess.call(a.scope,l)}};return a}(UtilsLoggerByDefault,ExceptionsErrorService,UtilsMessagesResources,FormatsXML,ServicesAltiFormatsAltiResponseReader,ServicesAltiResponseModelAltiResponse,ServicesAltiResponseModelElevation),ServicesAltiAlti=function(e,t,o,r,n,s,i){function a(o){if(!(this instanceof a))throw new TypeError(t.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",r.apply(this,arguments),this.logger=e.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti(options)]"),!o.positions)throw new Error(t.getMessage("PARAM_MISSING","positions"));if(0===o.positions.length)throw new Error(t.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=o.positions,this.options.outputFormat="string"==typeof o.outputFormat?o.outputFormat.toLowerCase():"xml",this.options.sampling=o.sampling||null,this.options.api="string"==typeof o.api?o.api.toUpperCase():"REST","REST"===this.options.api&&(this.options.httpMethod="GET"),this.options.zonly=o.zonly||!1,!this.options.serverUrl){var s=n.Alti.url(this.options.apiKey),i=null;switch(this.options.api){case"WPS":i=s.wps;break;case"REST":var c=(o.sampling?"profil":"elevation")+"-"+this.options.outputFormat;i=s[c];break;default:throw new Error(t.getMessage("PARAM_UNKNOWN","api"))}if(!i)throw new Error("Url by default not found !");this.options.serverUrl=i,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var l=this.options.serverUrl.lastIndexOf(".");if(-1!==l){var u=this.options.serverUrl.substring(l+1);if(u&&u.length<5)switch(this.logger.trace("Server Extension URL : "+u),u.toLowerCase()){case"json":case"xml":this.options.outputFormat=u.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}return a.prototype=Object.create(r.prototype,{}),a.prototype.constructor=a,a.prototype.buildRequest=function(e,t){var o={httpMethod:this.options.httpMethod,onSuccess:function(e){this.request=e,t.call(this,this.request)},onError:e,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};s.build(o)},a.prototype.analyzeResponse=function(e,r){if(this.response){var n={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:e,onSuccess:r,scope:this};i.build(n)}else e.call(this,new o(t.getMessage("SERVICE_RESPONSE_EMPTY")))},a}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesCommonService,ServicesDefaultUrlService,ServicesAltiRequestAltiRequestFactory,ServicesAltiResponseAltiResponseFactory),ServicesAutoConfResponseModelAutoConfResponse=function(){function e(){if(!(this instanceof e))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}return e.prototype={constructor:e,isConfLoaded:function(e){return e?this.generalOptions.apiKeys[e]?!0:!1:void 0},getLayersId:function(e){return this.generalOptions.apiKeys[e]},getLayersConf:function(e){for(var t={},o=this.getLayersId(e),r=0;r<o.length;r++){var n=o[r];t[n]=this.layers[n]}return t},getLayerConf:function(e){return this.layers[e]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(e){return this.tileMatrixSets[e]},getTerritories:function(){return this.territories},getTerritoryConf:function(e){return this.territories[e]},getServices:function(){return this.services},getServiceConf:function(e){return this.services[e]}},e}(),ServicesAutoConfResponseModelConstraint=function(){function e(){if(!(this instanceof e))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelFormat=function(){function e(){if(!(this instanceof e))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelLayer=function(){function e(){if(!(this instanceof e))throw new TypeError("Layer constructor cannot be called as a function.")}return e.prototype={constructor:e,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var e=[];e.push(this.defaultProjection);var t=e.concat(this.additionalProjections);return t},getBBOX:function(){return this.globalConstraint?this.globalConstraint.bbox:void 0},getMinScaleDenominator:function(){return this.globalConstraint?this.globalConstraint.minScaleDenominator:void 0},getMaxScaleDenominator:function(){return this.globalConstraint?this.globalConstraint.maxScaleDenominator:void 0},getTMSID:function(){return this.wmtsOptions?this.wmtsOptions.tileMatrixSetLink:void 0},getServiceParams:function(){return this.serviceParams},getServerUrl:function(e){return e&&this.serviceParams&&this.serviceParams.serverUrl?this.serviceParams.serverUrl[e]:void 0},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){for(var e,t=this.styles,o=0;o<t.length;o++)if(t[o].current===!0){e=t[o].name;break}return e},getThematics:function(){return this.thematics},getDefaultFormat:function(){for(var e,t=this.formats,o=0;o<t.length;o++)if(t[o].current===!0){e=t[o].name;break}return e},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){return this.isAggregate?this.aggregatedLayers:void 0}},e}(),ServicesAutoConfResponseModelLegend=function(){function e(){if(!(this instanceof e))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelMetadata=function(){function e(){if(!(this instanceof e))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelOriginator=function(){function e(){if(!(this instanceof e))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelService=function(){function e(){if(!(this instanceof e))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelStyle=function(){function e(){if(!(this instanceof e))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelTerritory=function(){function e(){if(!(this instanceof e))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelThematic=function(){function e(){if(!(this instanceof e))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}return e.prototype={constructor:e},e}(),ServicesAutoConfResponseModelTileMatrixSet=function(){function e(){if(!(this instanceof e))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}return e.prototype={constructor:e,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var e,t=this.getTileMatrices();if(t)for(var o in t)if(t.hasOwnProperty(o)){
e=t[o].topLeftCorner;break}return e}},e}(),ServicesAutoConfResponseModelTileMatrix=function(){function e(){if(!(this instanceof e))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}return e.prototype={constructor:e,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}},e}(),ServicesAutoConfResponseModelTileMatrixLimit=function(){function e(){if(!(this instanceof e))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}return e.prototype={constructor:e},e}(),ServicesAutoConfFormatsAutoConfResponseReader=function(e,t,o,r,n,s,i,a,c,l,u,p,h,f,d){function g(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}function m(e,t){if(e.hasChildNodes())for(var o,r,n,s=e.childNodes,i=0;i<s.length;i++)if(o=s[i],1===o.nodeType)if(r=o.localName||o.baseName||o.nodeName,n=o.prefix||S.DEFAULTPREFIX,S.READERS[n][r]){var a=S.READERS[n][r];a(o,t)}else m(o,t)}function v(e){var t,o="";return e.hasChildNodes()&&(t=e.firstChild,(3===t.nodeType||4===t.nodeType)&&(o=t.nodeValue)),o}function y(e){if(e.attributes.length>0){var t=g(e);for(var o in t)if(t.hasOwnProperty(o)){if("version"===o&&t.version!==S.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if("xmlns"===o){if(t[o]!==S.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var r=o.split(":")[0],n=o.split(":")[1];if("xmlns"===r&&n&&S.NAMESPACES[n]&&S.NAMESPACES[n]!==t[o])return void console.log("[AutoConfResponseReader] autoconf response "+o+" namespace is not the expected one");if("schemaLocation"===n&&t[o]!==S.SCHEMALOCATION[0]&&t[o]!==S.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}}var S={};return S.VERSION="1.1.0",S.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/1.1",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},S.SCHEMALOCATION=["http://www.opengis.net/context http://gpp3-wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://gpp3-wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://gpp3-wxs.ign.fr/schemas/autoconf.xsd"],S.DEFAULTPREFIX="context",S.READERS={context:{ViewContext:function(e){y(e);var o=new t;return m(e,o),o},Title:function(e,t){t&&t.generalOptions?t.generalOptions.title=v(e):t&&t.lyr&&(t.lyr.title=v(e))},Abstract:function(e,t){t&&t.lyr&&(t.lyr.description=v(e))},Server:function(e,t){var o=e.getAttribute("service"),r=e.getAttribute("title"),n=e.getAttribute("version");if(o)if(t&&t.services&&"object"==typeof t.services&&!t.services[o]){var s=new c;s.title=r,s.version=n,m(e,s),t.services[o]=s}else t&&t.lyr&&(t.lyr.serviceParams||(t.lyr.serviceParams={}),t.lyr.serviceParams.id=o,t.lyr.serviceParams.version=n)},OnlineResource:function(e,t){t&&t.hasOwnProperty("serverUrl")&&(t.serverUrl=e.getAttribute("xlink:href"))},LayerList:function(e,t){if(m(e,t),t&&t.layers&&t.generalOptions&&t.services)for(var o in t.layers)if(t.layers.hasOwnProperty(o)){var r=t.layers[o],n=r.apiKeys;if(n&&Array.isArray(n))for(var s=0;s<n.length;s++){var i=n[s];t.generalOptions.apiKeys&&(t.generalOptions.apiKeys[i]&&Array.isArray(t.generalOptions.apiKeys[i])||(t.generalOptions.apiKeys[i]=[]),t.generalOptions.apiKeys[i].push(o))}var a=r.serviceParams;if(a&&a.id&&!t.services[a.id]){var l=new c;a.serverUrl&&(l.serverUrl=a.serverUrl),a.version&&(l.version=a.version),t.services[a.id]=l}if(r.wmtsOptions&&r.wmtsOptions.tileMatrixSetLink&&t.tileMatrixSets){var u=r.wmtsOptions.tileMatrixSetLink,p=t.tileMatrixSets;for(var h in p)p.hasOwnProperty(h)&&h===u&&(r.defaultProjection=p[h].projection)}}},Layer:function(e,t){if(t&&t.layers){var o={lyr:new n,lyrId:null},r=e.getAttribute("hidden");"1"===r?o.lyr.hidden=!0:o.lyr.hidden=!1;var s=e.getAttribute("queryable");if("1"===s?o.lyr.queryable=!0:o.lyr.queryable=!1,m(e,o),o.lyrId){if(o.lyr.serviceParams&&o.lyr.serviceParams.id){var i=o.lyr.serviceParams.id;if(-1!==i.toUpperCase().indexOf("OPENLS")||-1!==i.toUpperCase().indexOf("ELEVATION")){var a=o.lyrId.split("$")[0];o.lyrId=a+"$"+i}}o.lyr.layerId=o.lyrId,t.layers[o.lyrId]=o.lyr}}},Name:function(e,t){t&&t.lyr&&(t.lyr.name=v(e))},SRS:function(e,t){t&&t.lyr&&(t.lyr.defaultProjection=v(e))},Format:function(e,t){if(t&&t.lyr){var o=new r,n=e.getAttribute("current");"1"===n?o.current=!0:o.current=!1,o.name=v(e),t.lyr.formats&&Array.isArray(t.lyr.formats)||(t.lyr.formats=[]),t.lyr.formats.push(o)}},Style:function(e,t){if(t&&t.lyr){var o=new l,r=e.getAttribute("current");if("1"===r||1===r?o.current=!0:o.current=!1,e.hasChildNodes)for(var n,s,i=e.childNodes,a=0;a<i.length;a++)n=i[a],1===n.nodeType&&(s=n.localName||n.baseName||n.nodeName,"Name"===s?o.name=v(n):"Title"===s&&(o.title=v(n)));t.lyr.styles&&Array.isArray(t.lyr.styles)||(t.lyr.styles=[]),t.lyr.styles.push(o)}},Dimension:function(e,t){var o=e.getAttribute("name"),r=v(e);t&&t.lyr&&(t.lyr.dimensions||(t.lyr.dimensions={}),"Type"===o?t.lyr.dimensions.type=r:"VisibilityRange"===o?t.lyr.dimensions.visibilityRange=r:"VisibilityMode "===o?t.lyr.dimensions.visibilityMode=r:"GeometricType"===o?t.lyr.dimensions.geometricType=r:"NoDataValue"===o&&(t.lyr.dimensions.noDataValue=r))}},gpp:{Theme:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("theme")&&(t.generalOptions.theme=v(e))},defaultGMLGFIStyleUrl:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(t.generalOptions.defaultGMLGFIStyle=v(e))},Territory:function(e,t){var o=e.getAttribute("id");if(o){var r=new u,n=e.getAttribute("default");"1"===n?r.isDefault=!0:r.isDefault=!1,m(e,r),t&&t.territories&&"object"==typeof t.territories&&(t.territories[o]=r)}},defaultCRS:function(e,t){t&&t.hasOwnProperty("defaultCRS")&&(t.defaultCRS=v(e))},AdditionalCRS:function(e,t){var o=v(e);o&&t&&(Array.isArray(t.additionalCRS)?t.additionalCRS.push(o):(t.additionalProjections&&Array.isArray(t.additionalProjections)||(t.additionalProjections=[]),t.additionalProjections.push(o)))},DefaultLayer:function(e,t){var o=e.getAttribute("layerId");o&&t&&Array.isArray(t.defaultLayers)&&t.defaultLayers.push(o)},BoundingBox:function(e,t){if(t){var r=v(e).split(",");if(4===r.length){var n={left:parseFloat(r[0]),right:parseFloat(r[2]),top:parseFloat(r[3]),bottom:parseFloat(r[1])},s=e.getAttribute("minT"),i=e.getAttribute("maxT");if(t.hasOwnProperty("geoBBOX"))t.geoBBOX=n;else if(t.hasOwnProperty("bbox"))if(t.bbox.left||t.bbox.right||t.bbox.top||t.bbox.bottom){t.multiConstraints||(t.multiConstraints=[]);var a=new o;a.bbox=n,a.temporalExtent=[s,i],t.multiConstraints.push(a)}else t.bbox=n,t.temporalExtent=[s,i];else t.globalConstraint||(t.globalConstraint=new o),t.globalConstraint.bbox=n,t.globalConstraint.temporalExtent=[s,i]}}},Resolution:function(e,t){var o=v(e);o&&t&&t.defaultOptions&&t.defaultOptions.hasOwnProperty("resolution")&&(t.defaultOptions.resolution=parseFloat(o))},x:function(e,t){var o=v(e);o&&t&&t.geoCenter&&t.geoCenter.hasOwnProperty("lon")&&(t.geoCenter.lon=parseFloat(o))},y:function(e,t){var o=v(e);o&&t&&t.geoCenter&&t.geoCenter.hasOwnProperty("lat")&&(t.geoCenter.lat=parseFloat(o))},Resolutions:function(e,t){t&&t.generalOptions&&t.generalOptions.hasOwnProperty("wgs84Resolutions")&&(t.generalOptions.wgs84Resolutions=v(e).split(","))},Layer:function(e,t){if(t&&t.hasOwnProperty("lyrId")&&t.lyr){t.lyrId=e.getAttribute("id");var o=e.getAttribute("aggregate"),r=e.getAttribute("more");(o||r)&&(t.lyr.isAggregate=!0),m(e,t.lyr)}},Constraint:function(e,t){var r=new o;if(m(e,r),t)if(t.constraints&&Array.isArray(t.constraints)||(t.constraints=[]),r.multiConstraints&&Array.isArray(r.multiConstraints)){var n=new o;n.crs=r.crs,n.bbox=r.bbox,n.minScaleDenominator=r.minScaleDenominator,n.maxScaleDenominator=r.maxScaleDenominator,n.temporalExtent=r.temporalExtent,t.constraints.push(n);for(var s=0;s<r.multiConstraints.length;s++)n=new o,n.crs=r.crs,n.minScaleDenominator=r.minScaleDenominator,n.maxScaleDenominator=r.maxScaleDenominator,n.bbox=r.multiConstraints[s].bbox,n.temporalExtent=r.multiConstraints[s].temporalExtent,t.constraints.push(n)}else t.constraints.push(r)},CRS:function(e,t){t&&t.hasOwnProperty("crs")&&(t.crs=v(e))},Thematic:function(e,t){if(t){var o=new p;o.inspire=!1,o.name=v(e),t.thematics&&Array.isArray(t.thematics)||(t.thematics=[]),t.thematics.push(o)}},InspireThematic:function(e,t){if(t){var o=new p;o.inspire=!0,o.name=v(e),t.thematics&&Array.isArray(t.thematics)||(t.thematics=[]),t.thematics.push(o)}},Originator:function(e,t){if(t){var o=new a;o.name=e.getAttribute("name"),m(e,o),t.originators&&Array.isArray(t.originators)||(t.originators=[]),t.originators.push(o)}},Attribution:function(e,t){t&&t.hasOwnProperty("attribution")&&(t.attribution=v(e))},Logo:function(e,t){t&&t.hasOwnProperty("logo")&&(t.logo=v(e))},URL:function(e,t){t&&t.hasOwnProperty("url")&&(t.url=v(e))},Legend:function(e,t){var o=new s;m(e,o),t&&((!t.legends||Array.isArray(t.legends))&&(t.legends=[]),t.legends.push(o))},LegendURL:function(e,t){if(t&&t.hasOwnProperty("format")&&(t.format=e.getAttribute("format"),e.hasChildNodes)){var o=e.childNodes[0],r=o.localName||o.baseName||o.nodeName;"OnlineResource"===r&&t.hasOwnProperty("url")&&(t.url=o.getAttribute("xlink:href"))}},QuickLook:function(e,t){if(e.hasChildNodes){var o=e.childNodes[0],r=o.localName||o.baseName||o.nodeName;"OnlineResource"===r&&t&&(t.quicklookUrl=o.getAttribute("xlink:href"))}},MetadataURL:function(e,t){if(t){var o=new i;if(o.format=e.getAttribute("format"),e.hasChildNodes){var r=e.childNodes[0],n=r.localName||r.baseName||r.nodeName;"OnlineResource"===n&&(o.url=r.getAttribute("xlink:href"))}t.metadata||Array.isArray(t.metadata)||(t.metadata=[]),t.metadata.push(o)}},Key:function(e,t){if(t){var o=e.getAttribute("id");t.apiKeys&&Array.isArray(t.apiKeys)||(t.apiKeys=[]),t.apiKeys.push(o);var r=v(e);t.serviceParams||(t.serviceParams={}),t.serviceParams.serverUrl||(t.serviceParams.serverUrl={}),t.serviceParams.serverUrl[o]||(t.serviceParams.serverUrl[o]=r)}}},ows:{Identifier:function(e,t){t&&t.hasOwnProperty("TMS")?t.identifier=v(e):t&&t.hasOwnProperty("matrixId")&&(t.matrixId=v(e))},SupportedCRS:function(e,t){t&&t.TMS&&t.TMS.hasOwnProperty("projection")&&(t.TMS.projection=v(e))}},sld:{MinScaleDenominator:function(e,t){var r=v(e);r&&t&&(t.hasOwnProperty("defaultOptions")?t.defaultOptions.minScaleDenominator=parseFloat(r):t.lyr?(t.lyr.globalConstraint||(t.lyr.globalConstraint=new o),t.lyr.globalConstraint.minScaleDenominator=parseFloat(r)):t.hasOwnProperty("minScaleDenominator")&&(t.minScaleDenominator=parseFloat(r)))},MaxScaleDenominator:function(e,t){var r=v(e);r&&t&&(t.hasOwnProperty("defaultOptions")?t.defaultOptions.maxScaleDenominator=parseFloat(r):t.lyr?(t.lyr.globalConstraint||(t.lyr.globalConstraint=new o),t.lyr.globalConstraint.maxScaleDenominator=parseFloat(r)):t.hasOwnProperty("maxScaleDenominator")&&(t.maxScaleDenominator=parseFloat(r)))}},wmts:{TileMatrixSetLimits:function(e,t){if(t){var o={};m(e,o),t.wmtsOptions||(t.wmtsOptions={}),t.wmtsOptions.tileMatrixSetLimits=o}},TileMatrixLimits:function(e,t){var o,r=new d;if(e.hasChildNodes){for(var n=e.childNodes,s=0;s<n.length;s++){var i=n[s],a=i.localName||i.baseName||i.nodeName;"TileMatrix"===a?o=v(i):"MinTileRow"===a?r.minTileRow=v(i):"MaxTileRow"===a?r.maxTileRow=v(i):"MinTileCol"===a?r.minTileCol=v(i):"MaxTileCol"===a&&(r.maxTileCol=v(i))}o&&t&&!t[o]&&(t[o]=r)}},TileMatrixSet:function(e,t){if(t&&t.tileMatrixSets){var o={};o.TMS=new h,o.resolutions=[],m(e,o);var r=o.TMS.tileMatrices;for(var n in r)r.hasOwnProperty(n)&&o.TMS.matrixIds.push(n);Array.isArray(o.resolutions)&&void 0!==o.resolutions.sort&&o.resolutions.sort(function(e,t){return t-e}),o.TMS.nativeResolutions=o.resolutions,t.tileMatrixSets[o.identifier]=o.TMS}else t&&!t.wmtsOptions&&(t.wmtsOptions={}),t.wmtsOptions.tileMatrixSetLink=v(e)},TileMatrix:function(e,t){if(t){var o=new f;m(e,o);var r=28e-5*o.scaleDenominator;t.resolutions&&Array.isArray(t.resolutions)&&t.resolutions.push(r),t.TMS&&t.TMS.tileMatrices&&(t.TMS.tileMatrices[o.matrixId]=o)}},ScaleDenominator:function(e,t){var o=v(e);o&&t&&t.hasOwnProperty("scaleDenominator")&&(t.scaleDenominator=parseFloat(o))},TopLeftCorner:function(e,t){var o=v(e).split(" ");o&&t&&(t.topLeftCorner={},t.topLeftCorner.x=parseFloat(o[0]),t.topLeftCorner.y=parseFloat(o[1]))},TileWidth:function(e,t){var o=v(e);o&&t&&t.hasOwnProperty("tileWidth")&&(t.tileWidth=parseInt(o,10))},TileHeight:function(e,t){var o=v(e);o&&t&&t.hasOwnProperty("tileHeight")&&(t.tileHeight=parseInt(o,10))},MatrixWidth:function(e,t){var o=v(e);o&&t&&t.hasOwnProperty("matrixWidth")&&(t.matrixWidth=parseInt(o,10))},MatrixHeight:function(e,t){var o=v(e);o&&t&&t.hasOwnProperty("matrixHeight")&&(t.matrixHeight=parseInt(o,10))}},serviceException:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],"exception"===o.nodeName&&(t.exceptionReport=S.READERS.exception(o));return t},exception:function(e){var t={},o=e.getAttribute("code");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},S.read=function(e){if("ViewContext"===e.nodeName){var t=e.prefix||S.DEFAULTPREFIX,o=S.READERS[t][e.nodeName](e);return o}if("serviceException"===e.nodeName){var r=S.READERS[e.nodeName](e);return r}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},S}(UtilsLoggerByDefault,ServicesAutoConfResponseModelAutoConfResponse,ServicesAutoConfResponseModelConstraint,ServicesAutoConfResponseModelFormat,ServicesAutoConfResponseModelLayer,ServicesAutoConfResponseModelLegend,ServicesAutoConfResponseModelMetadata,ServicesAutoConfResponseModelOriginator,ServicesAutoConfResponseModelService,ServicesAutoConfResponseModelStyle,ServicesAutoConfResponseModelTerritory,ServicesAutoConfResponseModelThematic,ServicesAutoConfResponseModelTileMatrixSet,ServicesAutoConfResponseModelTileMatrix,ServicesAutoConfResponseModelTileMatrixLimit),ServicesAutoConfResponseAutoConfResponseFactory=function(e,t,o,r,n){var s={build:function(s){var i=e.getLogger("AutoConfResponseFactory");i.trace(["AutoConfResponseFactory::build()"]);var a=null;if(!s.response)return void s.onError.call(s.scope,new t(o.getMessage("SERVICE_RESPONSE_EMPTY")));if(s.rawResponse)a=s.response;else{try{var c=new r({reader:n});"string"==typeof s.response?c.setXMLString(s.response):c.setXMLDoc(s.response),a=c.parse()}catch(l){var u=l.message;return u+="string"==typeof s.response?"\n(raw response service'"+s.response+"')":"\n(raw response service'"+s.response.documentElement.innerHTML+"')",void s.onError.call(s.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",u),status:200,type:t.TYPE_SRVERR}))}var p=!0;for(var h in a)a.hasOwnProperty(h)&&(p=!1);if(p)return void s.onError.call(s.scope,new t(o.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(a.exceptionReport)return void s.onError.call(s.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",a.exceptionReport),type:t.TYPE_SRVERR,status:200}))}var f="undefined"!=typeof window?window:{};f.Gp||(f.Gp={}),f.Gp.Config?this.mergeConfig(f.Gp.Config,a,s.layerId):f.Gp.Config=a,s.onSuccess.call(s.scope,f.Gp.Config)},mergeConfig:function(e,t,o){if(t&&e){for(var r in t)if(t.hasOwnProperty(r))if("generalOptions"==r)for(var n in t[r].apiKeys)t[r].apiKeys.hasOwnProperty(n)&&!e.generalOptions.apiKeys[n]&&(e.generalOptions.apiKeys[n]=t[r].apiKeys[n]);else if(e[r])for(var s in t[r])t[r].hasOwnProperty(s)&&!e[r][s]&&(e[r][s]=t[r][s]);if(o){var i=[];for(var a in t.layers)t.layers.hasOwnProperty(a)&&i.push(a);e.layers[o]&&(e.layers[o].aggregatedLayers=i)}}}};return s}(UtilsLoggerByDefault,ExceptionsErrorService,UtilsMessagesResources,FormatsXML,ServicesAutoConfFormatsAutoConfResponseReader),ServicesAutoConfAutoConf=function(e,t,o,r,n,s,i){function a(o){if(!(this instanceof a))throw new TypeError(t.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",s.apply(this,arguments),this.logger=e.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf(options)]"),!this.options.serverUrl&&!this.options.serverUrl){var r=n.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=r.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=r.apiKeys:this.options.serverUrl=r.apiKey}"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat="xml"}return a.prototype=Object.create(s.prototype,{}),a.prototype.constructor=a,a.prototype.buildRequest=function(e,t){var o="undefined"!=typeof window?window:{};if(o.Gp&&o.Gp.Config&&o.Gp.Config.generalOptions&&o.Gp.Config.layers&&o.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe déjà pour cette clé"),void this.options.onSuccess.call(this,o.Gp.Config);if(o.Gp.Config.layers[this.options.layerId]&&o.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe déjà pour cette clé et cette couche"),void this.options.onSuccess.call(this,o.Gp.Config)}this.request="";var n;n=-1===this.options.serverUrl.indexOf("http://")?!0:!1,!n&&this.layerId&&(this.request=r.normalyzeParameters({layerId:this.layerId})),t.call(this,this.request)},a.prototype.analyzeResponse=function(e,r){if(this.response){var n={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:r,onError:e,scope:this};i.build(n)}else e.call(this,new o(t.getMessage("SERVICE_RESPONSE_EMPTY")))},a}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,UtilsHelper,ServicesDefaultUrlService,ServicesCommonService,ServicesAutoConfResponseAutoConfResponseFactory),FormatsXLSRequestHeader=function(e){function t(o){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur RequestHeader()]"),!(this instanceof t))throw new TypeError("RequestHeader constructor cannot be called as a function.");this.options=o||{srsName:"EPSG:4326"};for(var r in o)o.hasOwnProperty(r)&&(this.options[r]=o[r])}return t.prototype={requestString:null,template:'	<RequestHeader srsName="__SRSNAME__"/>',constructor:t,toString:function(){var e=null;return e=this.template,e=e.replace(/__SRSNAME__/g,this.options.srsName),this.requestString=e,this.requestString}},t}(UtilsLoggerByDefault),FormatsXLSRequest=function(e){function t(o){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur Request()]"),!(this instanceof t))throw new TypeError("Request constructor cannot be called as a function.");this.options=o||{maximumResponses:25,methodName:null,version:"1.2"};for(var r in o)o.hasOwnProperty(r)&&(this.options[r]=o[r])}return t.prototype={requestString:null,template:'	<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__">\n<!-- __REQUESTSERVICE__ -->\n	</Request>',constructor:t,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,o="x"===e?t:3&t|8;return o.toString(16)})},toString:function(){var e=null;return e=this.template,e=e.replace(/__MAXRESPONSES__/g,this.options.maximumResponses),e=e.replace(/__METHODNAME__/g,this.options.methodName),e=e.replace(/__UUID__/g,this.guid()),e=e.replace(/__VERSION__/g,this.options.version),this.requestString=e,this.requestString}},t}(UtilsLoggerByDefault),FormatsXLSAbstractService=function(e){function t(o){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur AbstractService()]"),!(this instanceof t))throw new TypeError("AbstractService constructor cannot be called as a function.");this.options=o||{};for(var r in o)o.hasOwnProperty(r)&&(this.options[r]=o[r])}return t.prototype={strRequest:null,oRequest:null,oFilter:null,constructor:t,addRequest:function(e){this.logger.error("overwritten method !")},addFilter:function(e){this.logger.error("overwritten method !")},toString:function(){this.logger.error("overwritten method !")}},t}(UtilsLoggerByDefault),FormatsXLS=function(e,t,o,r){function n(t){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur XLS()]"),!(this instanceof n))throw new TypeError("XLS constructor cannot be called as a function.");this.options={srsName:"EPSG:4326",maximumResponses:25};for(var o in t)t.hasOwnProperty(o)&&t[o]&&(this.options[o]=t[o])}return n.VERSION="1.2",n.prototype={requestString:null,namespace:!1,oService:null,constructor:n,template:'<?xml version="1.0" encoding="UTF-8"?>\n<XLS version="__VERSION__"\n__NAMESPACE__ \n__SCHEMALOCATION__>\n__REQUESTHEADER__\n__REQUEST__\n</XLS>\n',namespaceByDefault:function(){var e=['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns:xls="http://www.opengis.net/xls"','xmlns:gml="http://www.opengis.net/gml"'];return e.join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"'},setService:function(e){return e?void(e instanceof r?this.oService=e:this.logger.error("L'objet n'est pas du type 'LocationUtilityService' ou 'RouteService' !?")):void this.logger.trace("L'objet de type Service XSL n'est pas encore defini !?")},getService:function(){return this.oService}},n.prototype.addNamespace=function(e,t){for(var o=e.key,r=!1,n=this.namespaceByDefault().split(" "),s=0;s<n.length;s++){var i=n[s],a=i.split("="),c=a[0];if(c==="xmlns:"+o){r=!0;break}}if(!r)return this.logger.warn("L'ajout d'un nouvel namespace n'est pas encore implémenté !"),t;var l,u;return l=/<(\w+[\s>])/g,u="<"+o+":$1",t=t.replace(l,u),l=/<\/(\w+[\s>])/g,u="</"+o+":$1",t=t.replace(l,u),this.logger.trace("namespace",t),t},n.prototype.build=function(){var e=this.getService()?!0:!1,r="";r=this.template,r=r.replace(/__VERSION__/g,n.VERSION),r=r.replace(/__NAMESPACE__/g,this.namespaceByDefault),r=r.replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault);var s=new t({srsName:this.options.srsName});r=r.replace(/__REQUESTHEADER__/g,s.toString());var i=new o({maximumResponses:this.options.maximumResponses,version:n.VERSION,methodName:e?this.getService().CLASSTYPE:null});return r=r.replace(/__REQUEST__/g,i.toString()),e&&(r=r.replace(/<!-- __REQUESTSERVICE__ -->/g,this.getService().toString())),r?(this.namespace&&(r=this.addNamespace({key:"xls",url:"http://www.opengis.net/xls"},r)),this.requestString=r,this.logger.trace("traduction tmpl",r),this.requestString):void this.logger.warn("traduction tmpl : empty request !?")},n}(UtilsLoggerByDefault,FormatsXLSRequestHeader,FormatsXLSRequest,FormatsXLSAbstractService),FormatsXLSLocationUtilityServiceModelAddress=function(e,t){function o(e){if(this.logger=t.getLogger("Address"),this.logger.trace("[Constructeur Address()]"),!(this instanceof o))throw new TypeError("Address constructor cannot be called as a function.");if(this.options=e||{location:{},type:["StreetAddress"],filter:{}},!e.location)throw new Error("l'option 'location' n'est pas renseignée !");for(var r in e)e.hasOwnProperty(r)&&(this.options[r]=e[r])}return o.prototype={constructor:o,requestString:null,template:{address:'			<Address countryCode="__COUNTRYCODE__">\n__LOCATION__ \n__PLACE__ \n__POSTALCODE__ \n__ENVELOPE__ \n			</Address>',location:{freeFormAddress:"				<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>",streetAddress:{container:"				<StreetAddress>\n					__STREET__ \n					__BUILDING__ \n				</StreetAddress>",building:'	<Building number="__BUILDINGVALUE__"/>',street:"	<Street>__STREETVALUE__</Street>"}},place:'				<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',postalCode:"				<PostalCode>__POSTALCODEVALUE__</PostalCode>",envelope:"				<gml:Envelope>\n					<gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner>\n					<gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner>\n				</gml:Envelope>"}},o.prototype.toString=function(){var e=null;if(e=this.template.address,e=e.replace(/__COUNTRYCODE__/g,this.options.type),"string"==typeof this.options.location){var t=this.template.location.freeFormAddress;t=t.replace(/__FREEFORMADDRESSVALUE__/g,this.options.location),e=e.replace(/__LOCATION__/g,t)}else{var o="",r="";this.options.location.number&&(o=this.template.location.streetAddress.building,o=o.replace(/__BUILDINGVALUE__/g,this.options.location.number)),this.options.location.street&&(r=this.template.location.streetAddress.street,r=r.replace(/__STREETVALUE__/g,this.options.location.street));var n=this.template.location.streetAddress.container;n=n.replace(/__STREET__/g,r),n=n.replace(/__BUILDING__/g,o),e=e.replace(/__LOCATION__/g,n)}var s="";this.options.location.postalCode&&(s=this.template.postalCode,s=s.replace(/__POSTALCODEVALUE__/g,this.options.location.postalCode));var i="";if(this.options.filter){var a=this.options.filter.bbox;a&&(i=this.template.envelope,i=i.replace(/__LEFT__/g,a.left),i=i.replace(/__BOTTOM__/g,a.bottom),i=i.replace(/__RIGHT__/g,a.right),i=i.replace(/__TOP__/g,a.top))}var c=[],l="";if(this.options.filter){var u=this.options.filter;for(var p in u)"bbox"!==p&&(l=this.template.place,l=l.replace(/__PLACETYPE__/g,p),l=l.replace(/__PLACEVALUE__/g,u[p]),c.push(l))}var h="";return this.options.location.city&&(h=this.template.place,h=h.replace(/__PLACETYPE__/g,"Municipality"),h=h.replace(/__PLACEVALUE__/g,this.options.location.city),c.push(h)),e=e.replace(/__POSTALCODE__/g,s),e=e.replace(/__PLACE__/g,c.join("\n")),e=e.replace(/__ENVELOPE__/g,i),this.requestString=e,this.requestString},o}(Gp,UtilsLoggerByDefault),FormatsXLSLocationUtilityServiceGeocodeFilterExtension=function(e){function t(){if(this.logger=e.getLogger("GeocodeFilterExtension"),this.logger.trace("[Constructeur GeocodeFilterExtension()]"),!(this instanceof t))throw new TypeError("GeocodeFilterExtension constructor cannot be called as a function.");this.filters=[]}return t.prototype={constructor:t,addFilterExtensions:function(e){e&&this.filters.push(e)},getNames:function(){var e=[];for(var t in this.filters)e.push(this.filters[t].CLASSNAME);return this.logger.trace(e),e},getFilter:function(e){var t=null;for(var o in this.filters)this.filters[o].CLASSNAME==e&&(t=this.filters[o]);return this.logger.trace(t),t},getFilters:function(){return this.logger.trace(this.filters),this.filters},getAttributs:function(e){var t=[];for(var o in this.filters)this.filters[o].CLASSNAME==e&&(t=this.filters[o].attributesList);return this.logger.trace(t),t},setPlaceAttributs:function(e,t){var o=this.getFilter(e),r=this.getAttributs(e);for(var n in r){var s=r[n];t[s]&&(o.placeAttributes[s]=t[s])}},getPlaceAttributs:function(e){var t={};for(var o in this.filters)this.filters[o].CLASSNAME==e&&(t=this.filters[o].placeAttributes);return this.logger.trace(t),t}},t}(UtilsLoggerByDefault),FormatsXLSLocationUtilityServiceGeocodeRequest=function(e,t,o){function r(t){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur GeocodeRequest()]"),!(this instanceof r))throw new TypeError("GeocodeRequest constructor cannot be called as a function.");this.options=t||{};for(var o in t)t.hasOwnProperty(o)&&(this.options[o]=t[o]);this.CLASSNAME="GeocodeRequest"}return r.prototype={strRequest:null,oAddress:null,oFilter:null,template:'		<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">\n__ADDRESS__ \n		</GeocodeRequest>',addAddress:function(e){e instanceof t&&(this.oAddress=e)},addFilter:function(e){e instanceof o&&(this.oFilter=e)},constructor:r,toString:function(){var e="";if(e=this.template,!this.oAddress){var o={};if(o.location=this.options.location,o.type=this.options.filterOptions.type||["StreetAddress"],o.filter=this.options.filterOptions,delete o.filter.type,this.oFilter){o.filter={};for(var r in o.type){var n=o.type[r],s=this.oFilter.getFilter(n);if(s){for(var i=this.options.filterOptions,a=s.attributesList,c=0;c<a.length;c++){var l=a[c];if(i[l]){var u=s.serviceAttributes[c];s.placeAttributes[u]=i[l],this.logger.trace("Selection du filtre '"+l+"' sur le type '"+n+"'.")}}var p=s.placeAttributes;for(var h in p)p.hasOwnProperty(h)&&(o.filter[h]=p[h])}else this.logger.warn("Le filtre '"+n+"' n'existe pas !?")}}if(this.oAddress=new t(o),!this.oAddress)throw new Error("La construction de l'adresse n'est pas correctement definie !?")}return e=e.replace(/__ADDRESS__/g,this.oAddress.toString()),e=e.replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=e,this.strRequest}},r}(UtilsLoggerByDefault,FormatsXLSLocationUtilityServiceModelAddress,FormatsXLSLocationUtilityServiceGeocodeFilterExtension),FormatsXLSLocationUtilityServiceModelPosition=function(e){function t(o){if(this.logger=e.getLogger("Position"),this.logger.trace("[Constructeur Position()]"),!(this instanceof t))throw new TypeError("Position constructor cannot be called as a function.");if(this.options=o||{},!o.position)throw new Error("l'option 'position' n'est pas renseignée !");for(var r in o)o.hasOwnProperty(r)&&(this.options[r]=o[r])}return t.prototype={constructor:t,requestString:null,template:{position:"			<Position>\n__GMLPOINT__ \n__GMLFILTER__ \n			</Position>",gml:{point:'				<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',pos:null,filter:{bbox:'				<gml:Envelope xmlns:gml="http://www.opengis.net/gml">\n					<gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner>\n					<gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner>\n				</gml:Envelope>',circle:'				<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',polygon:'				<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',multipolygon:null}}}},t.prototype.toString=function(){var e=this.template.position,t=this.template.gml.point;t=t.replace(/__X__/g,this.options.position.x),t=t.replace(/__Y__/g,this.options.position.y);var o="";if(this.options.filter){var r=this.options.filter;for(var n in r)switch(n){case"circle":o=this.template.gml.filter[n],o=o.replace(/__X__/g,r[n].x),o=o.replace(/__Y__/g,r[n].y),o=o.replace(/__RADIUS__/g,r[n].radius);break;case"bbox":o=this.template.gml.filter[n],o=o.replace(/__LEFT__/g,r[n].left),o=o.replace(/__BOTTOM__/g,r[n].bottom),o=o.replace(/__RIGHT__/g,r[n].right),o=o.replace(/__TOP__/g,r[n].top);break;case"polygon":o=this.template.gml.filter[n];for(var s="",i=r[n],a=0;a<i.length;a++){var c=i[a];if(Array.isArray(c)){this.logger.error("Holes are not implemented !");break}(c.x&&c.y||0===c.x||0===c.y)&&(s+=c.x+" "+c.y),i.length!==a+1&&(s+=" ")}o=o.replace(/__XY__/g,s);break;case"multipolygon":this.logger.warn("Filter '"+n+"' is not yet implemented !");break;default:this.logger.error("This filter '"+n+"' is not useful !")}}return e=e.replace(/__GMLPOINT__/g,t),e=e.replace(/__GMLFILTER__/g,o),this.requestString=e,this.requestString},t}(UtilsLoggerByDefault),FormatsXLSLocationUtilityServiceModelPreference=function(e){function t(o){if(this.logger=e.getLogger("Preference"),this.logger.trace("[Constructeur Preference()]"),
!(this instanceof t))throw new TypeError("Preference constructor cannot be called as a function.");this.type=o}return t.prototype={constructor:t,requestString:null,template:"			<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>"},t.prototype.toString=function(){var e=[],t="";for(var o in this.type)t=this.template,t=t.replace(/__TYPE__/g,this.type[o]),e.push(t);return this.strRequest=e.join("\n"),this.strRequest},t}(UtilsLoggerByDefault),FormatsXLSLocationUtilityServiceReverseGeocodeRequest=function(e,t,o){function r(t){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur ReverseGeocodeRequest()]"),!(this instanceof r))throw new TypeError("ReverseGeocodeRequest constructor cannot be called as a function.");this.options=t||{};for(var o in t)t.hasOwnProperty(o)&&(this.options[o]=t[o]);this.CLASSNAME="ReverseGeocodeRequest"}return r.prototype={strRequest:null,oPosition:null,oPreference:null,constructor:r,template:'		<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">\n__POSITION__ \n__PREFERENCE__\n		</ReverseGeocodeRequest>',addPosition:function(e){e instanceof t&&(this.oPosition=e)},addPreferences:function(e){e instanceof o&&(this.oPreference=e)},toString:function(){var e="";if(e=this.template,!this.oPreference&&(this.oPreference=new o(this.options.filterOptions.type||["StreetAddress"]),!this.oPreference))throw new Error("Les preferences ne sont pas definies !?");if(e=e.replace(/__PREFERENCE__/g,this.oPreference.toString()),!this.oPosition){var r={position:this.options.position,filter:{}};if(this.options.filterOptions&&(r.filter=this.options.filterOptions,delete r.filter.type),this.oPosition=new t(r),!this.oPosition)throw new Error("La position et ses filtres ne sont pas definis !?")}return e=e.replace(/__POSITION__/g,this.oPosition.toString()),e=e.replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=e,this.strRequest}},r}(UtilsLoggerByDefault,FormatsXLSLocationUtilityServiceModelPosition,FormatsXLSLocationUtilityServiceModelPreference),FormatsXLSLocationUtilityService=function(e,t,o,r,n){function s(o){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur LocationUtilityService()]"),!(this instanceof s))throw new TypeError("LocationUtilityService constructor cannot be called as a function.");this.CLASSNAME="LocationUtilityService",this.CLASSTYPE=null,t.apply(this,arguments),this.options&&(this.CLASSTYPE=this.options.location?"GeocodeRequest":this.options.position?"ReverseGeocodeRequest":null)}return s.prototype=Object.create(t.prototype,{}),s.prototype.constructor=s,s.prototype.addRequest=function(e){switch(this.CLASSTYPE=e.CLASSNAME,this.CLASSTYPE){case"GeocodeRequest":case"ReverseGeocodeRequest":this.oRequest=e;break;default:throw new Error("Ce n'est pas un objet de type 'LUS Request' !?")}},s.prototype.addFilter=function(e){e instanceof n&&(this.oFilter=e)},s.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("GeocodeRequest"===this.CLASSTYPE){var e={location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new o(e),this.oFilter&&this.oRequest.addFilter(this.oFilter)}else if("ReverseGeocodeRequest"===this.CLASSTYPE){var t={position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new r(t)}else this.logger.error("impossible de determiner le type de geocodage : Direct ou Inverse !?")}if(!this.oRequest)throw new Error("Type de Geocodage indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest},s}(UtilsLoggerByDefault,FormatsXLSAbstractService,FormatsXLSLocationUtilityServiceGeocodeRequest,FormatsXLSLocationUtilityServiceReverseGeocodeRequest,FormatsXLSLocationUtilityServiceGeocodeFilterExtension),ServicesGeocodeRequestGeocodeLocation=function(){function e(){if(!(this instanceof e))throw new TypeError("GeocodeLocation constructor cannot be called as a function.");this.placeAttributes={},this.attributesList=[],this.serviceAttributes=[]}return e.prototype={constructor:e},e}(),ServicesGeocodeRequestModelStreetAddress=function(e){function t(){if(!(this instanceof t))throw new TypeError("StreetAddress constructor cannot be called as a function.");e.apply(this,arguments),this.CLASSNAME="StreetAddress",this.attributesList=["bbox","ID","IDTR","quality","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","ID","IDTR","Qualite","Territoire","Commune","Departement","INSEE","Municipality"]}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(ServicesGeocodeRequestGeocodeLocation),ServicesGeocodeRequestModelPositionOfInterest=function(e){function t(){if(!(this instanceof t))throw new TypeError("PositionOfInterest constructor cannot be called as a function.");e.apply(this,arguments),this.CLASSNAME="PositionOfInterest",this.attributesList=["bbox","importance","nature","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","Importance","Nature","Territoire","Commune","Departement","INSEE","Municipality"]}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(ServicesGeocodeRequestGeocodeLocation),ServicesGeocodeRequestModelCadastralParcel=function(e){function t(){if(!(this instanceof t))throw new TypeError("CadastralParcel constructor cannot be called as a function.");e.apply(this,arguments),this.CLASSNAME="CadastralParcel",this.attributesList=["absorbedCity","sheet","number","section","commune","department","insee","municipality","origin"],this.serviceAttributes=["CommuneAbsorbee","Feuille","Numero","Section","Commune","Departement","INSEE","Municipality","Type"]}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(ServicesGeocodeRequestGeocodeLocation),ServicesGeocodeRequestModelAdministratif=function(e){function t(){if(!(this instanceof t))throw new TypeError("Administratif constructor cannot be called as a function.");e.apply(this,arguments),this.CLASSNAME="Administratif",this.attributesList=["bbox","prefecture","inseeRegion","inseeDepartment","municipality"],this.serviceAttributes=["bbox","Prefecture","InseeRegion","InseeDepartement","Municipality"]}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(ServicesGeocodeRequestGeocodeLocation),ServicesGeocodeRequestDirectGeocodeRequestFactory=function(e,t,o,r,n,s,i,a){var c={build:function(c){var l=e.getLogger("DirectGeocodeRequestFactory");l.trace(["DirectGeocodeRequestFactory::build()"]);var u=null,p=new r;p.addFilterExtensions(new a),p.addFilterExtensions(new n),p.addFilterExtensions(new s),p.addFilterExtensions(new i);var h=new o({location:c.location,returnFreeForm:c.returnFreeForm,filterOptions:c.filterOptions});h.addFilter(p);var f=new t({srsName:c.srs,maximumResponses:c.maximumResponses});if(f.namespace=!0,f.setService(h),u=f.build(),"GET"==c.httpMethod){var d="qxml="+encodeURIComponent(u).replace(/\-/g,"%2D").replace(/\_/g,"%5F").replace(/\./g,"%2E").replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");u=d}return l.trace(u),u}};return c}(UtilsLoggerByDefault,FormatsXLS,FormatsXLSLocationUtilityService,FormatsXLSLocationUtilityServiceGeocodeFilterExtension,ServicesGeocodeRequestModelStreetAddress,ServicesGeocodeRequestModelPositionOfInterest,ServicesGeocodeRequestModelCadastralParcel,ServicesGeocodeRequestModelAdministratif),ServicesGeocodeResponseModelGeocodeResponse=function(){function e(){if(!(this instanceof e))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}return e.prototype={constructor:e},e}(),ServicesGeocodeResponseModelGeocodedLocation=function(){function e(){if(!(this instanceof e))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position={x:null,y:null},this.matchType=null,this.placeAttributes={},this.type=null}return e.prototype={constructor:e},e}(),ServicesGeocodeResponseModelDirectGeocodedLocation=function(e){function t(){if(!(this instanceof t))throw new TypeError("DirectGeocodedLocation constructor cannot be called as a function.");e.apply(this,arguments),this.CLASSNAME="DirectGeocodedLocation",this.accuracy=null}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(ServicesGeocodeResponseModelGeocodedLocation),ServicesGeocodeFormatsDirectGeocodeResponseReader=function(e,t,o,r,n){function s(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}function i(e,t){if(e.hasChildNodes())for(var o,r,n,s=e.childNodes,a=0;a<s.length;a++)if(o=s[a],1===o.nodeType)if(r=o.localName||o.baseName||o.nodeName,n=o.prefix||l.DEFAULTPREFIX,l.READERS[n][r]){var c=l.READERS[n][r];c(o,t)}else i(o,t)}function a(e){var t,o="";return e.hasChildNodes()&&(t=e.firstChild,3===t.nodeType&&(o=t.nodeValue)),o}function c(e){if(e.attributes.length>0){var t=s(e);for(var o in t)if(t.hasOwnProperty(o)){if("version"===o&&t.version!==l.VERSION)return void console.log("[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===o){if(t[o]!==l.NAMESPACES[l.DEFAULTPREFIX])return void console.log("[DirectGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var r=o.split(":")[0],n=o.split(":")[1];if("xmlns"===r&&n&&l.NAMESPACES[n]&&l.NAMESPACES[n]!==t[o])return void console.log("[DirectGeocodeResponseReader] geocode response "+o+" namespace is not the expected one");if("schemaLocation"===n&&l.SCHEMALOCATION!==t[o])return void console.log("[DirectGeocodeResponseReader] geocode response schema location is not the expected one")}}}var l={};return l.VERSION="1.2",l.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},l.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",l.DEFAULTPREFIX="xls",l.READERS={xls:{XLS:function(e){var t=new r;return c(e),i(e,t),t},GeocodedAddress:function(e,t){var o=new n;i(e,o),t&&Array.isArray(t.locations)&&t.locations.push(o)},GeocodeMatchCode:function(e,t){var o=e.getAttribute("accuracy");o&&t&&(t.accuracy=parseFloat(o));var r=e.getAttribute("matchType");r&&t&&(t.matchType=r)},Address:function(e,t){var o=e.getAttribute("countryCode");t&&o&&(t.type=o),i(e,t)},freeFormAddress:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.freeform=a(e))},Building:function(e,t){var o=e.getAttribute("number");t&&t.hasOwnProperty("placeAttributes")&&(o?t.placeAttributes.number=o:e.getAttribute("buildingName")?t.placeAttributes.number=e.getAttribute("buildingName"):e.getAttribute("subdivision")&&(t.placeAttributes.number=e.getAttribute("subdivision")))},Street:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&("StreetAddress"===t.type?t.placeAttributes.street=a(e):"CadastralParcel"===t.type&&(t.placeAttributes.cadastralParcel=a(e)))},Place:function(e,t){var o=e.getAttribute("type"),r=a(e);if(t&&t.hasOwnProperty("placeAttributes"))if("Municipality"===o)t.placeAttributes.municipality=r;else if("Bbox"===o){var n=r.split(";");4===n.length&&(t.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===o?t.placeAttributes.commune=r:"Departement"===o?t.placeAttributes.department=r:"INSEE"===o?t.placeAttributes.insee=r:"Qualite"===o?t.placeAttributes.quality=r:"Territoire"===o?t.placeAttributes.territory=r:"ID"===o?t.placeAttributes.ID=r:"ID_TR"===o?t.placeAttributes.IDTR=r:"Importance"===o?t.placeAttributes.importance=parseInt(r,10):"Nature"===o?t.placeAttributes.nature=r:"Numero"===o?t.placeAttributes.number=r:"Feuille"===o?t.placeAttributes.sheet=r:"Section"===o?t.placeAttributes.section=r:"CommuneAbsorbee"===o?t.placeAttributes.absorbedCity=r:"Arrondissement"===o?r&&(t.placeAttributes.arrondissement=r):"Type"===o?t.placeAttributes.origin=r:"Prefecture"===o?t.placeAttributes.prefecture=r:"InseeRegion"===o?t.placeAttributes.inseeRegion=r:"InseeDepartment"===o&&(t.placeAttributes.inseeDepartment=r)},PostalCode:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.postalCode=a(e))},Error:function(e){var r=e.getAttribute("message"),n=e.getAttribute("errorCode"),s=t.getMessage("SERVICE_RESPONSE_EXCEPTION","("+n+") : "+r);throw new o({message:s,type:o.TYPE_SRVERR})}},gml:{pos:function(e,t){var o=a(e);t&&o&&(t.position={x:parseFloat(o.split(" ")[0]),y:parseFloat(o.split(" ")[1])})}},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],"Exception"===o.nodeName&&(t.exceptionReport=l.READERS.Exception(o));return t},Exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},l.read=function(e){if("XLS"===e.nodeName){var r=e.prefix;r||(r=l.DEFAULTPREFIX);var n=l.READERS[r][e.nodeName](e);return n}if("ExceptionReport"===e.nodeName){var s=l.READERS[e.nodeName](e);return s}var i=t.getMessage("SERVICE_RESPONSE_ANALYSE",e.nodeName);throw new o({message:i,type:o.TYPE_UNKERR,status:200})},l}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesGeocodeResponseModelGeocodeResponse,ServicesGeocodeResponseModelDirectGeocodedLocation),ServicesGeocodeResponseDirectGeocodeResponseFactory=function(e,t,o,r,n){var s={build:function(e){var s=null;if(!e.response)return void e.onError.call(e.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EMPTY"),type:t.TYPE_SRVERR,status:-1}));if(e.rawResponse)s=e.response;else{try{var i=new r({reader:n});if("string"==typeof e.response?i.setXMLString(e.response):i.setXMLDoc(e.response),s=i.parse(),!s)throw new Error("L'analyse de la réponse du service !?")}catch(a){var c=a.message;return c+="string"==typeof e.response?"('"+e.response+"')":"('"+e.response.documentElement.innerHTML+"')",void e.onError.call(e.scope,new t({message:o.getMessage("SERVICE_RESPONSE_ANALYSE",c),type:t.TYPE_UNKERR,status:-1}))}if(s.exceptionReport)return void e.onError.call(e.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",s.exceptionReport),type:t.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,s)}};return s}(UtilsLoggerByDefault,ExceptionsErrorService,UtilsMessagesResources,FormatsXML,ServicesGeocodeFormatsDirectGeocodeResponseReader),ServicesGeocodeGeocode=function(e,t,o,r,n,s){function i(o){if(!(this instanceof i))throw new TypeError(t.getMessage("CLASS_CONSTRUCTOR","Geocode"));if(this.CLASSNAME="Geocode",r.apply(this,arguments),this.logger=e.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode(options)]"),!o.location)throw new Error(t.getMessage("PARAM_MISSING","location"));if(0===Object.keys(o.location).length)throw new Error(t.getMessage("PARAM_EMPTY","location"));this.options.location=o.location,o.filterOptions||(this.options.filterOptions=o.filterOptions={type:["StreetAddress"]}),0===Object.keys(o.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var n=Object.keys(o.filterOptions),s=0;s<n.length;s++){var a=n[s];o.filterOptions[a]&&0!==Object.keys(o.filterOptions[a]).length||delete this.options.filterOptions[a]}this.options.filterOptions.type=o.filterOptions.type||["StreetAddress"],this.options.maximumResponses=o.maximumResponses||25,this.options.returnFreeForm=o.returnFreeForm||!1,this.options.srs=o.srs||"EPSG:4326",this.options.outputFormat="xml"}return i.prototype=Object.create(r.prototype,{}),i.prototype.constructor=i,i.prototype.buildRequest=function(e,r){var s={httpMethod:this.options.httpMethod,location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=n.build(s),this.request?r.call(this,this.request):e.call(this,new o(t.getMessage("SERVICE_REQUEST_BUILD")))},i.prototype.analyzeResponse=function(e,r){if(this.response){var n={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:r,scope:this};s.build(n)}else e.call(this,new o(t.getMessage("SERVICE_RESPONSE_EMPTY")))},i}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesCommonService,ServicesGeocodeRequestDirectGeocodeRequestFactory,ServicesGeocodeResponseDirectGeocodeResponseFactory),ServicesGeocodeRequestReverseGeocodeRequestFactory=function(e,t,o){var r={build:function(r){var n=e.getLogger("ReverseGeocodeRequestFactory");n.trace(["ReverseGeocodeRequestFactory::build()"]);var s=r||{},i=null,a=new o({position:s.position,returnFreeForm:s.returnFreeForm,filterOptions:s.filterOptions}),c=new t({srsName:s.srs,maximumResponses:s.maximumResponses});if(c.namespace=!0,c.setService(a),i=c.build(),"GET"==s.httpMethod){var l="qxml="+encodeURIComponent(i).replace(/\-/g,"%2D").replace(/\_/g,"%5F").replace(/\./g,"%2E").replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");i=l}return n.trace(i),i}};return r}(UtilsLoggerByDefault,FormatsXLS,FormatsXLSLocationUtilityService),ServicesGeocodeResponseModelReverseGeocodedLocation=function(e){function t(){if(!(this instanceof t))throw new TypeError("ReverseGeocodedLocation constructor cannot be called as a function.");e.apply(this,arguments),this.CLASSNAME="ReverseGeocodedLocation",this.searchCenterDistance=null}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t}(ServicesGeocodeResponseModelGeocodedLocation),ServicesGeocodeFormatsReverseGeocodeResponseReader=function(e,t,o,r,n){function s(e){if(e.attributes.length>0){for(var t={},o=e.attributes,r=0;r<o.length;r++){var n=o[r];t[n.nodeName]=n.nodeValue}return t}}function i(e,t){if(e.hasChildNodes())for(var o,r,n,s=e.childNodes,a=0;a<s.length;a++)if(o=s[a],1===o.nodeType)if(r=o.localName||o.baseName||o.nodeName,n=o.prefix||l.DEFAULTPREFIX,l.READERS[n][r]){var c=l.READERS[n][r];c(o,t)}else i(o,t)}function a(e){var t,o="";return e.hasChildNodes()&&(t=e.firstChild,3===t.nodeType&&(o=t.nodeValue)),o}function c(e){if(e.attributes.length>0){var t=s(e);for(var o in t)if(t.hasOwnProperty(o)){if("version"===o&&t.version!==l.VERSION)return void console.log("[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if("xmlns"===o){if(t[o]!==l.NAMESPACES[l.DEFAULTPREFIX])return void console.log("[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var r=o.split(":")[0],n=o.split(":")[1];if("xmlns"===r&&n&&l.NAMESPACES[n]&&l.NAMESPACES[n]!==t[o])return void console.log("[ReverseGeocodeResponseReader] geocode response "+o+" namespace is not the expected one");if("schemaLocation"===n&&l.SCHEMALOCATION!==t[o])return void console.log("[ReverseGeocodeResponseReader] geocode response schema location is not the expected one")}}}var l={};return l.VERSION="1.2",l.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},l.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",l.DEFAULTPREFIX="xls",l.READERS={xls:{XLS:function(e){var t=new r;return c(e),i(e,t),t},ReverseGeocodedLocation:function(e,t){var o=new n;i(e,o),t&&Array.isArray(t.locations)&&t.locations.push(o)},Address:function(e,t){var o=e.getAttribute("countryCode");t&&o&&(t.type=o),i(e,t)},Building:function(e,t){var o=e.getAttribute("number");t&&t.hasOwnProperty("placeAttributes")&&(o?t.placeAttributes.number=o:e.getAttribute("buildingName")?t.placeAttributes.number=e.getAttribute("buildingName"):e.getAttribute("subdivision")&&(t.placeAttributes.number=e.getAttribute("subdivision")))},Street:function(e,t){"StreetAddress"===t.type?t.placeAttributes.street=a(e):"CadastralParcel"===t.type&&(t.placeAttributes.cadastralParcel=a(e))},Place:function(e,t){var o=e.getAttribute("type"),r=a(e);if(t&&t.hasOwnProperty("placeAttributes"))if("Municipality"===o)t.placeAttributes.municipality=r;else if("Bbox"===o){var n=r.split(";");4===n.length&&(t.placeAttributes.bbox={left:parseFloat(n[0]),right:parseFloat(n[2]),top:parseFloat(n[1]),bottom:parseFloat(n[3])})}else"Commune"===o?t.placeAttributes.commune=r:"Departement"===o?t.placeAttributes.department=r:"INSEE"===o?t.placeAttributes.insee=r:"Qualite"===o?t.placeAttributes.quality=r:"Territoire"===o?t.placeAttributes.territory=r:"ID"===o?t.placeAttributes.ID=r:"ID_TR"===o?t.placeAttributes.IDTR=r:"Importance"===o?t.placeAttributes.importance=parseInt(r,10):"Nature"===o?t.placeAttributes.nature=r:"Numero"===o?t.placeAttributes.number=r:"Feuille"===o?t.placeAttributes.sheet=r:"Section"===o?t.placeAttributes.section=r:"CommuneAbsorbee"===o?t.placeAttributes.absorbedCity=r:"Arrondissement"===o?r&&(t.placeAttributes.arrondissement=r):"Type"===o?t.placeAttributes.origin=r:"Prefecture"===o?t.placeAttributes.prefecture=r:"InseeRegion"===o?t.placeAttributes.inseeRegion=r:"InseeDepartment"===o&&(t.placeAttributes.inseeDepartment=r)},PostalCode:function(e,t){t&&t.hasOwnProperty("placeAttributes")&&(t.placeAttributes.postalCode=a(e))},SearchCentreDistance:function(e,t){t&&(t.searchCenterDistance=parseFloat(e.getAttribute("value")))},Error:function(e){var r=e.getAttribute("message"),n=e.getAttribute("errorCode"),s=t.getMessage("SERVICE_RESPONSE_EXCEPTION","("+n+") : "+r);throw new o({message:s,type:o.TYPE_SRVERR})}},gml:{pos:function(e,t){var o=a(e);t&&o&&(t.position={x:parseFloat(o.split(" ")[0]),y:parseFloat(o.split(" ")[1])})}},xlsext:{ExtendedGeocodeMatchCode:function(e,t){t&&(t.matchType=a(e))}},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],"Exception"===o.nodeName&&(t.exceptionReport=l.READERS.Exception(o));return t},Exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},l.read=function(e){if("XLS"===e.nodeName){var t=e.prefix;t||(t=l.DEFAULTPREFIX);var o=l.READERS[t][e.nodeName](e);return o}if("ExceptionReport"===e.nodeName){var r=l.READERS[e.nodeName](e);return r}throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},l}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesGeocodeResponseModelGeocodeResponse,ServicesGeocodeResponseModelReverseGeocodedLocation),ServicesGeocodeResponseReverseGeocodeResponseFactory=function(e,t,o,r,n){var s={build:function(e){var s=null;if(!e.response)return void e.onError.call(e.scope,new o({message:t.getMessage("SERVICE_RESPONSE_EMPTY"),type:o.TYPE_SRVERR,status:-1}));if(e.rawResponse)s=e.response;else{try{var i=new r({reader:n});if("string"==typeof e.response?i.setXMLString(e.response):i.setXMLDoc(e.response),s=i.parse(),!s)throw new Error("L'analyse de la réponse du service !?")}catch(a){return a.status=200,void e.onError.call(e.scope,a)}if(s.exceptionReport)return void e.onError.call(e.scope,new o({message:t.getMessage("SERVICE_RESPONSE_EXCEPTION",s.exceptionReport),type:o.TYPE_SRVERR,status:200}))}e.onSuccess.call(e.scope,s)}};return s}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,FormatsXML,ServicesGeocodeFormatsReverseGeocodeResponseReader),ServicesGeocodeReverseGeocode=function(e,t,o,r,n,s){function i(o){if(!(this instanceof i))throw new TypeError(t.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));if(this.CLASSNAME="ReverseGeocode",r.apply(this,arguments),this.logger=e.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode(options)]"),!o.position)throw new Error(t.getMessage("PARAM_MISSING","position"));if(!o.position.x)throw new Error(t.getMessage("PARAM_MISSING","position.x"));if(!o.position.y)throw new Error(t.getMessage("PARAM_MISSING","position.y"));this.options.position=o.position,o.filterOptions||(this.options.filterOptions=o.filterOptions={type:["StreetAddress"]}),0===Object.keys(o.filterOptions).length&&(this.options.filterOptions={type:["StreetAddress"]});for(var n=Object.keys(o.filterOptions),s=0;s<n.length;s++){var a=n[s];o.filterOptions[a]&&0!==Object.keys(o.filterOptions[a]).length||delete this.options.filterOptions[a]}if(this.options.filterOptions.type=o.filterOptions.type||["StreetAddress"],!Array.isArray(this.options.filterOptions.type))throw new Error(t.getMessage("PARAM_TYPE","filterOptions.type"));if(this.options.maximumResponses=o.maximumResponses||25,this.options.returnFreeForm=o.returnFreeForm||!1,this.options.srs=o.srs||"EPSG:4326",-1!==i.geoEPSG.indexOf(this.options.srs)){if(this.options.position={x:this.options.position.y,y:this.options.position.x},this.options.filterOptions&&this.options.filterOptions.circle){var c=this.options.filterOptions.circle;this.options.filterOptions.circle={x:c.y,y:c.x,radius:c.radius}}if(this.options.filterOptions&&this.options.filterOptions.polygon){var l=this.options.filterOptions.polygon;for(s=0;s<l.length;s++){var u=l[s];this.options.filterOptions.polygon[s]={x:u.y,y:u.x}}}}this.options.outputFormat="xml"}return i.prototype=Object.create(r.prototype,{}),i.prototype.constructor=i,i.prototype.buildRequest=function(e,r){var s={httpMethod:this.options.httpMethod,position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=n.build(s),this.request?r.call(this,this.request):e.call(this,new o(t.getMessage("SERVICE_REQUEST_BUILD")))},i.prototype.analyzeResponse=function(e,r){if(this.response){var n={response:this.response,rawResponse:this.options.rawResponse,onError:e,onSuccess:r,scope:this};s.build(n)}else e.call(this,new o(t.getMessage("SERVICE_RESPONSE_EMPTY")))},i.geoEPSG=["EPSG:4326","autreEPSG","encoreunautreEPSG"],i}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesCommonService,ServicesGeocodeRequestReverseGeocodeRequestFactory,ServicesGeocodeResponseReverseGeocodeResponseFactory),ServicesAutoCompleteResponseModelAutoCompleteResponse=function(){function e(){if(!(this instanceof e))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}return e.prototype={constructor:e},e}(),ServicesAutoCompleteResponseModelSuggestedLocation=function(){function e(){if(!(this instanceof e))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}return e.prototype={constructor:e},e}(),ServicesAutoCompleteResponseAutoCompleteResponseFactory=function(e,t,o,r,n,s){var i={build:function(r){var i=e.getLogger("AutoCompleteResponseFactory");i.trace(["AutoCompleteResponseFactory::build()"]);var a=null;if(!r.response)return void r.onError.call(r.scope,new t(o.getMessage("SERVICE_RESPONSE_EMPTY")));if(r.rawResponse)i.trace("analyze response : raw"),a=r.response;else{var c;if(c="string"==typeof r.response?window.JSON.parse(r.response):r.response){if(c.error)return void r.onError.call(r.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",c.error.description),status:c.error.code,type:t.TYPE_SRVERR}));if(a=new n,!c.results||!Array.isArray(c.results))return void r.onError.call(r.scope,new t(o.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var l,u=0;u<c.results.length;u++){var p=c.results[u];l=new s,l&&(p&&"StreetAddress"===p.country?(l.street=p.street,l.type="StreetAddress"):p&&"PositionOfInterest"===p.country&&(l.poi=p.street,l.kind=p.kind,l.type="PositionOfInterest"),l.position&&(l.position.x=p.x,l.position.y=p.y),l.commune=p.city,l.fullText=p.fulltext,l.postalCode=p.zipcode,l.classification=p.classification),a.suggestedLocations.push(l)}if(!a.suggestedLocations.length)return void r.onError.call(r.scope,new t(o.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!a)return void r.onError.call(r.scope,new t({message:o.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:t.TYPE_UNKERR,status:-1}));if(a.exceptionReport)return void r.onError.call(r.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",a.exceptionReport),type:t.TYPE_SRVERR,status:200}))}r.onSuccess.call(r.scope,a)}};return i}(UtilsLoggerByDefault,ExceptionsErrorService,UtilsMessagesResources,FormatsXML,ServicesAutoCompleteResponseModelAutoCompleteResponse,ServicesAutoCompleteResponseModelSuggestedLocation),ServicesAutoCompleteAutoComplete=function(e,t,o,r,n,s){function i(t){if(!(this instanceof i))throw new TypeError(r.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));if(this.CLASSNAME="AutoComplete",e.apply(this,arguments),this.logger=o.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete(options)]"),!t.text)throw new Error(r.getMessage("PARAM_MISSING","text"));this.options.text=t.text,t.filterOptions||(this.options.filterOptions=t.filterOptions={territory:[],type:["StreetAddress"]}),0===Object.keys(t.filterOptions).length&&(this.options.filterOptions={territory:[],type:["StreetAddress"]}),this.options.filterOptions.type=t.filterOptions.type||["StreetAddress"],this.options.filterOptions.territory=t.filterOptions.territory||[],this.options.maximumResponses=t.maximumResponses||10,"XHR"===this.options.protocol&&"POST"===this.options.httpMethod&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat="json"}return i.prototype=Object.create(e.prototype,{}),i.prototype.constructor=i,i.prototype.buildRequest=function(e,t){var o="";this.options.filterOptions.territory&&(o=this.options.filterOptions.territory.join(","));var r="";this.options.filterOptions.type&&(r=this.options.filterOptions.type.join(",")),this.request=s.normalyzeParameters({text:encodeURIComponent(this.options.text),type:r,terr:o,maximumResponses:this.options.maximumResponses}),t.call(this,this.request)},i.prototype.analyzeResponse=function(e,o){if(this.response){var s={response:this.response,rawResponse:this.options.rawResponse,onSuccess:o,onError:e,scope:this};t.build(s)}else e.call(this,new n(r.getMessage("SERVICE_RESPONSE_EMPTY")))},i}(ServicesCommonService,ServicesAutoCompleteResponseAutoCompleteResponseFactory,UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,UtilsHelper),FormatsXLSRouteServiceModelRoutePlan=function(e){function t(o){if(this.logger=e.getLogger("RoutePlan"),this.logger.trace("[Constructeur RoutePlan()]"),!(this instanceof t))throw new TypeError("RoutePlan constructor cannot be called as a function.");if(this.options=o||{},!o.startPoint)throw new Error("l'option 'startPoint' n'est pas renseignée !");if(!o.endPoint)throw new Error("l'option 'endPoint' n'est pas renseignée !");for(var r in o)o.hasOwnProperty(r)&&(this.options[r]=o[r])}return t.prototype={constructor:t,requestString:null,template:{routePlan:"			<RoutePlan>\n__ROUTEPREFERENCE__\n__GRAPH__\n__WAYPOINTLIST__ \n__AVOIDLIST__ \n			</RoutePlan>",routePreference:"				<RoutePreference>__VALUEROUTEPREFERENCE__</RoutePreference>",graph:'				<xlsext:graphName xmlns:xlsext="http://www.opengis.net/xlsext" name="__VALUEGRAPH__"/>',wayPointList:{container:"				<WayPointList>\n__STARTPOINT____VIAPOINT____ENDPOINT__				</WayPointList>\n",point:'						<Position><gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point></Position>',startPoint:"					<StartPoint>\n__POINT__\n					</StartPoint>\n",endPoint:"					<EndPoint>\n__POINT__\n					</EndPoint>\n",viaPoint:"					<ViaPoint>\n__POINT__\n					</ViaPoint>\n"},avoidList:{container:"				<AvoidList>\n__AVOIDFEATURE__\n				</AvoidList>",
avoidFeature:"					<AvoidFeature>__VALUEAVOIDFEATURE__</AvoidFeature>"}},toString:function(){var e="";if(e=this.template.routePlan,this.options.routePreference){var t=this.template.routePreference;t=t.replace(/__VALUEROUTEPREFERENCE__/,this.options.routePreference),e=e.replace(/__ROUTEPREFERENCE__/g,t)}if(e=e.replace(/__ROUTEPREFERENCE__/g,""),this.options.avoidFeature){for(var o=this.template.avoidList.container,r=[],n=0;n<this.options.avoidFeature.length;n++){var s=this.template.avoidList.avoidFeature;s=s.replace(/__VALUEAVOIDFEATURE__/,this.options.avoidFeature[n]),r.push(s)}o=o.replace(/__AVOIDFEATURE__/,r.join("\n")),e=e.replace(/__AVOIDLIST__/g,o)}if(e=e.replace(/__AVOIDLIST__/g,""),this.options.graph){var i=this.template.graph;i=i.replace(/__VALUEGRAPH__/,this.options.graph),e=e.replace(/__GRAPH__/g,i)}e=e.replace(/__GRAPH__/g,"");var a=this.template.wayPointList.container,c="";if(c=this.template.wayPointList.point,c=c.replace(/__X__/,this.options.startPoint.x),c=c.replace(/__Y__/,this.options.startPoint.y),a=a.replace(/__STARTPOINT__/,this.template.wayPointList.startPoint.replace(/__POINT__/,c)),c=this.template.wayPointList.point,c=c.replace(/__X__/,this.options.endPoint.x),c=c.replace(/__Y__/,this.options.endPoint.y),a=a.replace(/__ENDPOINT__/,this.template.wayPointList.endPoint.replace(/__POINT__/,c)),this.options.viaPoint){for(var l=[],u=0;u<this.options.viaPoint.length;u++){var p=this.options.viaPoint[u];c=this.template.wayPointList.point,c=c.replace(/__X__/,p.x),c=c.replace(/__Y__/,p.y),l.push(c)}a=a.replace(/__VIAPOINT__/,this.template.wayPointList.viaPoint.replace(/__POINT__/,l.join("\n")))}else a=a.replace(/__VIAPOINT__/,"");return e=e.replace(/__WAYPOINTLIST__/g,a),this.requestString=e,this.requestString}},t}(UtilsLoggerByDefault),FormatsXLSRouteServiceDetermineRouteRequest=function(e,t){function o(t){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur DetermineRouteRequest()]"),!(this instanceof o))throw new TypeError("DetermineRouteRequest constructor cannot be called as a function.");this.options=t||{};for(var r in t)t.hasOwnProperty(r)&&(this.options[r]=t[r]);this.CLASSNAME="DetermineRouteRequest"}return o.prototype={strRequest:null,oRoutePlan:null,template:{determineRouteRequest:'		<DetermineRouteRequest distanceUnit="__DISTANCEUNIT__">\n__ROUTEPLAN__ \n__ROUTEINSTRUCTIONREQUEST__ \n__ROUTEGEOMETRYREQUEST__ \n__ROUTEMAPREQUEST__ \n		</DetermineRouteRequest>',routeInstructionRequest:'			<RouteInstructionsRequest provideGeometry="__PROVIDEGEOMETRY__" provideBoundingBox="__PROVIDEBBOX__" />',routeGeometryRequest:"			<RouteGeometryRequest />",routeMapRequest:"			"},addRoute:function(e){e instanceof t&&(this.oRoutePlan=e)},constructor:o,toString:function(){var e="";if(e=this.template.determineRouteRequest,e=e.replace(/__DISTANCEUNIT__/g,this.options.distanceUnit||"KM"),!this.oRoutePlan){var o=this.options.route;if(this.oRoutePlan=new t(o),!this.oRoutePlan)throw new Error("La construction du calcul d'initineraire n'est pas correctement definie !?")}e=e.replace(/__ROUTEPLAN__/g,this.oRoutePlan.toString());var r=this.template.routeInstructionRequest;r=r.replace(/__PROVIDEGEOMETRY__/g,this.options.provideGeometry||!1),r=r.replace(/__PROVIDEBBOX__/g,this.options.provideBoundingBox||!1),e=e.replace(/__ROUTEINSTRUCTIONREQUEST__/g,r);var n=this.template.routeGeometryRequest;e=e.replace(/__ROUTEGEOMETRYREQUEST__/g,n);var s=this.template.routeMapRequest;return e=e.replace(/__ROUTEMAPREQUEST__/g,s),this.strRequest=e,this.strRequest}},o}(UtilsLoggerByDefault,FormatsXLSRouteServiceModelRoutePlan),FormatsXLSRouteServiceRouteRequestExtension=void 0,FormatsXLSRouteService=function(e,t,o,r){function n(o){if(this.logger=e.getLogger(),this.logger.trace("[Constructeur RouteService()]"),!(this instanceof n))throw new TypeError("RouteService constructor cannot be called as a function.");this.CLASSNAME="RouteService",this.CLASSTYPE="RouteRequest",t.apply(this,arguments)}return n.prototype=Object.create(t.prototype,{}),n.prototype.constructor=n,n.prototype.addRequest=function(e){if("DetermineRouteRequest"!==e.CLASSNAME)throw new Error("Ce n'est pas un objet de type 'Route Request' !?");this.oRequest=e},n.prototype.addFilter=function(e){e instanceof r&&(this.oFilter=e)},n.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseignées, impossible de construire la requête !");if("RouteRequest"===this.CLASSTYPE){var e={distanceUnit:this.options.distanceUnit||null,provideGeometry:this.options.provideGeometry||null,provideBoundingBox:this.options.provideBoundingBox||null,route:{routePreference:this.options.routePreference||null,startPoint:this.options.startPoint,viaPoint:this.options.viaPoint||null,endPoint:this.options.endPoint,avoidFeature:this.options.avoidFeature||null,graph:this.options.graph||null,expectedStartTime:this.options.expectedStartTime||null}};this.oRequest=new o(e),this.oFilter&&this.oRequest.addFilter(this.oFilter)}}if(!this.oRequest)throw new Error("Type de requête indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest},n}(UtilsLoggerByDefault,FormatsXLSAbstractService,FormatsXLSRouteServiceDetermineRouteRequest,FormatsXLSRouteServiceRouteRequestExtension),ServicesRouteRequestRouteRequestOLS=function(e,t,o){var r={build:function(r){var n=e.getLogger("RouteRequestOLS");n.trace(["RouteRequestOLS::build()"]);var s=null,i={startPoint:r.startPoint,endPoint:r.endPoint,viaPoint:r.viaPoints,provideBoundingBox:r.provideBbox,avoidFeature:r.exclusions,expectedStartTime:r.expectedStartTime,distanceUnit:r.distanceUnit,graph:r.graph,provideGeometry:r.provideGeometry,routePreference:r.routePreference},a=new o(i),c=new t({srsName:r.srs,maximumResponses:r.maximumResponses});if(c.namespace=!0,c.setService(a),s=c.build(),"GET"==r.httpMethod){var l="qxml="+encodeURIComponent(s).replace(/\-/g,"%2D").replace(/\_/g,"%5F").replace(/\./g,"%2E").replace(/\!/g,"%21").replace(/\~/g,"%7E").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29");s=l}return s}};return r}(UtilsLoggerByDefault,FormatsXLS,FormatsXLSRouteService),ServicesRouteRequestModelRouteParamREST=function(e){function t(o){if(!(this instanceof t))throw new TypeError("RouteParamREST constructor cannot be called as a function.");if(this.logger=e.getLogger(),this.logger.trace("[Constructeur RouteParamREST()]"),this.options=o||{},this.origin=this.options.startPoint.x+","+this.options.startPoint.y,this.destination=this.options.endPoint.x+","+this.options.endPoint.y,this.waypoints=this.options.viaPoints||null,this.startDateTime=this.options.expectedStartTime||null,this.graphName=this.options.graph,this.srs=this.options.srs,this.exclusions=this.options.exclusions,this.method="TIME",this.options.routePreference){var r=this.options.routePreference;switch(r){case"fastest":this.method="TIME";break;case"shortest":this.method="DISTANCE";break;default:this.logger.warn("Par defaut, on prend l'itinéraire le plus rapide !"),this.method="TIME"}}this.format="STANDARD",this.tolerance=10,this.profileId=null,this.profileName=null}return t.CLASSNAME="RouteParamREST",t.prototype={constructor:t,getWaypoints:function(){if(this.waypoints){for(var e=[],t=0;t<this.waypoints.length;t++){var o=this.waypoints[t];e.push(o.x+","+o.y)}return e.join(";")}},getExclusions:function(){return this.exclusions.join(";")}},t.prototype.getParams=function(){var e=[];return e.push({k:"origin",v:this.origin}),e.push({k:"destination",v:this.destination}),e.push({k:"method",v:this.method}),this.waypoints&&e.push({k:"waypoints",v:this.getWaypoints()}),this.startDateTime&&e.push({k:"startDateTime",v:this.startDateTime}),this.graphName&&e.push({k:"graphName",v:this.graphName}),this.exclusions&&e.push({k:"exclusions",v:this.getExclusions()}),this.srs&&e.push({k:"srs",v:this.srs}),e},t}(UtilsLoggerByDefault),ServicesRouteRequestRouteRequestREST=function(e,t,o){function r(o){if(this.logger=e.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST()]"),!(this instanceof r))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!o)throw new Error(t.getMessage("PARAM_EMPTY","options"));this.settings=o}return r.prototype={requestString:null,constructor:r,processRequestString:function(){this.logger.warn("FIXME : PROTOTYPE !");var e=new o(this.settings),t=e.getParams(),r="";for(var n in t)r&&(r+="&"),r+=t[n].k+"="+t[n].v;return this.logger.trace(r),this.requestString=r,this.requestString}},r}(UtilsLoggerByDefault,UtilsMessagesResources,ServicesRouteRequestModelRouteParamREST),ServicesRouteRequestRouteRequestFactory=function(e,t,o,r){var n={build:function(n){var s=e.getLogger("RouteRequestFactory");s.trace(["RouteRequestFactory::build()"]);var i=null,a=n||{},c=null!==n.onError&&"function"==typeof n.onError?!0:!1,l=null;switch(n.api){case"REST":var u=new r(a);if(!u.processRequestString()){if(l="Error process request (rest) !",c)return void n.onError.call(n.scope,new t(l));throw new Error(l)}i=u.requestString;break;case"OLS":if(i=o.build(a),!i){if(l="Error process request (ols) !",c)return void n.onError.call(n.scope,new t(l));throw new Error(l)}break;default:if(l="Type of API is not supported by service (REST or OLS) !",c)return void n.onError.call(n.scope,new t(l));throw new Error(l)}return i}};return n}(UtilsLoggerByDefault,ExceptionsErrorService,ServicesRouteRequestRouteRequestOLS,ServicesRouteRequestRouteRequestREST),FormatsWKT=function(e){var t={toJson:function(t,o,r){var n=e.getLogger(),s=null;try{if(!t)throw new Error("La chaine WKT n'est pas renseignée !");o||(o=function(e){console.log(e)}),r||(r=function(e){console.log(e)});var i,a,c;if(i=/(-?\d+\.?[0-9]*)\s(-?\d+\.?[0-9]+)/g,a="[$1,$2]",t=t.replace(i,a),i=/^(\w+)/,c=i.exec(t),"POLYGON"===RegExp.$1?(a='{"type" : "Polygon",',t=t.replace(RegExp.$1,a),i=/(\({2}?)/,a='"coordinates" : [[',t=t.replace(i,a),i=/(\){2}?)/,a="]]}",t=t.replace(i,a),i=/(\()/g,a="[",t=t.replace(i,a),i=/(\))/g,a="]",t=t.replace(i,a)):"LINESTRING"===RegExp.$1&&(a='{"type" : "LineString",',t=t.replace(RegExp.$1,a),i=/(\(\(?)/,a='"coordinates" : [',t=t.replace(i,a),i=/(\)\)?)/,a="]}",t=t.replace(i,a)),n.trace(t),s=JSON.parse(t),!s)throw new Error("Le JSON est vide !");if(!s.type)throw new Error("Le type de geometrie n'est pas connu !");if(!s.coordinates)throw new Error("La liste des points est vide !");o.call(this,s)}catch(l){if("SyntaxError"===l.name)return void r.call(this,"Erreur de parsing JSON !");r.call(this,l)}}};return t}(UtilsLoggerByDefault),ServicesRouteResponseModelRouteResponse=function(){function e(){if(!(this instanceof e))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}return e.prototype={constructor:e},e}(),ServicesRouteResponseModelRouteInstruction=function(){function e(){if(!(this instanceof e))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null}return e.prototype={constructor:e},e}(),ServicesRouteFormatsRouteResponseRESTReader=function(e,t,o,r,n,s){function i(e){var t,o="";return e.hasChildNodes()&&(t=e.firstChild,t&&3===t.nodeType&&(o=t.nodeValue)),o}function a(e,t){if(e.hasChildNodes())for(var o,r,n=e.childNodes,s=0;s<n.length;s++)if(o=n[s],1===o.nodeType)if(r=o.localName||o.baseName||o.nodeName,c.READERS[r]){var i=c.READERS[r];i(o,t)}else a(o,t)}var c={};return c.READERS={routeResult:function(e){var t=new n;if(a(e,t),"error"===t.status){var s=o.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new r({message:s,type:r.TYPE_SRVERR})}return t},status:function(e,t){var o=i(e);("ERROR"===o||"error"===o)&&t&&(t.status="error")},message:function(e,t){t&&(t.message=i(e))},distance:function(e,t){t&&(t.totalDistance=i(e))},durationSeconds:function(e,t){t&&(t.totalTime=parseFloat(i(e)))},bounds:function(e,t){if(t&&t.bbox){var o=i(e).split(/[,;]/);t.bbox.left=parseFloat(o[0]),t.bbox.bottom=parseFloat(o[1]),t.bbox.right=parseFloat(o[2]),t.bbox.top=parseFloat(o[3])}},geometryWkt:function(e,r){if(r){var n=e.innerHTML,s=function(e){r.routeGeometry=e},i=function(){var e=o.getMessage("PARAM_FORMAT",["geometryWkt"]);throw new Error(e)};t.toJson(n,s,i)}},step:function(e,t){var o,r=new s;if(e.hasChildNodes)for(var n,a,c=e.childNodes,l=0;l<c.length;l++)n=c[l],1===n.nodeType&&(a=n.localName||n.baseName||n.nodeName,"durationSeconds"===a?r.duration=i(n):"distance"===a?r.distance=i(n):"navInstruction"===a?r.code=i(n):"name"===a&&(o=i(n)));if(r.code)switch(r.code){case"F":"Valeur non renseignée"!=o?r.instruction="Tout droit "+o:r.instruction="Continuer tout droit ";break;case"B":r.instruction="Demi-tour "+o;break;case"L":r.instruction="Tourner à gauche "+o;break;case"R":r.instruction="Tourner à droite "+o;break;case"BL":r.instruction="Tourner très à gauche "+o;break;case"BR":r.instruction="Tourner très à droite "+o;break;case"FL":r.instruction="Tourner légèrement à gauche "+o;break;case"FR":r.instruction="Tourner légèrement à droite "+o;break;case"round_about_entry":r.instruction="Entrée rond-point "+o;break;case"round_about_exit":r.instruction="Sortie rond-point "+o;break;case null:r.instruction="Prendre "+o;break;default:r.instruction="?"+r.code+"? "+o}Array.isArray(t.routeInstructions)&&t.routeInstructions.push(r)}},c.read=function(e){var t;if("routeResult"===e.nodeName)return t=c.READERS.routeResult(e);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")},c}(UtilsLoggerByDefault,FormatsWKT,UtilsMessagesResources,ExceptionsErrorService,ServicesRouteResponseModelRouteResponse,ServicesRouteResponseModelRouteInstruction),ServicesRouteFormatsRouteResponseOLSReader=function(e){var t={};return t.READERS={},t.read=function(t){var o=e.getLogger("RouteResponseOLSReader");o.error("not yet implemented !")},t}(UtilsLoggerByDefault),ServicesRouteResponseRouteResponseFactory=function(e,t,o,r,n,s,i,a,c){var l={build:function(l){var u=e.getLogger("RouteResponseFactory");u.trace("RouteResponseFactory::build()");var p=null;if(!l.response)return void l.onError.call(l.scope,new t(n.getMessage("SERVICE_RESPONSE_EMPTY")));if(l.rawResponse)u.trace("analyze response : raw"),p=l.response;else{switch(l.outputFormat){case"xml":u.trace("analyze response : xml");var h="REST"===l.api?s:i;try{var f=new o({reader:h});if("string"==typeof l.response?f.setXMLString(l.response):f.setXMLDoc(l.response),p=f.parse(),!p)throw new t(n.getMessage("SERVICE_RESPONSE_FORMAT","xml"))}catch(d){return void l.onError.call(l.scope,new t(n.getMessage("SERVICE_RESPONSE_ANALYSE",l.response)))}break;case"json":u.trace("analyze response : json");var g;if(g="string"==typeof l.response?window.JSON.parse(l.response):l.response,g.message)return void l.onError.call(l.scope,new t(n.getMessage("SERVICE_RESPONSE_EXCEPTION",g.message)));if(g){var m=[],v=[],y=[];if(p=new a,p.hasOwnProperty("totalTime")&&(p.totalTime=parseFloat(g.durationSeconds)),p.hasOwnProperty("totalDistance")&&(p.totalDistance=g.distance),p.hasOwnProperty("bbox")){var S=g.bounds.split(/[,;]/);p.bbox.left=parseFloat(S[0]),p.bbox.bottom=parseFloat(S[1]),p.bbox.right=parseFloat(S[2]),p.bbox.top=parseFloat(S[3])}var R=function(e){p.routeGeometry=e},E=function(e){console.log(e),l.onError.call(l.scope,new t(n.getMessage("PARAM_FORMAT",["geometryWkt"])))};if(p.hasOwnProperty("routeGeometry")&&(r.toJson(g.geometryWkt,R,E),!p.routeGeometry))return;if(p.hasOwnProperty("routeInstructions")){var _,w=g.legs;if(Array.isArray(w)&&w.length)for(_=0;_<w.length;_++)m.push(w[_]);if(Array.isArray(m)&&m.length)for(_=0;_<m.length;_++)v.push(m[_].steps);if(Array.isArray(v)&&v.length)for(_=0;_<v.length;_++)y=y.concat(v[_]);y.forEach(function(e){switch(p.routeInstructions.push(new c),p.routeInstructions[p.routeInstructions.length-1].duration=e.duration,p.routeInstructions[p.routeInstructions.length-1].distance=e.distance,p.routeInstructions[p.routeInstructions.length-1].code=e.navInstruction,e.navInstruction){case"F":"Valeur non renseignée"!=e.name?p.routeInstructions[p.routeInstructions.length-1].instruction="Tout droit "+e.name:p.routeInstructions[p.routeInstructions.length-1].instruction="Continuer tout droit ";break;case"B":p.routeInstructions[p.routeInstructions.length-1].instruction="Demi-tour "+e.name;break;case"L":p.routeInstructions[p.routeInstructions.length-1].instruction="Tourner à gauche "+e.name;break;case"R":p.routeInstructions[p.routeInstructions.length-1].instruction="Tourner à droite "+e.name;break;case"BL":p.routeInstructions[p.routeInstructions.length-1].instruction="Tourner très à gauche "+e.name;break;case"BR":p.routeInstructions[p.routeInstructions.length-1].instruction="Tourner très à droite "+e.name;break;case"FL":p.routeInstructions[p.routeInstructions.length-1].instruction="Tourner légèrement à gauche "+e.name;break;case"FR":p.routeInstructions[p.routeInstructions.length-1].instruction="Tourner légèrement à droite "+e.name;break;case"round_about_entry":p.routeInstructions[p.routeInstructions.length-1].instruction="Entrée rond-point "+e.name;break;case"round_about_exit":p.routeInstructions[p.routeInstructions.length-1].instruction="Sortie rond-point "+e.name;break;case null:p.routeInstructions[p.routeInstructions.length-1].instruction="Prendre "+e.name;break;default:p.routeInstructions[p.routeInstructions.length-1].instruction="?"+e.navInstruction+"? "+e.name}})}}if(!p)return void l.onError.call(l.scope,new t(n.getMessage("SERVICE_RESPONSE_ANALYSE","json")));break;default:return void l.onError.call(l.scope,new t(n.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(p&&p.exceptionReport)return void l.onError.call(l.scope,new t(n.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}l.onSuccess.call(l.scope,p)}};return l}(UtilsLoggerByDefault,ExceptionsErrorService,FormatsXML,FormatsWKT,UtilsMessagesResources,ServicesRouteFormatsRouteResponseRESTReader,ServicesRouteFormatsRouteResponseOLSReader,ServicesRouteResponseModelRouteResponse,ServicesRouteResponseModelRouteInstruction),ServicesRouteRoute=function(e,t,o,r,n,s,i){function a(o){if(!(this instanceof a))throw new TypeError(t.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",r.apply(this,arguments),this.logger=e.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route(options)]"),!o.startPoint)throw new Error(t.getMessage("PARAM_MISSING","startPoint"));if(!o.startPoint.x)throw new Error(t.getMessage("PARAM_MISSING","startPoint.x"));if(!o.startPoint.y)throw new Error(t.getMessage("PARAM_MISSING","startPoint.y"));if(!o.endPoint)throw new Error(t.getMessage("PARAM_MISSING","endPoint"));if(!o.endPoint.x)throw new Error(t.getMessage("PARAM_MISSING","endPoint.x"));if(!o.endPoint.y)throw new Error(t.getMessage("PARAM_MISSING","endPoint.y"));if(this.options.api="string"==typeof o.api?o.api.toUpperCase():"REST",this.options.outputFormat="string"==typeof o.outputFormat?o.outputFormat.toLowerCase():"json",this.options.startPoint=o.startPoint,this.options.endPoint=o.endPoint,this.options.viaPoints=o.viaPoints||null,this.options.exclusions=o.exclusions||null,this.options.routePreference=o.routePreference||"fastest",this.options.graph=o.graph||"Voiture",this.options.provideGeometry=o.provideGeometry||!1,this.options.provideBbox=o.provideBbox||!0,this.options.distanceUnit=o.distanceUnit||"km",this.options.expectedStartTime=null,this.options.srs=o.srs||"EPSG:4326",this.options.api="REST",this.logger.warn("FIXME: Surcharge option 'api' : REST"),"XHR"===this.options.protocol&&(this.options.httpMethod="GET",this.logger.trace("Surcharge option 'HttpMethod' : "+this.options.httpMethod)),!this.options.serverUrl){var s=n.Route.url(this.options.apiKey),i=null;switch(this.options.api){case"OLS":i=s.ols;break;case"REST":var c="route-"+this.options.outputFormat;i=s[c];break;default:throw new Error(t.getMessage("PARAM_UNKNOWN","api"))}if(!i)throw new Error("Url by default not found !");this.options.serverUrl=i,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var l=this.options.serverUrl.lastIndexOf(".");if(-1!==l){var u=this.options.serverUrl.substring(l+1);if(u&&u.length<5)switch(this.logger.trace("Serveur Extension URL : "+u),u.toLowerCase()){case"json":case"xml":this.options.outputFormat=u.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}return a.prototype=Object.create(r.prototype,{}),a.prototype.constructor=a,a.prototype.buildRequest=function(e,r){var n={api:this.options.api,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,exclusions:this.options.exclusions,distanceUnit:this.options.distanceUnit,graph:this.options.graph,provideGeometry:this.options.provideGeometry,routePreference:this.options.routePreference,srs:this.options.srs};this.request=s.build(n),this.request?r.call(this,this.request):e.call(this,new o(t.getMessage("SERVICE_REQUEST_BUILD")))},a.prototype.analyzeResponse=function(e,r){if(this.response){var n={response:this.response,outputFormat:this.options.outputFormat,api:this.options.api,rawResponse:this.options.rawResponse,onError:e,onSuccess:r,scope:this};i.build(n)}else e.call(this,new o(t.getMessage("SERVICE_RESPONSE_EMPTY")))},a}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesCommonService,ServicesDefaultUrlService,ServicesRouteRequestRouteRequestFactory,ServicesRouteResponseRouteResponseFactory),ServicesProcessIsoCurveRequestModelProcessIsoCurveParam=function(e){function t(o){if(!(this instanceof t))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=e.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam()]"),this.options=o||{},this.id=this.options.id,this.location=this.options.position,this.srs=this.options.srs,this.graphName=this.options.graph,this.profileId=this.options.profileId||null,this.profileName=this.options.profileName||null,this.exclusions=this.options.exclusions,this.reverse=this.options.reverse,this.smoothing=this.options.smoothing,this.holes=this.options.holes;var r=this.options.method;switch(r){case"time":this.method="time",this.time=this.options.time;break;case"distance":this.method="distance",this.distance=this.options.distance;break;default:this.logger.warn("Par defaut, on calcule un isochrone !"),this.method="time"}}return t.CLASSNAME="ProcessIsoCurveParam",t.prototype={constructor:t,getLocation:function(){return this.location.x+","+this.location.y},getExclusions:function(){return this.exclusions.join(";")}},t.prototype.getParams=function(){var e=[];return e.push({k:"location",v:this.getLocation()}),e.push({k:"smoothing",v:this.smoothing}),e.push({k:"holes",v:this.holes}),e.push({k:"reverse",v:this.reverse}),e.push({k:"method",v:this.method}),this.time&&e.push({k:"time",v:this.time}),this.distance&&e.push({k:"distance",v:this.distance}),e.push({k:"graphName",v:this.graphName}),this.exclusions&&e.push({k:"exclusions",v:this.getExclusions()}),this.srs&&e.push({k:"srs",v:this.srs}),e},t}(UtilsLoggerByDefault),ServicesProcessIsoCurveRequestProcessIsoCurveRequest=function(e,t,o){function r(o){if(this.logger=e.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest()]"),!(this instanceof r))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!o)throw new Error(t.getMessage("PARAM_EMPTY","options"));this.settings=o,this.mode=this.settings.httpMethod||"GET"}return r.prototype={requestString:null,constructor:r,template:{container:'<?xml version="1.0" encoding="UTF-8"?>\n<isochroneRequest>\n__ID__	<location>\n		<x>__X__</x>\n		<y>__Y__</y>\n	</location>\n	<srs>__SRS__</srs>\n	<graphName>__GRAPHNAME__</graphName>\n__PROFIL____EXCLUSIONS__	<method>__METHOD__</method>\n__TIME____DISTANCE__	<reverse>__REVERSE__</reverse>\n	<smoothing>__SMOOTHING__</smoothing>\n	<holes>__HOLES__</holes>\n</isochroneRequest>',id:"	<id>__IDVALUE__</id>\n",profil:"	<profileId>__PROFILID__</profileId>\n	<profileName>__PROFILNAME__</profileName>\n",exclusions:{container:"	<exclusions>\n__EXCLUSIONFEATURE__\n	</exclusions>\n",feature:"		<exclusion>__EXCLUSIONVALUE__</exclusion>"},time:"	<time>__TIMEVALUE__</time>\n",distance:"	<distance>__DISTANCEVALUE__</distance>\n"},processRequestString:function(){var e="";switch(this.mode){case"GET":this.logger.trace("Process GET Request");var t=new o(this.settings),r=t.getParams();for(var n in r)e&&(e+="&"),e+=r[n].k+"="+r[n].v;break;case"POST":if(this.logger.trace("Process POST Request"),e=this.template.container,e=e.replace(/__ID__/g,""),e=e.replace(/__PROFIL__/g,""),e=e.replace(/__X__/g,this.settings.position.x),e=e.replace(/__Y__/g,this.settings.position.y),e=e.replace(/__GRAPHNAME__/g,this.settings.graph),e=e.replace(/__SRS__/g,this.settings.srs),e=e.replace(/__SMOOTHING__/g,this.settings.smoothing),e=e.replace(/__HOLES__/g,this.settings.holes),e=e.replace(/__REVERSE__/g,this.settings.reverse),this.settings.exclusions){for(var s=this.template.exclusions.container,i=[],a=0;a<this.settings.exclusions.length;a++){var c=this.template.exclusions.feature;c=c.replace(/__EXCLUSIONVALUE__/,this.settings.exclusions[a]),i.push(c)}s=s.replace(/__EXCLUSIONFEATURE__/,i.join("\n")),e=e.replace(/__EXCLUSIONS__/g,s)}if(e=e.replace(/__EXCLUSIONS__/g,""),this.settings.distance){var l=this.template.distance;l=l.replace(/__DISTANCEVALUE__/g,this.settings.distance),e=e.replace(/__DISTANCE__/g,l),e=e.replace(/__METHOD__/g,"distance")}if(e=e.replace(/__DISTANCE__/g,""),this.settings.time){var u=this.template.time;u=u.replace(/__TIMEVALUE__/g,this.settings.time),e=e.replace(/__TIME__/g,u),e=e.replace(/__METHOD__/g,"time")}e=e.replace(/__TIME__/g,"");break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(e),this.requestString=e,this.requestString}},r}(UtilsLoggerByDefault,UtilsMessagesResources,ServicesProcessIsoCurveRequestModelProcessIsoCurveParam),ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse=function(){function e(){if(!(this instanceof e))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}return e.prototype={constructor:e},e}(),ServicesProcessIsoCurveFormatsProcessIsoCurveResponseReader=function(e,t,o,r,n){function s(e){var t,o="";return e.hasChildNodes()&&(t=e.firstChild,t&&3===t.nodeType&&(o=t.nodeValue)),o}var i={};return i.READERS={isochronResult:function(e){var t=new n;if(e.hasChildNodes())for(var s,a=e.childNodes,c=0;c<a.length;c++)s=a[c],i.READERS[s.nodeName]&&i.READERS[s.nodeName](s,t);if("error"===t.status){var l=r.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new o({message:l,type:o.TYPE_SRVERR})}return t},message:function(e,t){t&&(t.message=s(e))},status:function(e,t){var o=s(e);("ERROR"===o||"error"===o)&&t&&(t.status="error")},id:function(e,t){t&&(t.id=s(e))},location:function(e,t){var o=s(e);t&&t.location&&(t.location.x=parseFloat(o.split(",")[0]),t.location.y=parseFloat(o.split(",")[1]))},srs:function(e,t){t&&(t.srs=s(e))},distance:function(e,t){t&&(t.distance=parseFloat(s(e)))},time:function(e,t){t&&(t.time=parseFloat(s(e)))},wktGeometry:function(e,o){if(o){var n=e.innerHTML,s=function(e){o.geometry=e},i=function(){var e=r.getMessage("PARAM_FORMAT",["wktGeometry"]);throw new Error(e)};o.hasOwnProperty("geometry")&&t.toJson(n,s,i)}},serviceResult:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],i.READERS[o.nodeName]&&i.READERS[o.nodeName](o,t);return t},ExceptionReport:function(e){var t={};if(e.hasChildNodes())for(var o,r=e.childNodes,n=0;n<r.length;n++)o=r[n],"Exception"===o.nodeName&&(t.exceptionReport=i.READERS.Exception(o));return t},Exception:function(e){var t={},o=e.getAttribute("exceptionCode");o&&(t.exceptionCode=o);var r=e.firstChild;return r&&3===r.nodeType&&(t.exception=r.nodeValue),t}},i.read=function(e){var t;if("isochronResult"===e.nodeName||"isochroneResult"===e.nodeName||"IsochroneResult"===e.nodeName)return t=i.READERS.isochronResult(e);if("ExceptionReport"===e.nodeName)return t=i.READERS[e.nodeName](e);if(i.READERS[e.nodeName]){if(t=i.READERS[e.nodeName](e),"error"===t.status){var n=r.getMessage("SERVICE_RESPONSE_EXCEPTION",t.message);throw new o({message:n,type:o.TYPE_SRVERR})}return t}throw new o({message:r.getMessage("SERVICE_RESPONSE_ANALYSE",e.nodeName),type:o.TYPE_UNKERR})},i}(UtilsLoggerByDefault,FormatsWKT,ExceptionsErrorService,UtilsMessagesResources,ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse),ServicesProcessIsoCurveResponseProcessIsoCurveResponseFactory=function(e,t,o,r,n,s,i){var a={build:function(a){var c=e.getLogger("ProcessIsoCurveResponseFactory");c.trace(["ProcessIsoCurveResponseFactory::build()"]);var l=null;if(!a.response)return void a.onError.call(a.scope,new t(o.getMessage("SERVICE_RESPONSE_EMPTY")));if(a.rawResponse)c.trace("analyze response : raw"),l=a.response;else{switch(a.outputFormat){case"xml":c.trace("analyze response : xml");try{var u=new r({reader:s});if("string"==typeof a.response?u.setXMLString(a.response):u.setXMLDoc(a.response),l=u.parse(),!l)throw new Error(o.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(p){var h=p.message;return h+="\n(raw response service : '"+a.response+"')",void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",h),status:200,type:t.TYPE_SRVERR}))}break;case"json":c.trace("analyze response : json");var f;if(f="string"==typeof a.response?window.JSON.parse(a.response):a.response,"OK"===f.status||"ok"===f.status){if(l=new i,!l)return void a.onError.call(a.scope,new t(o.getMessage("SERVICE_RESPONSE_ANALYSE",a.response)));l.time=f.time,l.distance=f.distance,l.message=f.message,l.id=f.id,l.srs=f.srs;var d=function(e){l.geometry=e},g=function(){a.onError.call(a.scope,new t({message:o.getMessage("PARAM_FORMAT","wktGeometry")}))};if(l.hasOwnProperty("geometry")&&(n.toJson(f.wktGeometry,d,g),!l.geometry))return;var m=f.location.split(",");l.location&&(l.location.x=m[0],l.location.y=m[1])}else if("ERROR"===f.status||"error"===f.status){var v=f.message;return v+="\n(raw response service : '"+f+"')",void a.onError.call(a.scope,new t(o.getMessage("SERVICE_RESPONSE_EXCEPTION",v)))}break;default:return void a.onError.call(a.scope,new t(o.getMessage("SERVICE_RESPONSE_FORMAT","json","xml")))}if(l&&l.exceptionReport)return void a.onError.call(a.scope,new t({message:o.getMessage("SERVICE_RESPONSE_EXCEPTION",l.exceptionReport),type:t.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,l)}};return a}(UtilsLoggerByDefault,ExceptionsErrorService,UtilsMessagesResources,FormatsXML,FormatsWKT,ServicesProcessIsoCurveFormatsProcessIsoCurveResponseReader,ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse),ServicesProcessIsoCurveProcessIsoCurve=function(e,t,o,r,n,s,i){function a(o){if(!(this instanceof a))throw new TypeError(t.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",r.apply(this,arguments),this.logger=e.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve(options)]"),!o.position)throw new Error(t.getMessage("PARAM_MISSING","position"));if(!o.position.x)throw new Error(t.getMessage("PARAM_MISSING","position.x"));if(!o.position.y)throw new Error(t.getMessage("PARAM_MISSING","position.y"));if(!o.time&&!o.distance)throw new Error("Parameter(s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!o.time&&o.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),o.time&&!o.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",
this.options.exclusions=o.exclusions||null,this.options.graph=o.graph||"Voiture",this.options.reverse=o.reverse||!1,this.options.smoothing=o.smoothing||!1,this.options.holes=o.holes||!1,this.options.srs=o.srs||"EPSG:4326",this.options.outputFormat="string"==typeof o.outputFormat?o.outputFormat.toLowerCase():"json",!this.options.serverUrl){var s=n.ProcessIsoCurve.url(this.options.apiKey),i=s["iso-"+this.options.outputFormat];if(!i)throw new Error("Url by default not found !");this.options.serverUrl=i,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}var c=this.options.serverUrl.lastIndexOf(".");if(-1!==c){var l=this.options.serverUrl.substring(c+1);if(l&&l.length<5)switch(this.logger.trace("Serveur Extension URL : "+l),l.toLowerCase()){case"json":case"xml":this.options.outputFormat=l.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}return a.prototype=Object.create(r.prototype,{}),a.prototype.constructor=a,a.prototype.buildRequest=function(e,r){try{var n=new s(this.options);if(!n.processRequestString())throw new Error(t.getMessage("SERVICE_REQUEST_BUILD"));this.request=n.requestString}catch(i){return void e.call(this,new o(i.message))}r.call(this,this.request)},a.prototype.analyzeResponse=function(e,r){if(this.response){var n={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:r,onError:e,scope:this};i.build(n)}else e.call(this,new o(t.getMessage("SERVICE_RESPONSE_EMPTY")))},a}(UtilsLoggerByDefault,UtilsMessagesResources,ExceptionsErrorService,ServicesCommonService,ServicesDefaultUrlService,ServicesProcessIsoCurveRequestProcessIsoCurveRequest,ServicesProcessIsoCurveResponseProcessIsoCurveResponseFactory),ServicesServices=function(e,t,o,r,n,s,i){var a={getConfig:function(e){var o=new t(e);o.call()},getAltitude:function(t){var o=new e(t);o.call()},geocode:function(e){var t=new o(e);t.call()},reverseGeocode:function(e){var t=new r(e);t.call()},autoComplete:function(e){var t=new n(e);t.call()},route:function(e){var t=new s(e);t.call()},isoCurve:function(e){var t=new i(e);t.call()}};return a}(ServicesAltiAlti,ServicesAutoConfAutoConf,ServicesGeocodeGeocode,ServicesGeocodeReverseGeocode,ServicesAutoCompleteAutoComplete,ServicesRouteRoute,ServicesProcessIsoCurveProcessIsoCurve),Gp=function(e,t,o,r,n,s,i,a,c,l,u,p,h,f,d,g,m,v,y,S,R,E,_,w,A,b,T){var C="undefined"!=typeof window?window:{},P=C.Gp||{versionServices:"__GPVERSION__",date:"__GPDATE__",extend:function(e,t){var o,r=e.split("."),n=this;o=r.length;for(var s=0;o>s;s++){"undefined"==typeof n[r[s]]&&(n[r[s]]={});var i=o-1;s===i&&(n[r[s]]=t),n=n[r[s]]}return this}};return P.extend("Services",e),P.extend("Services.AltiResponse",t),P.extend("Services.Alti.Elevation",o),P.extend("Services.AutoCompleteResponse",r),P.extend("Services.AutoComplete.SuggestedLocation",n),P.extend("Services.GetConfigResponse",s),P.extend("Services.Config.Constraint",i),P.extend("Services.Config.Format",a),P.extend("Services.Config.Layer",c),P.extend("Services.Config.Legend",l),P.extend("Services.Config.Metadata",u),P.extend("Services.Config.Originator",p),P.extend("Services.Config.Service",h),P.extend("Services.Config.Style",f),P.extend("Services.Config.Territory",d),P.extend("Services.Config.Thematic",n),P.extend("Services.Config.TileMatrix",m),P.extend("Services.Config.TileMatrixLimit",v),P.extend("Services.Config.TileMatrixSet",y),P.extend("Services.GeocodeResponse",S),P.extend("Services.Geocode.GeocodedLocation",R),P.extend("Services.Geocode.DirectGeocodedLocation",E),P.extend("Services.Geocode.ReverseGeocodedLocation",_),P.extend("Services.IsoCurveResponse",w),P.extend("Services.RouteResponse",A),P.extend("Services.Route.RouteInstruction",b),P.extend("Error",T),C.Gp=P,C.Gp}(ServicesServices,ServicesAltiResponseModelAltiResponse,ServicesAltiResponseModelElevation,ServicesAutoCompleteResponseModelAutoCompleteResponse,ServicesAutoCompleteResponseModelSuggestedLocation,ServicesAutoConfResponseModelAutoConfResponse,ServicesAutoConfResponseModelConstraint,ServicesAutoConfResponseModelFormat,ServicesAutoConfResponseModelLayer,ServicesAutoConfResponseModelLegend,ServicesAutoConfResponseModelMetadata,ServicesAutoConfResponseModelOriginator,ServicesAutoConfResponseModelService,ServicesAutoConfResponseModelStyle,ServicesAutoConfResponseModelTerritory,ServicesAutoConfResponseModelThematic,ServicesAutoConfResponseModelTileMatrix,ServicesAutoConfResponseModelTileMatrixLimit,ServicesAutoConfResponseModelTileMatrixSet,ServicesGeocodeResponseModelGeocodeResponse,ServicesGeocodeResponseModelGeocodedLocation,ServicesGeocodeResponseModelDirectGeocodedLocation,ServicesGeocodeResponseModelReverseGeocodedLocation,ServicesProcessIsoCurveResponseModelProcessIsoCurveResponse,ServicesRouteResponseModelRouteResponse,ServicesRouteResponseModelRouteInstruction,ExceptionsErrorService);
return Gp;
}));
